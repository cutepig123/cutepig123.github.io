<pre class="code"><font color="#008000">http://entrian.com/goto/<br>看了看源代码，原来是通过给所有函数修改trace，然后在异常时就会执行设置的函数<br># Install the trace function, including all preceding frames.<br>sys.settrace(_trace)<br>frame = sys._getframe().f_back<br>while frame:<br>    frame.f_trace = _trace<br>    frame = frame.f_back<br>改天有时间看看如何在trace中分析每一行代码的！<br><br># Example 1: Breaking out from a deeply nested loop:<br></font><font color="#c00000">from</font> <font color="#c00000">goto</font> <font color="#c00000">import</font> <font color="#c00000">goto</font><font color="#0000c0">,</font> <font color="#c00000">label</font><br><font color="#c00000">for</font> <font color="#000000">i</font> <font color="#c00000">in</font> <font color="#000000">range</font><font color="#0000c0">(</font><font color="#0080c0">1</font><font color="#0000c0">,</font> <font color="#0080c0">10</font><font color="#0000c0">)</font><font color="#0000c0">:</font><br>    <font color="#c00000">for</font> <font color="#000000">j</font> <font color="#c00000">in</font> <font color="#000000">range</font><font color="#0000c0">(</font><font color="#0080c0">1</font><font color="#0000c0">,</font> <font color="#0080c0">20</font><font color="#0000c0">)</font><font color="#0000c0">:</font><br>        <font color="#c00000">for</font> <font color="#000000">k</font> <font color="#c00000">in</font> <font color="#000000">range</font><font color="#0000c0">(</font><font color="#0080c0">1</font><font color="#0000c0">,</font> <font color="#0080c0">30</font><font color="#0000c0">)</font><font color="#0000c0">:</font><br>            <font color="#c00000">print</font> <font color="#000000">i</font><font color="#0000c0">,</font> <font color="#000000">j</font><font color="#0000c0">,</font> <font color="#000000">k</font><br>            <font color="#c00000">if</font> <font color="#000000">k</font> <font color="#0000c0">==</font> <font color="#0080c0">3</font><font color="#0000c0">:</font><br>                <font color="#c00000">goto</font> <font color="#0000c0">.</font><font color="#000000">end</font><br><font color="#c00000">label</font> <font color="#0000c0">.</font><font color="#000000">end</font><br><font color="#c00000">print</font> <font color="#004080">"Finished\n"</font><br><br><br><font color="#008000"># Example 2: Restarting a loop:<br></font><font color="#c00000">from</font> <font color="#c00000">goto</font> <font color="#c00000">import</font> <font color="#c00000">goto</font><font color="#0000c0">,</font> <font color="#c00000">label</font><br><font color="#c00000">label</font> <font color="#0000c0">.</font><font color="#000000">start</font><br><font color="#c00000">for</font> <font color="#000000">i</font> <font color="#c00000">in</font> <font color="#000000">range</font><font color="#0000c0">(</font><font color="#0080c0">1</font><font color="#0000c0">,</font> <font color="#0080c0">4</font><font color="#0000c0">)</font><font color="#0000c0">:</font><br>    <font color="#c00000">print</font> <font color="#000000">i</font><br>    <font color="#c00000">if</font> <font color="#000000">i</font> <font color="#0000c0">==</font> <font color="#0080c0">2</font><font color="#0000c0">:</font><br>        <font color="#c00000">try</font><font color="#0000c0">:</font><br>            <font color="#000000">output</font> <font color="#0000c0">=</font> <font color="#000000">message</font><br>        <font color="#c00000">except</font> <font color="#000000">NameError</font><font color="#0000c0">:</font><br>            <font color="#c00000">print</font> <font color="#004080">"Oops - forgot to define 'message'!  Start again."</font><br>            <font color="#000000">message</font> <font color="#0000c0">=</font> <font color="#004080">"Hello world"</font><br>            <font color="#c00000">goto</font> <font color="#0000c0">.</font><font color="#000000">start</font><br><font color="#c00000">print</font> <font color="#000000">output</font><font color="#0000c0">,</font> <font color="#004080">"\n"</font><br><br></pre>
