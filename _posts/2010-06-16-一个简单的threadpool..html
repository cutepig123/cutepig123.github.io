<p>Interface如下</p><div class="cnblogs_code" onclick="cnblogs_code_show('f05c5334-b152-45d6-97fc-ba04f0410bb3')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" class="code_img_closed" id="code_img_closed_f05c5334-b152-45d6-97fc-ba04f0410bb3" alt="" /><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" class="code_img_opened" id="code_img_opened_f05c5334-b152-45d6-97fc-ba04f0410bb3" onclick="cnblogs_code_hide('f05c5334-b152-45d6-97fc-ba04f0410bb3',event)" style="display: none;"><span class="cnblogs_code_collapse">代码</span><div id="cnblogs_code_open_f05c5334-b152-45d6-97fc-ba04f0410bb3" class="cnblogs_code_hide"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #0000ff;">struct</span><span style="color: #000000;">&nbsp;Job<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">void</span><span style="color: #000000;">&nbsp;(</span><span style="color: #000000;">*</span><span style="color: #000000;">func)(</span><span style="color: #0000ff;">void</span><span style="color: #000000;">*</span><span style="color: #000000;">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">void</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">para;<br />};<br /><br /></span><span style="color: #0000ff;">class</span><span style="color: #000000;">&nbsp;ThreadPool:noncopyable<br />{<br /></span><span style="color: #0000ff;">public</span><span style="color: #000000;">:<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">static</span><span style="color: #000000;">&nbsp;SetNumThreads(size_t&nbsp;NThread);&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">MUST&nbsp;called&nbsp;before&nbsp;Instance()</span><span style="color: #008000;"><br /></span><span style="color: #000000;"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">static</span><span style="color: #000000;">&nbsp;ThreadPool</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">&nbsp;Instance();<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;boost::shared_ptr</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Event</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">&nbsp;SubmitJob(</span><span style="color: #0000ff;">const</span><span style="color: #000000;">&nbsp;Job</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">&nbsp;job);<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">void</span><span style="color: #000000;">&nbsp;WaitAllJobDone();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">make&nbsp;as&nbsp;public&nbsp;JUST&nbsp;FOR&nbsp;pass&nbsp;VC6&nbsp;compile!</span><span style="color: #008000;"><br /></span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;ThreadPool();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000;">~</span><span style="color: #000000;">ThreadPool();<br />&nbsp;&nbsp;&nbsp;&nbsp;<br /></span><span style="color: #0000ff;">private</span><span style="color: #000000;">:<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">static</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">void</span><span style="color: #000000;">&nbsp;JobThread(&nbsp;</span><span style="color: #0000ff;">void</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">&nbsp;pThis&nbsp;);<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">bool</span><span style="color: #000000;">&nbsp;m_exit;<br />&nbsp;&nbsp;&nbsp;&nbsp;std::vector</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">unsigned&nbsp;</span><span style="color: #0000ff;">long</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">&nbsp;m_threads;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">struct</span><span style="color: #000000;">&nbsp;JobData<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Job&nbsp;job;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boost::shared_ptr</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Event</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">event</span><span style="color: #000000;">;<br />&nbsp;&nbsp;&nbsp;&nbsp;};<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;std::list</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">JobData</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">&nbsp;m_JobQueue;<br />&nbsp;&nbsp;&nbsp;&nbsp;Mutex&nbsp;m_jobMutex;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">static</span><span style="color: #000000;">&nbsp;size_t&nbsp;m_numThread;<br /><br />};</span></div></div></div><p>附加一个简单的使用例子<br /></p><div class="cnblogs_code" onclick="cnblogs_code_show('3d41f74a-57ba-4a29-9f87-bfd34dc18972')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" class="code_img_closed" id="code_img_closed_3d41f74a-57ba-4a29-9f87-bfd34dc18972" alt="" /><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" class="code_img_opened" id="code_img_opened_3d41f74a-57ba-4a29-9f87-bfd34dc18972" onclick="cnblogs_code_hide('3d41f74a-57ba-4a29-9f87-bfd34dc18972',event)" style="display: none;"><span class="cnblogs_code_collapse">代码</span><div id="cnblogs_code_open_3d41f74a-57ba-4a29-9f87-bfd34dc18972" class="cnblogs_code_hide"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #0000ff;">void</span><span style="color: #000000;">&nbsp;f(</span><span style="color: #0000ff;">void</span><span style="color: #000000;">*</span><span style="color: #000000;">&nbsp;p)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;">*</span><span style="color: #000000;">&nbsp;pI&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;(</span><span style="color: #0000ff;">int</span><span style="color: #000000;">*</span><span style="color: #000000;">)p;<br />&nbsp;&nbsp;&nbsp;&nbsp;printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">Thread&nbsp;%d,&nbsp;I:&nbsp;%d\n</span><span style="color: #800000;">"</span><span style="color: #000000;">,&nbsp;GetCurrentThreadId(),&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">pI);<br />&nbsp;&nbsp;&nbsp;&nbsp;Sleep(</span><span style="color: #800080;">1000</span><span style="color: #000000;">);<br />}<br /><br /></span><span style="color: #0000ff;">int</span><span style="color: #000000;">&nbsp;main(</span><span style="color: #0000ff;">int</span><span style="color: #000000;">&nbsp;argc,&nbsp;</span><span style="color: #0000ff;">char</span><span style="color: #000000;">*</span><span style="color: #000000;">&nbsp;argv[])<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">Hello&nbsp;World!\n</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br />&nbsp;&nbsp;&nbsp;&nbsp;ThreadPool</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">&nbsp;pool&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;ThreadPool::Instance();<br />&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;i;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;std::vector</span><span style="color: #000000;">&lt;</span><span style="color: #0000ff;">int</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">&nbsp;paras(</span><span style="color: #800080;">10</span><span style="color: #000000;">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">for</span><span style="color: #000000;">(i</span><span style="color: #000000;">=</span><span style="color: #800080;">0</span><span style="color: #000000;">;&nbsp;i</span><span style="color: #000000;">&lt;</span><span style="color: #800080;">10</span><span style="color: #000000;">;&nbsp;i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paras[i]&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;i;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;Job&nbsp;job;<br />&nbsp;&nbsp;&nbsp;&nbsp;job.func&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;f;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">std::vector&lt;boost::shared_ptr&lt;Event&gt;&nbsp;&gt;&nbsp;jobs;</span><span style="color: #008000;"><br /></span><span style="color: #000000;"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">for</span><span style="color: #000000;">(i</span><span style="color: #000000;">=</span><span style="color: #800080;">0</span><span style="color: #000000;">;&nbsp;i</span><span style="color: #000000;">&lt;</span><span style="color: #800080;">10</span><span style="color: #000000;">;&nbsp;i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;job.para&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">paras[i];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool.SubmitJob(job);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">jobs.push_back();</span><span style="color: #008000;"><br /></span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">/*</span><span style="color: #008000;">for(i=0;&nbsp;i&lt;10;&nbsp;i++)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobs[i]-&gt;Wait(INFINITE);<br />&nbsp;&nbsp;&nbsp;&nbsp;}</span><span style="color: #008000;">*/</span><span style="color: #000000;"><br />&nbsp;&nbsp;&nbsp;&nbsp;pool.WaitAllJobDone();</span></div></div></div><p>全部源代码在这里 （vs6）<br /></p><p>&nbsp;</p>http://files.cnblogs.com/cutepig/testJobThread.rar<p>&nbsp;</p>