<br /><div class="cnblogs_code"><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;">&nbsp;&nbsp;1</span><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /><span style="color: #000000;">#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">assert.h</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;&nbsp;2</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" />#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">map</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;&nbsp;3</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" />#include&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">stdio.h</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;&nbsp;4</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">&nbsp;&nbsp;5</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /></span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;memory&nbsp;leak&nbsp;checker</span><span style="color: #008000;"><br /></span><span style="color: #008080;">&nbsp;&nbsp;6</span><span style="color: #008000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /></span><span style="color: #0000ff;">struct</span><span style="color: #000000;">&nbsp;Value<br /></span><span style="color: #008080;">&nbsp;&nbsp;7</span><span style="color: #000000;"><img id="Codehighlighter1_91_207_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_91_207_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_91_207_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_91_207_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_91_207_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_91_207_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_91_207_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_91_207_Open_Text').style.display='inline';" align="top"></span><span id="Codehighlighter1_91_207_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_91_207_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">&nbsp;&nbsp;8</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">bool</span><span style="color: #000000;">&nbsp;valid;<br /></span><span style="color: #008080;">&nbsp;&nbsp;9</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;">&nbsp;line;<br /></span><span style="color: #008080;">&nbsp;10</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">&nbsp;11</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;Value()<br /></span><span style="color: #008080;">&nbsp;12</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;:valid(</span><span style="color: #0000ff;">false</span><span style="color: #000000;">),&nbsp;line(</span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">)<br /></span><span style="color: #008080;">&nbsp;13</span><span style="color: #000000;"><img id="Codehighlighter1_153_155_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_153_155_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_153_155_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_153_155_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_153_155_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_153_155_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_153_155_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_153_155_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_153_155_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_153_155_Open_Text"><span style="color: #000000;">{}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;14</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">&nbsp;15</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;Value(</span><span style="color: #0000ff;">bool</span><span style="color: #000000;">&nbsp;v,&nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;">&nbsp;l)<br /></span><span style="color: #008080;">&nbsp;16</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:valid(v),&nbsp;line(l)<br /></span><span style="color: #008080;">&nbsp;17</span><span style="color: #000000;"><img id="Codehighlighter1_201_205_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_201_205_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_201_205_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_201_205_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_201_205_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_201_205_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_201_205_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_201_205_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_201_205_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_201_205_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">&nbsp;18</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;19</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif" align="top"  alt="" />}</span></span><span style="color: #000000;">;<br /></span><span style="color: #008080;">&nbsp;20</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">&nbsp;21</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" />typedef&nbsp;std::map</span><span style="color: #000000;">&lt;</span><span style="color: #0000ff;">void</span><span style="color: #000000;">*</span><span style="color: #000000;">,&nbsp;Value</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">&nbsp;ContainerType;<br /></span><span style="color: #008080;">&nbsp;22</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" />ContainerType&nbsp;myMap;<br /></span><span style="color: #008080;">&nbsp;23</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">&nbsp;24</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /></span><span style="color: #0000ff;">#define</span><span style="color: #000000;">&nbsp;mynew(x)&nbsp;mynew_(x,&nbsp;__LINE__)</span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;25</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">&nbsp;26</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /></span><span style="color: #0000ff;">void</span><span style="color: #000000;">&nbsp;checkMemory()<br /></span><span style="color: #008080;">&nbsp;27</span><span style="color: #000000;"><img id="Codehighlighter1_335_575_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_335_575_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_335_575_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_335_575_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_335_575_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_335_575_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_335_575_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_335_575_Open_Text').style.display='inline';" align="top"></span><span id="Codehighlighter1_335_575_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_335_575_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">&nbsp;28</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;n&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;myMap.size();<br /></span><span style="color: #008080;">&nbsp;29</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">assert(n==0);</span><span style="color: #008000;"><br /></span><span style="color: #008080;">&nbsp;30</span><span style="color: #008000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /></span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;31</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;">(n</span><span style="color: #000000;">&gt;</span><span style="color: #800080;">0</span><span style="color: #000000;">)<br /></span><span style="color: #008080;">&nbsp;32</span><span style="color: #000000;"><img id="Codehighlighter1_391_573_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_391_573_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_391_573_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_391_573_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_391_573_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_391_573_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_391_573_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_391_573_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_391_573_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_391_573_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">&nbsp;33</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">Memory&nbsp;leak&nbsp;found:\n</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">&nbsp;34</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">for</span><span style="color: #000000;">&nbsp;(ContainerType::const_iterator&nbsp;it</span><span style="color: #000000;">=</span><span style="color: #000000;">myMap.begin();<br /></span><span style="color: #008080;">&nbsp;35</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it</span><span style="color: #000000;">!=</span><span style="color: #000000;">myMap.end();</span><span style="color: #000000;">++</span><span style="color: #000000;">it)<br /></span><span style="color: #008080;">&nbsp;36</span><span style="color: #000000;"><img id="Codehighlighter1_510_557_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_510_557_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_510_557_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_510_557_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_510_557_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_510_557_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_510_557_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_510_557_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_510_557_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_510_557_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">&nbsp;37</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">Line&nbsp;%d\n</span><span style="color: #800000;">"</span><span style="color: #000000;">,&nbsp;it</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">second.line);<br /></span><span style="color: #008080;">&nbsp;38</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;39</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert(</span><span style="color: #800080;">0</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">&nbsp;40</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;41</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif" align="top"  alt="" />}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;42</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">&nbsp;43</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" />template&nbsp;</span><span style="color: #000000;">&lt;</span><span style="color: #0000ff;">class</span><span style="color: #000000;">&nbsp;T</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;44</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" />T</span><span style="color: #000000;">*</span><span style="color: #000000;">&nbsp;mynew_(T&nbsp;</span><span style="color: #0000ff;">const</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">n,&nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;">&nbsp;line)<br /></span><span style="color: #008080;">&nbsp;45</span><span style="color: #000000;"><img id="Codehighlighter1_628_711_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_628_711_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_628_711_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_628_711_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_628_711_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_628_711_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_628_711_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_628_711_Open_Text').style.display='inline';" align="top"></span><span id="Codehighlighter1_628_711_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_628_711_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">&nbsp;46</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;T</span><span style="color: #000000;">*</span><span style="color: #000000;">&nbsp;p&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;(T</span><span style="color: #000000;">*</span><span style="color: #000000;">)malloc(</span><span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(T));<br /></span><span style="color: #008080;">&nbsp;47</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">p&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;n;<br /></span><span style="color: #008080;">&nbsp;48</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;myMap[p]</span><span style="color: #000000;">=</span><span style="color: #000000;">Value(</span><span style="color: #0000ff;">true</span><span style="color: #000000;">,&nbsp;line);<br /></span><span style="color: #008080;">&nbsp;49</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span style="color: #000000;">&nbsp;p;<br /></span><span style="color: #008080;">&nbsp;50</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif" align="top"  alt="" />}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;51</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">&nbsp;52</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /></span><span style="color: #0000ff;">void</span><span style="color: #000000;">&nbsp;mydelete(</span><span style="color: #0000ff;">void</span><span style="color: #000000;">*</span><span style="color: #000000;">&nbsp;p)<br /></span><span style="color: #008080;">&nbsp;53</span><span style="color: #000000;"><img id="Codehighlighter1_736_838_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_736_838_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_736_838_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_736_838_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_736_838_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_736_838_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_736_838_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_736_838_Open_Text').style.display='inline';" align="top"></span><span id="Codehighlighter1_736_838_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_736_838_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">&nbsp;54</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;ContainerType::iterator&nbsp;it&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;myMap.find(p);<br /></span><span style="color: #008080;">&nbsp;55</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;assert(it</span><span style="color: #000000;">!=</span><span style="color: #000000;">myMap.end());<br /></span><span style="color: #008080;">&nbsp;56</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;myMap.erase(it);<br /></span><span style="color: #008080;">&nbsp;57</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;free(p);<br /></span><span style="color: #008080;">&nbsp;58</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif" align="top"  alt="" />}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;59</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">&nbsp;60</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /></span><span style="color: #0000ff;">class</span><span style="color: #000000;">&nbsp;AutoPtr<br /></span><span style="color: #008080;">&nbsp;61</span><span style="color: #000000;"><img id="Codehighlighter1_854_1456_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_854_1456_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_854_1456_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_854_1456_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_854_1456_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_854_1456_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_854_1456_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_854_1456_Open_Text').style.display='inline';" align="top"></span><span id="Codehighlighter1_854_1456_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_854_1456_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">&nbsp;62</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /></span><span style="color: #0000ff;">public</span><span style="color: #000000;">:<br /></span><span style="color: #008080;">&nbsp;63</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">explicit</span><span style="color: #000000;">&nbsp;AutoPtr(</span><span style="color: #0000ff;">int</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">p</span><span style="color: #000000;">=</span><span style="color: #800080;">0</span><span style="color: #000000;">)<br /></span><span style="color: #008080;">&nbsp;64</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;:p_(p),&nbsp;refCnt_(mynew(</span><span style="color: #0000ff;">int</span><span style="color: #000000;">(</span><span style="color: #800080;">1</span><span style="color: #000000;">))),&nbsp;valid_(mynew(</span><span style="color: #0000ff;">bool</span><span style="color: #000000;">(p</span><span style="color: #000000;">?</span><span style="color: #0000ff;">true</span><span style="color: #000000;">:</span><span style="color: #0000ff;">false</span><span style="color: #000000;">)))<br /></span><span style="color: #008080;">&nbsp;65</span><span style="color: #000000;"><img id="Codehighlighter1_960_962_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_960_962_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_960_962_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_960_962_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_960_962_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_960_962_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_960_962_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_960_962_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_960_962_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_960_962_Open_Text"><span style="color: #000000;">{}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;66</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">&nbsp;67</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000;">~</span><span style="color: #000000;">AutoPtr()<br /></span><span style="color: #008080;">&nbsp;68</span><span style="color: #000000;"><img id="Codehighlighter1_977_1148_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_977_1148_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_977_1148_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_977_1148_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_977_1148_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_977_1148_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_977_1148_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_977_1148_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_977_1148_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_977_1148_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">&nbsp;69</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;">(p_)<br /></span><span style="color: #008080;">&nbsp;70</span><span style="color: #000000;"><img id="Codehighlighter1_990_1013_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_990_1013_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_990_1013_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_990_1013_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_990_1013_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_990_1013_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_990_1013_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_990_1013_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_990_1013_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_990_1013_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">&nbsp;71</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mydelete&nbsp;(p_);<br /></span><span style="color: #008080;">&nbsp;72</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;73</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">&nbsp;74</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color: #000000;">*</span><span style="color: #000000;">refCnt_)</span><span style="color: #000000;">--</span><span style="color: #000000;">;<br /></span><span style="color: #008080;">&nbsp;75</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /></span><span style="color: #008080;">&nbsp;76</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">valid_&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">false</span><span style="color: #000000;">;<br /></span><span style="color: #008080;">&nbsp;77</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">&nbsp;78</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert(</span><span style="color: #000000;">*</span><span style="color: #000000;">refCnt_</span><span style="color: #000000;">&gt;=</span><span style="color: #800080;">0</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">&nbsp;79</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;">(</span><span style="color: #000000;">*</span><span style="color: #000000;">refCnt_</span><span style="color: #000000;">==</span><span style="color: #800080;">0</span><span style="color: #000000;">)<br /></span><span style="color: #008080;">&nbsp;80</span><span style="color: #000000;"><img id="Codehighlighter1_1097_1145_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1097_1145_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_1097_1145_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_1097_1145_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_1097_1145_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1097_1145_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_1097_1145_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_1097_1145_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1097_1145_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_1097_1145_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">&nbsp;81</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mydelete(refCnt_);<br /></span><span style="color: #008080;">&nbsp;82</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mydelete(valid_);<br /></span><span style="color: #008080;">&nbsp;83</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;84</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;85</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">&nbsp;86</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">bool</span><span style="color: #000000;">&nbsp;empty()&nbsp;</span><span style="color: #0000ff;">const</span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;87</span><span style="color: #000000;"><img id="Codehighlighter1_1171_1256_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1171_1256_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_1171_1256_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_1171_1256_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_1171_1256_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1171_1256_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_1171_1256_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_1171_1256_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1171_1256_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_1171_1256_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">&nbsp;88</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;">(</span><span style="color: #000000;">!*</span><span style="color: #000000;">valid_)&nbsp;<br /></span><span style="color: #008080;">&nbsp;89</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert(p_</span><span style="color: #000000;">==</span><span style="color: #800080;">0</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">&nbsp;90</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">else</span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;91</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert(p_</span><span style="color: #000000;">!=</span><span style="color: #800080;">0</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">&nbsp;92</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">&nbsp;93</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">!</span><span style="color: #000000;">(</span><span style="color: #000000;">*</span><span style="color: #000000;">valid_);<br /></span><span style="color: #008080;">&nbsp;94</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">&nbsp;95</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /></span><span style="color: #0000ff;">private</span><span style="color: #000000;">:<br /></span><span style="color: #008080;">&nbsp;96</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;friend&nbsp;</span><span style="color: #0000ff;">class</span><span style="color: #000000;">&nbsp;WeakPtr;<br /></span><span style="color: #008080;">&nbsp;97</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;AutoPtr(</span><span style="color: #0000ff;">const</span><span style="color: #000000;">&nbsp;AutoPtr</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">&nbsp;98</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;AutoPtr</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">operator</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">(</span><span style="color: #0000ff;">const</span><span style="color: #000000;">&nbsp;AutoPtr</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">&nbsp;99</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">100</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">p_;<br /></span><span style="color: #008080;">101</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">bool</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">valid_;<br /></span><span style="color: #008080;">102</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">refCnt_;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">weak&nbsp;ref&nbsp;cnt,&nbsp;always&nbsp;valid&nbsp;if&nbsp;one&nbsp;weakPtr&nbsp;or&nbsp;AutoPtr&nbsp;exist</span><span style="color: #008000;"><br /></span><span style="color: #008080;">103</span><span style="color: #008000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif" align="top"  alt="" /></span><span style="color: #000000;">}</span></span><span style="color: #000000;">;<br /></span><span style="color: #008080;">104</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">105</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /></span><span style="color: #0000ff;">class</span><span style="color: #000000;">&nbsp;WeakPtr<br /></span><span style="color: #008080;">106</span><span style="color: #000000;"><img id="Codehighlighter1_1473_2384_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1473_2384_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_1473_2384_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_1473_2384_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_1473_2384_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1473_2384_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_1473_2384_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_1473_2384_Open_Text').style.display='inline';" align="top"></span><span id="Codehighlighter1_1473_2384_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_1473_2384_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">107</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /></span><span style="color: #0000ff;">public</span><span style="color: #000000;">:<br /></span><span style="color: #008080;">108</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;ctor</span><span style="color: #008000;"><br /></span><span style="color: #008080;">109</span><span style="color: #008000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /></span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;WeakPtr()<br /></span><span style="color: #008080;">110</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;:p_(</span><span style="color: #800080;">0</span><span style="color: #000000;">),&nbsp;refCnt_(mynew(</span><span style="color: #0000ff;">int</span><span style="color: #000000;">(</span><span style="color: #800080;">1</span><span style="color: #000000;">))),&nbsp;valid_(mynew(</span><span style="color: #0000ff;">bool</span><span style="color: #000000;">(</span><span style="color: #0000ff;">false</span><span style="color: #000000;">)))<br /></span><span style="color: #008080;">111</span><span style="color: #000000;"><img id="Codehighlighter1_1564_1568_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1564_1568_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_1564_1568_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_1564_1568_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_1564_1568_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1564_1568_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_1564_1568_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_1564_1568_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1564_1568_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_1564_1568_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">112</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">113</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">114</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">explicit</span><span style="color: #000000;">&nbsp;WeakPtr(AutoPtr</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">&nbsp;p)&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">p&nbsp;must&nbsp;be&nbsp;valid</span><span style="color: #008000;"><br /></span><span style="color: #008080;">115</span><span style="color: #008000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /></span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;:p_(</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">p),&nbsp;refCnt_(p.refCnt_),valid_(p.valid_)<br /></span><span style="color: #008080;">116</span><span style="color: #000000;"><img id="Codehighlighter1_1665_1689_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1665_1689_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_1665_1689_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_1665_1689_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_1665_1689_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1665_1689_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_1665_1689_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_1665_1689_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1665_1689_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_1665_1689_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">117</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color: #000000;">*</span><span style="color: #000000;">p_</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">refCnt_)</span><span style="color: #000000;">++</span><span style="color: #000000;">;<br /></span><span style="color: #008080;">118</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">119</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;<br /></span><span style="color: #008080;">120</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;WeakPtr(</span><span style="color: #0000ff;">const</span><span style="color: #000000;">&nbsp;WeakPtr</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">&nbsp;rhs)&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">p&nbsp;must&nbsp;be&nbsp;valid</span><span style="color: #008000;"><br /></span><span style="color: #008080;">121</span><span style="color: #008000;"><img id="Codehighlighter1_1740_1762_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1740_1762_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_1740_1762_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_1740_1762_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_1740_1762_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1740_1762_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_1740_1762_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_1740_1762_Open_Text').style.display='inline';" align="top"></span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1740_1762_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_1740_1762_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">122</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;construct(rhs);<br /></span><span style="color: #008080;">123</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">124</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">125</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000;">~</span><span style="color: #000000;">WeakPtr()<br /></span><span style="color: #008080;">126</span><span style="color: #000000;"><img id="Codehighlighter1_1777_1794_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1777_1794_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_1777_1794_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_1777_1794_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_1777_1794_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1777_1794_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_1777_1794_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_1777_1794_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1777_1794_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_1777_1794_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">127</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destroy();<br /></span><span style="color: #008080;">128</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">129</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">130</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;get</span><span style="color: #008000;"><br /></span><span style="color: #008080;">131</span><span style="color: #008000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /></span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">bool</span><span style="color: #000000;">&nbsp;empty()&nbsp;</span><span style="color: #0000ff;">const</span><span style="color: #000000;"><br /></span><span style="color: #008080;">132</span><span style="color: #000000;"><img id="Codehighlighter1_1825_1875_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1825_1875_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_1825_1875_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_1825_1875_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_1825_1875_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1825_1875_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_1825_1875_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_1825_1875_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1825_1875_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_1825_1875_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">133</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert((</span><span style="color: #000000;">*</span><span style="color: #000000;">refCnt_)</span><span style="color: #000000;">&gt;=</span><span style="color: #800080;">0</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">134</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">!</span><span style="color: #000000;">(</span><span style="color: #000000;">*</span><span style="color: #000000;">valid_);<br /></span><span style="color: #008080;">135</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">136</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">137</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">&nbsp;operator&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;"><br /></span><span style="color: #008080;">138</span><span style="color: #008000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /></span><span style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;WeakPtr</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">operator</span><span style="color: #000000;">=</span><span style="color: #000000;">(</span><span style="color: #0000ff;">const</span><span style="color: #000000;">&nbsp;WeakPtr&nbsp;</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">rhs)<br /></span><span style="color: #008080;">139</span><span style="color: #000000;"><img id="Codehighlighter1_1932_2010_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1932_2010_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_1932_2010_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_1932_2010_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_1932_2010_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1932_2010_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_1932_2010_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_1932_2010_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1932_2010_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_1932_2010_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">140</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;">(</span><span style="color: #0000ff;">this</span><span style="color: #000000;">!=&amp;</span><span style="color: #000000;">rhs)<br /></span><span style="color: #008080;">141</span><span style="color: #000000;"><img id="Codehighlighter1_1953_1991_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1953_1991_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_1953_1991_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_1953_1991_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_1953_1991_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_1953_1991_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_1953_1991_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_1953_1991_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1953_1991_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_1953_1991_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">142</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destroy();<br /></span><span style="color: #008080;">143</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;construct(rhs);<br /></span><span style="color: #008080;">144</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">145</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">return</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">*</span><span style="color: #0000ff;">this</span><span style="color: #000000;">;<br /></span><span style="color: #008080;">146</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">147</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">148</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /></span><span style="color: #0000ff;">private</span><span style="color: #000000;">:<br /></span><span style="color: #008080;">149</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">void</span><span style="color: #000000;">&nbsp;destroy()<br /></span><span style="color: #008080;">150</span><span style="color: #000000;"><img id="Codehighlighter1_2038_2155_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_2038_2155_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_2038_2155_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_2038_2155_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_2038_2155_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_2038_2155_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_2038_2155_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_2038_2155_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_2038_2155_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_2038_2155_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">151</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color: #000000;">*</span><span style="color: #000000;">refCnt_)</span><span style="color: #000000;">--</span><span style="color: #000000;">;<br /></span><span style="color: #008080;">152</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">153</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert((</span><span style="color: #000000;">*</span><span style="color: #000000;">refCnt_)</span><span style="color: #000000;">&gt;=</span><span style="color: #800080;">0</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">154</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">if</span><span style="color: #000000;">(</span><span style="color: #800080;">0</span><span style="color: #000000;">==*</span><span style="color: #000000;">refCnt_)<br /></span><span style="color: #008080;">155</span><span style="color: #000000;"><img id="Codehighlighter1_2102_2150_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_2102_2150_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_2102_2150_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_2102_2150_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_2102_2150_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_2102_2150_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_2102_2150_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_2102_2150_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_2102_2150_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_2102_2150_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">156</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mydelete(refCnt_);<br /></span><span style="color: #008080;">157</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mydelete(valid_);<br /></span><span style="color: #008080;">158</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">159</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;<br /></span><span style="color: #008080;">160</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">161</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">void</span><span style="color: #000000;">&nbsp;construct(</span><span style="color: #0000ff;">const</span><span style="color: #000000;">&nbsp;WeakPtr&nbsp;</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">rhs)<br /></span><span style="color: #008080;">162</span><span style="color: #000000;"><img id="Codehighlighter1_2193_2276_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_2193_2276_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_2193_2276_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_2193_2276_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_2193_2276_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_2193_2276_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_2193_2276_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_2193_2276_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_2193_2276_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_2193_2276_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">163</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;rhs.p_;<br /></span><span style="color: #008080;">164</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;refCnt_&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;rhs.refCnt_;<br /></span><span style="color: #008080;">165</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid_&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;rhs.valid_;<br /></span><span style="color: #008080;">166</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color: #000000;">*</span><span style="color: #000000;">refCnt_)</span><span style="color: #000000;">++</span><span style="color: #000000;">;<br /></span><span style="color: #008080;">167</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">168</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">169</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;AutoPtr&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">p_;<br /></span><span style="color: #008080;">170</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">bool</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">valid_;<br /></span><span style="color: #008080;">171</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;">&nbsp;</span><span style="color: #000000;">*</span><span style="color: #000000;">refCnt_;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">weak&nbsp;ref&nbsp;cnt,&nbsp;always&nbsp;valid&nbsp;if&nbsp;one&nbsp;weakPtr&nbsp;or&nbsp;AutoPtr&nbsp;exist</span><span style="color: #008000;"><br /></span><span style="color: #008080;">172</span><span style="color: #008000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif" align="top"  alt="" /></span><span style="color: #000000;">}</span></span><span style="color: #000000;">;<br /></span><span style="color: #008080;">173</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">174</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /></span><span style="color: #0000ff;">void</span><span style="color: #000000;">&nbsp;Test()<br /></span><span style="color: #008080;">175</span><span style="color: #000000;"><img id="Codehighlighter1_2399_2576_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_2399_2576_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_2399_2576_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_2399_2576_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_2399_2576_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_2399_2576_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_2399_2576_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_2399_2576_Open_Text').style.display='inline';" align="top"></span><span id="Codehighlighter1_2399_2576_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_2399_2576_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">176</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;WeakPtr&nbsp;p1;<br /></span><span style="color: #008080;">177</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">178</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;assert(p1.empty());<br /></span><span style="color: #008080;">179</span><span style="color: #000000;"><img id="Codehighlighter1_2437_2535_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_2437_2535_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_2437_2535_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_2437_2535_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_2437_2535_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_2437_2535_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_2437_2535_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_2437_2535_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_2437_2535_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_2437_2535_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">180</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AutoPtr&nbsp;p(mynew(</span><span style="color: #0000ff;">int</span><span style="color: #000000;">(</span><span style="color: #800080;">100</span><span style="color: #000000;">)));<br /></span><span style="color: #008080;">181</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p1&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;WeakPtr(p);<br /></span><span style="color: #008080;">182</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert(</span><span style="color: #000000;">!</span><span style="color: #000000;">p1.empty());<br /></span><span style="color: #008080;">183</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert(</span><span style="color: #000000;">!</span><span style="color: #000000;">p.empty());<br /></span><span style="color: #008080;">184</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">185</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;assert(p1.empty());<br /></span><span style="color: #008080;">186</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">187</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">//</span><span style="color: #008000;">mynew(int());</span><span style="color: #008000;"><br /></span><span style="color: #008080;">188</span><span style="color: #008000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif" align="top"  alt="" /></span><span style="color: #000000;">}</span></span><span style="color: #000000;"><br /></span><span style="color: #008080;">189</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /><br /></span><span style="color: #008080;">190</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align="top"  alt="" /></span><span style="color: #0000ff;">void</span><span style="color: #000000;">&nbsp;main()<br /></span><span style="color: #008080;">191</span><span style="color: #000000;"><img id="Codehighlighter1_2590_2618_Open_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_2590_2618_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_2590_2618_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_2590_2618_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_2590_2618_Closed_Image" src="http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_2590_2618_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_2590_2618_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_2590_2618_Open_Text').style.display='inline';" align="top"></span><span id="Codehighlighter1_2590_2618_Closed_Text" style="border: 1px solid #808080; background-color: #ffffff; display: none;"><img src="http://www.cnblogs.com/Images/dot.gif"  alt="" /></span><span id="Codehighlighter1_2590_2618_Open_Text"><span style="color: #000000;">{<br /></span><span style="color: #008080;">192</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;Test();<br /></span><span style="color: #008080;">193</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/InBlock.gif" align="top"  alt="" />&nbsp;&nbsp;&nbsp;&nbsp;checkMemory();<br /></span><span style="color: #008080;">194</span><span style="color: #000000;"><img src="http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockEnd.gif" align="top"  alt="" />}</span></span></div>