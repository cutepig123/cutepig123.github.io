<p>// base class for packable object<br />class CPackable{<br />&nbsp;&nbsp; &nbsp;virtual ~CPackable{}=0{}<br />&nbsp;&nbsp; &nbsp;virtual IMG_WORD Pack(...) = 0;<br />&nbsp;&nbsp; &nbsp;virtual IMG_WORD Unpack(...) = 0;<br />};<br /><br />// base class for record<br />class CRecordBase: public CPackable{<br />&nbsp;&nbsp; &nbsp;virtual ~CRecordBase{}=0{}<br />};<br /><br />class CItfRecordBase: public CRecordBase{<br />&nbsp;&nbsp; &nbsp;virtual ~CItfRecordBase{}=0{}<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;ITF_MODULE_RECORD stBasic;<br />};<br /><br />class CModelBase: public CPackable{<br />&nbsp;&nbsp; &nbsp;virtual ~CModelBase{}=0{}<br />&nbsp;&nbsp; &nbsp;bool IsEmpty() const=0;<br />&nbsp;&nbsp; &nbsp;IMG_WORD Draw(...?);<br />&nbsp;&nbsp; &nbsp;IMG_WORD GenMask(...?);<br />};<br /><br />// T should be packable<br />template &lt;class T&gt;<br />class CCopyImpl{<br />&nbsp;&nbsp; &nbsp;CCopyImpl(T const &amp;);&nbsp;&nbsp; &nbsp;// impl using PU<br />&nbsp;&nbsp; &nbsp;T&amp; operator=(T const &amp;);&nbsp;&nbsp; &nbsp;// impl using PU<br />};<br /><br />template &lt;class T&gt;<br />class CScalable{<br />&nbsp;&nbsp; &nbsp;IMG_WORD scaleTo(IMG_REAL scale, T *rhs);<br />};<br /><br />template &lt;class T&gt;<br />class CTransformable{<br />&nbsp;&nbsp; &nbsp;IMG_WORD transformTo(IMG_REAL scale, T *rhs);<br />};<br /><br />class&nbsp;&nbsp; &nbsp;CLrnCmdBase<br />{<br />&nbsp;&nbsp; &nbsp;virtual ~CLrnCmdBase()=0;<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;CPurpose&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;astPurpose[ITF_MAX_NUM_OF_LIGHTINGS];<br />&nbsp;&nbsp; &nbsp;DS_OPTIC_INFO&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;*pstOpticInfo;<br />&nbsp;&nbsp; &nbsp;IMG_CHAR&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;*pacLogPath;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//&nbsp;&nbsp; &nbsp;Directory for logging<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;PR_DEBUG&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;emDebug;<br /><br />&nbsp;&nbsp; &nbsp;IMG_WORD&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;wIsAccurateAlign;&nbsp;&nbsp; &nbsp;//&nbsp;&nbsp; &nbsp;Is the input alignment point accurate<br />&nbsp;&nbsp; &nbsp;DS_COSYS&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;stRefCoordSys;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//&nbsp;&nbsp; &nbsp;Reference coordinate system<br />&nbsp;&nbsp; &nbsp;DS_COSYS&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;stAlignCoordSys;&nbsp;&nbsp; &nbsp;//&nbsp;&nbsp; &nbsp;Alignment coordinate system<br />&nbsp;&nbsp; &nbsp;DS_COSYS_REL&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;stAlignOffset;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//&nbsp;&nbsp; &nbsp;Offset<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;DS_OBJ_TYPE&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;emObjType;<br />};<br /><br />template &lt;class TRecord&gt;<br />class&nbsp;&nbsp; &nbsp;CLrnCmdBaseT: public CLrnCmdBase<br />{<br />&nbsp;&nbsp; &nbsp;TRecord&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;*pstRecord;<br />}<br /><br />class CLrnRpyBase <br />{<br />&nbsp;&nbsp; &nbsp;virtual ~CLrnRpyBase()=0;<br />&nbsp;&nbsp; &nbsp;DS_COSYS&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;stTrueAlignCoSys;&nbsp;&nbsp; &nbsp;//&nbsp;&nbsp; &nbsp;The true alignment system for the learn unit<br />&nbsp;&nbsp; &nbsp;DS_COSYS&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;stInspAlignCoSys;&nbsp;&nbsp; &nbsp;//&nbsp;&nbsp; &nbsp;The alignment system used for inspection<br />};<br /><br />template &lt;IMG_UWORD (*pLrn)(command_type*, reply_type*, additional_arg*), class command_type, class reply_type&gt;<br />IMG_WORD ITF_Lrn( command_type* pstCmd, reply_type* pstRpy)<br />{<br />&nbsp;&nbsp; &nbsp;setup debug flag<br />&nbsp;&nbsp; &nbsp;pLrn(pstCmd, pstRpy, additional);<br />&nbsp;&nbsp; &nbsp;do cleanup<br />}<br /><br />// Application codes<br />class CItfSampleRecord: public CItfRecordBase, public CCopyImpl&lt;CItfSampleRecord&gt;{<br />&nbsp;&nbsp; &nbsp;IMG_WORD m_a;<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;virtual IMG_WORD Pack(...) {}<br />&nbsp;&nbsp; &nbsp;virtual IMG_WORD Unpack(...) {}<br />&nbsp;&nbsp; &nbsp;IMG_WORD ScaleTo(IMG_REAL scale, CItfSampleRecord *rhs){}<br />&nbsp;&nbsp; &nbsp;IMG_WORD transformTo(IMG_REAL scale, CItfSampleRecord *rhs){}<br />};<br /><br />class&nbsp;&nbsp; &nbsp;CItfSampleLrnCmd: public CLrnCmdBaseT&lt;CItfSampleRecord&gt;<br />{<br />&nbsp;&nbsp; &nbsp;IMG_WORD additional;<br />}<br /><br />class&nbsp;&nbsp; &nbsp;CItfSampleLrnRpy: public CLrnRpyBase<br />{<br />&nbsp;&nbsp; &nbsp;IMG_WORD additional;<br />}<br /><br />IMG_WORD&nbsp;&nbsp; &nbsp;ITF_LrnSample(CItfSampleLrnCmd *c, CItfSampleLrnRpy *r, additional)<br />{<br />&nbsp;&nbsp; &nbsp;..<br />}<br /><br />ITF_DEFINE_MODULE(0x1200, CItfSampleRecord, ITF_Lrn&lt;ITF_LrnSample&gt;, )<br /><br />struct Module{<br />&nbsp;&nbsp; &nbsp;int id;<br />&nbsp;&nbsp; &nbsp;CLrnCmdBase* pCmdCreator;<br />&nbsp;&nbsp; &nbsp;CLrnRpyBase* pRpyCreator;<br />&nbsp;&nbsp; &nbsp;IMG_WORD (*pLrn)( void* pstCmd, void* pstRpy);<br />}<br /><br />template &lt;class T&gt;<br />T* creator(){<br />&nbsp;&nbsp; &nbsp;return new T;<br />}<br /><br />template &lt;class TRec, class TLrnCmd, class TLrnRpy&gt;<br />void DefineModule(int id, IMG_UWORD (*pLrn)(TLrnCmd*, TLrnRpy*))<br />{<br />&nbsp;&nbsp; &nbsp;Module m={id, creator&lt;TLrnCmd&gt;, creator&lt;TLrnRpy&gt;, <br />}<br /><br />#define ITF_DEFINE_MODULE(id, TRec, FLrn)&nbsp;&nbsp; &nbsp;ModuleRegister(DefineModule&lt;TRec&gt;(id, FLrn))<br /><br />class ModuleRegister{<br />&nbsp;&nbsp; &nbsp;ModuleRegister(IMG_ULWORD ulID, <br />};<br /><br />#define ITF_DEFINE_MODULE<br /><br /></p>