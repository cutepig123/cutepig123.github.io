---
categories: cpp
---
// compile with: cl testMemLeak.cpp -D_DEBUG /MTd -Od -Zi -W3 /link -verbose:lib /debug<br />/*<br />&nbsp;* This program concentrates on allocating and freeing memory<br />&nbsp;* blocks to test the functionality of the _crtDbgFlag flag..<br />&nbsp;*/<br />&nbsp;/*<br />&nbsp;* The memory leakage info is output by OutputDebugString, which can be catched by DebugView<br />&nbsp;* <br />&nbsp;*/<br /><br />// the 1st 3 line MUST put top most<br />#define _CRTDBG_MAP_ALLOC<br />#include &lt;stdlib.h&gt;<br />#include &lt;crtdbg.h&gt;<br /><br />#include &lt;vector&gt;<br />#include &lt;windows.h&gt;<br /><br />#ifdef _DEBUG<br />//#define new&nbsp;&nbsp; new(_NORMAL_BLOCK, __FILE__, __LINE__)<br />#endif<br /><br />inline void EnableMemLeakCheck()<br />{<br />&nbsp;&nbsp; _CrtSetDbgFlag(_CrtSetDbgFlag(_CRTDBG_REPORT_FLAG) | _CRTDBG_LEAK_CHECK_DF);<br />}<br /><br />void main()<br />{<br />&nbsp;&nbsp; EnableMemLeakCheck();<br />&nbsp;&nbsp; //int* leak = new int[10];<br />&nbsp;&nbsp; //malloc_(100);<br />&nbsp;&nbsp; //_malloc_dbg(100, _NORMAL_BLOCK, __FILE__, __LINE__);<br />&nbsp;&nbsp; std::vector&lt;int&gt; v(10);<br />&nbsp;&nbsp; v.resize(1);<br />&nbsp;&nbsp; v.reserve(100);<br />}<br /><br />/*<br />Modify xmemory<br />void deallocate(pointer _Ptr, size_type)<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{&nbsp;&nbsp; &nbsp;// deallocate object at _Ptr, ignore size<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;operator delete(_Ptr);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br />to test memory leakage in STL<br />*/<br /><br />