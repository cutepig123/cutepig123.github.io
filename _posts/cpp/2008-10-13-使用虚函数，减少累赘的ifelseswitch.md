---
categories: cpp
---
假设我们有不同的对象需要管理，我们可能建立一个类来包装一下实现对这些不同类型对象的管理，比如<br>class CObjManager<br>{<br>&nbsp;&nbsp;&nbsp; public:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bool&nbsp;&nbsp;&nbsp;&nbsp; addObj_A(string const &amp; strObjName,Other_params...);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bool&nbsp;&nbsp;&nbsp;&nbsp; addObj_B(string const &amp; strObjName,Other_params...);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .......<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bool&nbsp;&nbsp;&nbsp;&nbsp; updateAllObj();<br>}<br>用add函数将对象添加到管理器内，然后在更新对象时，用updateAllObj()更新对象的数据，这么的话，update可能需要这么写<br><br>bool&nbsp;&nbsp;&nbsp;&nbsp; CObjManager::updateAllObj()<br>{<br>&nbsp;&nbsp;&nbsp; for(i=0 to num of object)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch(object.type)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case A:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case B:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br>}<br><br>我们可以这样使用这个管理器：<br><br>CObjManager&nbsp; objManager;<br>objManager.addObj_A("This is object A",others...);<br>objManager.addObj_B("This is object B",others...);<br>在需要更新对象时，执行<br>objManager.updateAllObj()<br>即可<br><br>有没有觉得CObjManager::updateAllObj函数写得太难看了，尤其是当对象类型很多时更是如此。<br>下面看用虚函数怎么做这件事，完全不用这么多switch<br>首先定义一个对象的虚基类<br>class&nbsp;&nbsp;&nbsp;&nbsp; CObjBase()<br>{<br>&nbsp;&nbsp;&nbsp; public:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CObjBase(string const &amp; strObjName);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; virtual&nbsp;&nbsp;&nbsp; bool&nbsp;&nbsp;&nbsp; update()=0;<br>}<br>其中uodate为对象的更新函数，对于对象A来说，可以这么写<br>class&nbsp;&nbsp;&nbsp;&nbsp; CObj_A():public CObjBase<br>{<br>&nbsp;&nbsp;&nbsp; public:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CObj_A(string const &amp; strObjName,Other_params...):CObjBase(strObjName)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {...}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; virtual&nbsp;&nbsp;&nbsp; bool&nbsp;&nbsp;&nbsp; update()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>}<br>然后写一个对象管理器，如下<br>class CObjManager<br>{<br>&nbsp;&nbsp;&nbsp; public:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bool&nbsp;&nbsp;&nbsp;&nbsp; updateAllObj()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for each obj<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj.update();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bool&nbsp;&nbsp;&nbsp; addObj(CObjBase&nbsp;&nbsp;&nbsp; * pObj);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ~CObjManager()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for each object<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delete object<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>}<br>看到没有，这里的updateAllObj完全不用管对象具体是哪一个类型，这些繁琐的事情让c++干吧！<br>可以这么使用这个对象管理器<br>CObjManager&nbsp; objManager;<br>objManager.addObj(new CObj_A("This is Obj A",..other param..));<br>objManager.addObj(new CObj_B("This is Obj B",..other param..));<br>在需要更新对象时，执行<br>objManager.updateAllObj()<br>即可<br>看，用起来还是很方便，但是看起来写起来却漂亮了很多，当需要增加新的类型时，只需要添加一个类就行了。。。<br><br>