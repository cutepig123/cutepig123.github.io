<div>Memory allocation and deallocation across dll boundaries<br /><br />http://stackoverflow.com/questions/1344126/memory-allocation-and-deallocation-across-dll-boundaries<br />http://social.msdn.microsoft.com/Forums/en-US/vclanguage/thread/320c4868-2194-44f5-a241-d5fb37ff0738<br /><br />STL and std::string memory allocation across a DLL boundary<br />http://forums.devx.com/showthread.php?t=89083<br /><br />Allocating and freeing memory across module boundaries<br />http://blogs.msdn.com/b/oldnewthing/archive/2006/09/15/755966.aspx<br /><br />Instancing/Deleting objects in DLL modules: Assertion errors on delete.<br />http://www.gamedev.net/community/forums/topic.asp?topic_id=584050<br /><br />example:<br /><br />////////////////////////////dll:<br /><br />//export.h<br />#pragma once<br /><br />#if defined( APP_EXPORT ) || defined( PR_HOST_SIDE_COMM )<br />#define&nbsp;&nbsp; &nbsp;ASMVISION_EXPORT<br />#endif&nbsp;&nbsp; &nbsp;// APP_EXPORT<br /><br />#if defined( ASMVISION_EXPORT )<br />#define&nbsp;&nbsp; &nbsp;ASMVISION_XXPORT&nbsp;&nbsp; &nbsp;__declspec(dllexport)<br />#else<br />#define&nbsp;&nbsp; &nbsp;ASMVISION_XXPORT&nbsp;&nbsp; &nbsp;__declspec(dllimport)<br />#endif&nbsp;&nbsp; &nbsp;//&nbsp;&nbsp; &nbsp;ASMVISION_EXPORT<br /><br />//mydll.h:<br /><br />#pragma once<br />#include "export.h"<br />#include &lt;vector&gt;<br /><br />struct <span style="color: red;">ASMVISION_XXPORT</span> MyObj<br />{<br />&nbsp;&nbsp; &nbsp;std::vector&lt;int&gt; v;<br />};<br /><br />ASMVISION_XXPORT void GetMyObj(MyObj &amp;obj);<br /><br />//mydll.cpp<br />#include "mydll.h"<br /><br />BOOL APIENTRY DllMain( HANDLE hModule, <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DWORD&nbsp; ul_reason_for_call, <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LPVOID lpReserved<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; )<br />{<br />&nbsp;&nbsp;&nbsp; return TRUE;<br />}<br /><br />void GetMyObj(MyObj &amp;obj)<br />{<br />&nbsp;&nbsp; &nbsp;obj.v.resize( 1000 );<br />}<br /><br />//////////////////////exe<br />#include &lt;mydll.h&gt;<br /><br />int _tmain(int argc, _TCHAR* argv[])<br />{<br />&nbsp;&nbsp; &nbsp;MyObj obj;<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;GetMyObj(obj);<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;return 0;<br />}<br /><br /><span style="color: red;">如果将红色的ASMVISION_XXPORT删除，会发现dll不会导出MyObj的如下函数</span><br /><span style="color: red;">MyObj::MyObj(struct MyObj const &amp;)</span><br /><span style="color: red;">MyObj::MyObj(void)</span><br /><span style="color: red;">struct MyObj &amp; MyObj::operator=(struct MyObj const &amp;)</span><br /><span style="color: red;">MyObj::~MyObj(void)</span><br /><span style="color: red;">在这种情况下，exe销毁MyObj时，调用的是exe中的~vector&lt;&gt;而非该dll中的destructor，从而导致crash</span></div><p>&nbsp;</p><p>&nbsp;<div>As long as you are:<br />&nbsp;<br /><span style="color: red;">1) using one common compiler&nbsp;(like using&nbsp;only VC++ 2005, or using only VC++ 2008), **AND** </span><br /><span style="color: red;">2) linking to the same CRT everywhere (like all projects use the CRT multi-threaded DLL, or all are using the CRT static lib, and there is no mixing, like one project is using&nbsp;the&nbsp;"debug"&nbsp;CRT dll, and another is using "release" CRT dll)...</span><br /><br /><span style="color: red;">...then you will be able to pass around STL types as if they were native types.</span>&nbsp; You will have no need for serialization and all that mess.&nbsp; The same (mostly) applies to Boost.&nbsp;&nbsp; If you switch from an older to newer boost deployment you&nbsp;should be fine, as long as the correspondig header files you are using have not changed between the two releases.&nbsp; If the boost header files&nbsp;have changed, then you should recompile everything that uses the new headers (and make sure that your entire application uses just one version of boost).</div></p><p>&nbsp;</p>