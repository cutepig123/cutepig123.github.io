---
categories: CS-algorithm
---
<div>#include &lt;stdio.h&gt;<br />#include &lt;windows.h&gt;<br />//#include &lt;hash_map&gt;<br />//#include &lt;string&gt;<br /><br />char line[10000];<br />FILE *fpW = 0;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//count line<br />FILE *fpW_Date = 0;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//for srch file within some date<br />long gnchar=0,gnline=0;<br />int hours_before = 0;<br />char destFolder[MAX_PATH]={0};<br />//std::hash_map&lt;std::string&gt; exts;<br />char *exts[] = {"h", "hpp","c","cpp"<br />};<br />int nExt = 4;<br /><br />void count(const char *file, long &amp;nchar, long &amp;nline)<br />{<br />&nbsp;&nbsp; &nbsp;nchar = 0;<br />&nbsp;&nbsp; &nbsp;nline = 0;<br />&nbsp;&nbsp; &nbsp;FILE *fp = fopen(file, "r");<br />&nbsp;&nbsp; &nbsp;if(fp)<br />&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for(char *p = fgets(line, 10000, fp); p; p = fgets(line, 10000, fp))<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;nline++;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;nchar += strlen(p);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fclose(fp);<br />&nbsp;&nbsp; &nbsp;}<br />}<br /><br />inline bool isExt(const char *file)<br />{<br />&nbsp;&nbsp; &nbsp;const char *ext = strrchr(file, '.');<br />&nbsp;&nbsp; &nbsp;if(!ext)<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return false;<br />&nbsp;&nbsp; &nbsp;ext++;<br />&nbsp;&nbsp; &nbsp;for(int i=0; i&lt;nExt; i++)<br />&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if(stricmp(ext, exts[i])==0)<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return true;<br />&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;return false;<br />}<br /><br />float seconds_between(const FILETIME &amp; from, const FILETIME &amp; to)<br />{<br />&nbsp;&nbsp;&nbsp; enum {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TICKS_PER_DAY = 10000000,<br />&nbsp;&nbsp;&nbsp; };<br />&nbsp;&nbsp; return float((*(__int64 *) &amp; to) - (*(__int64 *) &amp; from)) / TICKS_PER_DAY;<br />}<br /><br />void getFileList(const char *folder, long &amp;fnchar, long &amp;fnline)<br />{<br />&nbsp;&nbsp; &nbsp;WIN32_FIND_DATA stFindData;<br />&nbsp;&nbsp; &nbsp;long nchar, nline;<br />&nbsp;&nbsp; &nbsp;char sFull[MAX_PATH];<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;sprintf(sFull, "%s\\*", folder);<br />&nbsp;&nbsp; &nbsp;HANDLE Handle = FindFirstFile(sFull, &amp;stFindData);<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;if(Handle == INVALID_HANDLE_VALUE)return;<br />&nbsp;&nbsp; &nbsp;FindNextFile(Handle, &amp;stFindData);<br />&nbsp;&nbsp; &nbsp;while (FindNextFile(Handle, &amp;stFindData))<br />&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sprintf(sFull, "%s\\%s", folder, stFindData.cFileName);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if(stFindData.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY)&nbsp;&nbsp; &nbsp;//folder<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;printf("%s\n",sFull);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;long subfnchar=0, subfnline=0;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;getFileList(sFull, subfnchar, subfnline);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fnchar += subfnchar;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fnline += subfnline;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;else&nbsp;&nbsp; &nbsp;//file<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if(isExt(stFindData.cFileName))<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;count(sFull, nchar, nline);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fprintf(fpW, "&lt;tr&gt;&lt;td&gt;%s&lt;td&gt;%d&lt;td&gt;%d&lt;/tr&gt;\n", sFull, nchar, nline);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;gnchar += nchar;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;gnline += nline;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fnchar += nchar;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fnline += nline;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//SYSTEMTIME stUTC;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//FileTimeToSystemTime( stFindData.ftLastWriteTime, &amp;stUTC );<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if(hours_before)<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;FILETIME stNow;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;GetSystemTimeAsFileTime(&amp;stNow);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;float diff_second = seconds_between(stFindData.ftLastWriteTime,stNow);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if(diff_second&gt;hours_before*24*60*60)&nbsp;&nbsp; &nbsp;//check date <br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fprintf(fpW_Date, "%s\n", sFull);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;FindClose(Handle);<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;fprintf(fpW, "&lt;tr&gt;&lt;td&gt;&lt;font color=red&gt;%s&lt;/font&gt; &lt;td&gt;&lt;font color=red&gt;%d&lt;/font&gt; &lt;td&gt;&lt;font color=red&gt;%d&lt;/font&gt; &lt;/tr&gt;\n", folder, fnchar, fnline);<br />}<br /><br />void main(int argc, char *argv[])<br />{<br />&nbsp;&nbsp; &nbsp;bool succeed = false;<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;if(argc&gt;=2)<br />&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//parse arguments<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for(int i=1; i&lt;argc; i++)<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if(argv[i][0]=='-')<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if(argv[i][1]=='t')<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sscanf(argv[i+1], "%d", &amp;hours_before);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;else if(argv[i][1]=='c')<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;strcpy(destFolder, argv[i+1]);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;printf("parse result, hours_before %d, destFolder %s\n", hours_before, destFolder);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;long fnchar=0, fnline=0;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;char destfile[300];<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sprintf(destfile, "%s\\lineCnt.htm", argv[1]);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fpW = fopen(destfile, "w");<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sprintf(destfile, "%s\\DateCnt.txt", argv[1]);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fpW_Date = fopen(destfile, "w");<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fprintf(fpW, "&lt;table&gt;\n");<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;getFileList(argv[1],fnchar,fnline);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fprintf(fpW, "&lt;tr&gt;&lt;td&gt;%s&lt;td&gt;%d&lt;td&gt;%d&lt;/tr&gt;\n", "Total", gnchar, gnline);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fprintf(fpW, "&lt;/table&gt;\n");<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fclose(fpW);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fclose(fpW_Date);<br />&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;if(!succeed)<br />&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;printf("Usage:\n");<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;printf("lineCnt [-t &lt;hours before&gt;] [-copyto &lt;folder&gt;] &lt;folder&gt;\n");<br />&nbsp;&nbsp; &nbsp;}<br />}<br /></div>