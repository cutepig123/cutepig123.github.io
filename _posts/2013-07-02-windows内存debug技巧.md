<p><br />A) c++ memory/heap corrupt debug 技巧<br /><br />1. catch first exception<br />2. data breakpoint<br />VC tell us some address is corrupt when free some pointer<br />Check which pointer it is<br />Set break point when malloc the pointer<br />Set data breakpoint at the corrupt address after the pointer is malloc<br />VC will break at the place which corrupts memory<br /><br />3. application verifier heap check 功能<br />4. <br /><br /><br /><br />B) c++ memory leakage<br />注：需要管理员权限（gflags需要），能上网（会自动下载symbols）<br /><br />主要有几个需求<br />一是dump leakage，可以用1，3实现<br />二是显示leakage的call stack，可以用1，2实现<br />而2的用法是比较两次快照，1可以在程序退出时做<br /><br />1. windbg<br />set _NT_SYMBOL_PATH=SRV*C:\MyLocalSymbols*http://msdl.microsoft.com/download/symbols<br />run gflags to enable the stack trace of the program<br />start the program <br />start windbg and attach to the program<br />bm wineagle!_CrtDumpMemoryLeaks<br />make the program leak memory<br />exit program<br />the program will break into windbg<br />step out by gu command<br />!heap -p -a &lt;ADDR&gt; where ADDR is the dumped leakage address<br /><br />2. umdh<br />set _NT_SYMBOL_PATH=SRV*C:\MyLocalSymbols*http://msdl.microsoft.com/download/symbols<br />Gflags to enable OS log stack trace<br />restart the debugee program<br />&nbsp;&nbsp;&nbsp; -1- umdh.exe -pn:application_name.exe -f:FirstDump.txt<br />&nbsp;&nbsp;&nbsp; -2- ... exercise the application<br />&nbsp;&nbsp;&nbsp; -3- umdh.exe -pn:application_name.exe -f:SecondDump.txt<br />&nbsp;&nbsp;&nbsp; -4- umdh.exe FirstDump.txt SecondDump.txt -f:Result.txt<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Compares allocations from the two dumps.<br /><br />3. vc crt lib dump leakage<br /><br /><br />C) crt内存结构<br />Crt: _CrtSetDbgFlag, _CrtCheckMemory</p>
<p><img src="http://images.cnitblog.com/blog/23777/201307/02210459-4c337f29b6d645f38ed1b538b90e625c.jpg" alt="" /></p>
<p><img src="http://images.cnitblog.com/blog/23777/201307/02210517-9832a93aa4a14926890c742d710e923e.jpg" alt="" /></p>
<p><img src="http://images.cnitblog.com/blog/23777/201307/02210529-50c5122b19974ab4a9787018e6443d6d.jpg" alt="" /></p>
<p>D）关于gflags的heap类型<br />Gflags:<br />Full-page heap: placing a non-accessible page at the end of the allocation<br />Normal page heap: It checks fill patterns when a heap block is freed <br />Advantage: reduces memory consumption <br />Disadvantage <br /><br /><br />E) windbg extension<br />http://www.codeproject.com/Articles/6522/Debug-Tutorial-Part-4-Writing-WINDBG-Extensions<br />http://www.haogongju.net/art/1428822 <br />??Debugging Tools for Windows, ?%programfiles%\ Debugging Tools for Windows (x86)\sdk????.<br /><br />??:<br /><br />Sdk\inc: ?????<br /><br />??Dump???Callstack,??windbg???????<br /><br />Sdk\lib:?????,dbghelp.lib,dbgeng.lib,engextcpp.lib,??????????<br /><br />??Dump???Callstack,??windbg???????<br /><br />Sdk\samples: samples(???????)<br />??Dump???Callstack,??windbg???????<br /><br />Sdk\help:???? <br /><br />F）<br />Windows Performance Analyzer<br />http://msdn.microsoft.com/en-us/library/windows/desktop/ff190971%28v=vs.85%29.aspx<br />Write a debugger<br />http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/90770a1c-7f83-4f81-864f-e64f3e17d02b<br />You can use mdbg as a model for a debugger implementation, it comes with source code and you will find a lot of references about it . Depending on the type of debugging you want to do there are two APIs you can use: - for native applications you should use the native debugging API :爃ttp://msdn.microsoft.com/en-us/library/ms679304(VS.85).aspx<br />- for managed applications the managed debugging API :爃ttp://msdn.microsoft.com/en-us/library/ms404520.aspx<br /><br />Both come with samples, for example this (http://msdn.microsoft.com/en-us/library/ms679288(VS.85).aspx) is an example of building a basic debugger using the native API. I also recommend Mike Stall's debugging blog爃ttp://blogs.msdn.com/jmstall/default.aspx.<br />Creating a Basic Debugger<br />http://msdn.microsoft.com/en-us/library/ms679288%28VS.85%29.aspx<br /><br />Sample code for PDB 2 XML tool<br />http://blogs.msdn.com/b/jmstall/archive/2005/08/25/sample-pdb2xml.aspx<br />Tool to get snapshot of managed callstacks<br />http://blogs.msdn.com/b/jmstall/archive/2005/11/28/snapshot.aspx<br /><br /><br /><br /><br /></p>