<A href="http://blog.csdn.net/gxnu/archive/2007/09/26/1801870.aspx">http://blog.csdn.net/gxnu/archive/2007/09/26/1801870.aspx</A><BR>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'"><FONT face=Arial size=2>多态是如何利用这个虚函数表实现的呢？看下面的代码：</FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align=left><FONT face=Arial><FONT size=2><SPAN lang=EN-US style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt">struct</SPAN><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt"> Super<?XML:NAMESPACE PREFIX = O /><O:P></O:P></SPAN></FONT></FONT></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt"><FONT face=Arial><FONT size=2>{<O:P></O:P></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt"><FONT face=Arial><FONT size=2><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>int data;<O:P></O:P></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt"><FONT face=Arial><FONT size=2><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">virtual</SPAN> <SPAN style="COLOR: blue">int</SPAN> add(<SPAN style="COLOR: blue">int</SPAN> i){return i;};<O:P></O:P></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt"><FONT face=Arial><FONT size=2><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">virtual</SPAN> string toString()=0;<O:P></O:P></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt"><FONT face=Arial><FONT size=2>};<O:P></O:P></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align=left><FONT face=Arial><FONT size=2><SPAN lang=EN-US style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt">class</SPAN><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt"> Sub: <SPAN style="COLOR: blue">public</SPAN> Super<O:P></O:P></SPAN></FONT></FONT></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt"><FONT face=Arial><FONT size=2>{<O:P></O:P></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align=left><FONT face=Arial><FONT size=2><SPAN lang=EN-US style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt">public</SPAN><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt">:<O:P></O:P></SPAN></FONT></FONT></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt"><FONT face=Arial><FONT size=2><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>string toString()<O:P></O:P></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt"><FONT face=Arial><FONT size=2><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{<O:P></O:P></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt"><FONT face=Arial><FONT size=2><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">return</SPAN> string(<SPAN style="COLOR: maroon">"Sub class"</SPAN>);<O:P></O:P></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt"><FONT face=Arial><FONT size=2><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>}<O:P></O:P></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt"><FONT face=Arial><FONT size=2>};<O:P></O:P></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US><O:P><FONT size=2>&nbsp;</FONT></O:P></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt"><FONT face=Arial><FONT size=2><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Super* s = <SPAN style="COLOR: blue">new</SPAN> Sub();<O:P></O:P></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt"><FONT face=Arial><FONT size=2><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>cout&lt;&lt;s-&gt;toString()&lt;&lt;endl;<O:P></O:P></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 9pt; FONT-FAMILY: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes; mso-font-kerning: 0pt"><FONT face=Arial><FONT size=2><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">delete</SPAN> s;<O:P></O:P></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><FONT face=Arial><FONT size=2><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'">输出</SPAN><SPAN lang=EN-US>”Sub class”</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'">。</SPAN></FONT></FONT></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><FONT face=Arial size=2><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'"><IMG alt="" src="http://p.blog.csdn.net/images/p_blog_csdn_net/smalllixin/vt.JPG"><BR></P>
<P class=MsoNormal style="TEXT-INDENT: 28.1pt; TEXT-ALIGN: center; mso-char-indent-count: 2.0; mso-char-indent-size: 14.05pt" align=center><B><SPAN lang=EN-US style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt">VC++</SPAN></B><B><SPAN style="FONT-SIZE: 14pt; FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''; mso-bidi-font-size: 12.0pt">消息映射的思考</SPAN></B><B><SPAN lang=EN-US style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt"><o:p></o:p></SPAN></B></P>
<P class=MsoNormal style="TEXT-INDENT: 63pt; TEXT-ALIGN: center; mso-char-indent-count: 7.0; mso-char-indent-size: 9.0pt" align=center><SPAN style="FONT-SIZE: 9pt; FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''; mso-bidi-font-size: 12.0pt">作者：</SPAN><SPAN lang=EN-US style="FONT-SIZE: 9pt; mso-bidi-font-size: 12.0pt"><A href="mailto:haoqingxin@263.net"><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">郝庆欣</SPAN></A><o:p></o:p></SPAN></P>
<P class=MsoNormal style="TEXT-INDENT: 21pt; mso-char-indent-count: 2.0; mso-char-indent-size: 10.5pt"><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">在学习</SPAN><SPAN lang=EN-US>VC++</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">的时候，大家都不可避免的用到消息映射。我们都知道</SPAN><SPAN lang=EN-US>C++</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">是一种面向对象的编程语言，</SPAN><SPAN lang=EN-US>VC++</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">中为什么这样来实现消息映射呢？</SPAN><SPAN lang=EN-US><BR></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">　<B>　首先要明白一个包含了消息处理的</B></SPAN><B><SPAN lang=EN-US>Windows</SPAN></B><B><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">程序是如何工作的。</SPAN><SPAN lang=EN-US><BR></SPAN></B><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">　　一般来说一个包含了消息处理的</SPAN><SPAN lang=EN-US>Windows</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">程序至少要包含两个函数</SPAN><SPAN lang=EN-US><BR></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">　　　第一个：</SPAN><SPAN lang=EN-US><BR></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">　　　　</SPAN><SPAN lang=EN-US>int WINAPI WinMain(<BR></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">　　　　　　</SPAN><SPAN lang=EN-US>HINSTANCE hInstance, </SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">　　</SPAN><SPAN class=redtext><SPAN lang=EN-US>// handle to current instance</SPAN></SPAN><SPAN lang=EN-US><BR></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">　　　　　　</SPAN><SPAN lang=EN-US>HINSTANCE hPrevInstance, </SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">　</SPAN><SPAN class=redtext><SPAN lang=EN-US>// handle to previous instance</SPAN></SPAN><SPAN lang=EN-US><BR></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">　　　　　　</SPAN><SPAN lang=EN-US>LPSTR lpCmdLine, </SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">　　　　</SPAN><SPAN class=redtext><SPAN lang=EN-US>// command line</SPAN></SPAN><SPAN lang=EN-US><BR></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">　　　　　　</SPAN><SPAN lang=EN-US>int nCmdShow </SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">　　　　</SPAN><SPAN class=redtext><SPAN lang=EN-US>// show state</SPAN></SPAN><SPAN lang=EN-US><BR></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">　　　　</SPAN><SPAN lang=EN-US>);<BR></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">　　　第二个：</SPAN><SPAN lang=EN-US><BR></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">　　　</SPAN><SPAN lang=EN-US>long FAR PASCAL WndProc(HWND hWnd,WORD message,WORD wParam,LONG lParam);<BR></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">　　　我们不必纠缠程序实现的细节， 
<DIV id=hndwmpneleamsu style="DISPLAY: none">!,eW国r[无]Sc-2A</DIV>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt">只要明白在第一个函数</SPAN><SPAN lang=EN-US><FONT face="宋体, MS Song">WinMain</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">中要注册</SPAN><SPAN lang=EN-US><FONT face="宋体, MS Song">WndProc</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">函数，通俗一些的理解就是</SPAN><SPAN lang=EN-US><FONT face="宋体, MS Song">WinMain</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">告诉</SPAN><SPAN lang=EN-US><FONT face="宋体, MS Song">Windows</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">系统，听着，我知道你要产生很多消息，我这里有一个</SPAN><SPAN lang=EN-US><FONT face="宋体, MS Song">WndProc</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">函数负责处理你传递来的各种消息。当然消息的格式都是系统规定好的。</SPAN><FONT face="宋体, MS Song"> </FONT></P>
<P></P>
<P class=MsoNormal style="TEXT-INDENT: 21.1pt; mso-char-indent-count: 2.0; mso-char-indent-size: 10.55pt"><B><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">其次要明白</SPAN><SPAN lang=EN-US>C++</SPAN></B><B><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">中是如何实现多态性的。</SPAN><SPAN lang=EN-US><o:p></o:p></SPAN></B></P>
<P class=MsoNormal style="TEXT-INDENT: 21pt; mso-char-indent-count: 2.0; mso-char-indent-size: 10.5pt"><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">我们知道多态性实现的关键是晚绑定（或者称为后期绑定），其实质就是编译器并没有在编译期间指定调用函数的绝对地址，而是指定了某个类内部该函数的偏移地址。</SPAN></P>
<P class=MsoNormal style="TEXT-INDENT: 21pt; mso-char-indent-count: 2.0; mso-char-indent-size: 10.5pt"><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">为了实现上面的功能，编译器为我们作了手脚</SPAN></P>
<P class=MsoNormal style="MARGIN-LEFT: 39pt; TEXT-INDENT: -18pt; mso-list: l0 level1 lfo1; tab-stops: list 39.0pt"><SPAN lang=EN-US>1、<SPAN style="FONT: 7pt ''''Times New Roman''''">&nbsp; </SPAN></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">在每个带有虚函数的类中，<SPAN id=fivwmvwijrbnbcrwd style="DISPLAY: none">D.#$5育管网4b!T2Rj管f</SPAN>编译器秘密放置了一个指针，称为</SPAN><SPAN lang=EN-US>Vpointer</SPAN></P>
<P class=MsoNormal style="MARGIN-LEFT: 39pt; TEXT-INDENT: -18pt; mso-list: l0 level1 lfo1; tab-stops: list 39.0pt"><SPAN lang=EN-US>2、<SPAN style="FONT: 7pt ''''Times New Roman''''">&nbsp; </SPAN></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">当系统运行时， 
<P id=flvtjjephtrmun style="DISPLAY: none">%X^:件+垠理|uxWS专</P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt">为每个类创建一个</SPAN><SPAN lang=EN-US><FONT face="宋体, MS Song">VTABLE,</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">其中包含了可以调用虚函数地址。</SPAN><FONT face="宋体, MS Song"> </FONT></P>
<P></P>
<P class=MsoNormal style="MARGIN-LEFT: 39pt; TEXT-INDENT: -18pt; mso-list: l0 level1 lfo1; tab-stops: list 39.0pt"><SPAN lang=EN-US>3、<SPAN style="FONT: 7pt ''''Times New Roman''''">&nbsp; </SPAN></SPAN><SPAN lang=EN-US>Vpointer</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">出始化，指向</SPAN><SPAN lang=EN-US>VTABLE,</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">通过在</SPAN><SPAN lang=EN-US>Vtable</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">中偏移，来找到正确的需要调用的函数地址。</SPAN></P>
<P class=MsoNormal style="TEXT-INDENT: 21.1pt; mso-char-indent-count: 2.0; mso-char-indent-size: 10.55pt"><B><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">然后是</SPAN><SPAN lang=EN-US>MFC</SPAN></B><B><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">对</SPAN><SPAN lang=EN-US>Window API</SPAN></B><B><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">进行的封装</SPAN><SPAN lang=EN-US><o:p></o:p></SPAN></B></P>
<P class=MsoNormal style="TEXT-INDENT: 31.5pt; mso-char-indent-count: 3.0; mso-char-indent-size: 10.5pt"><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">当我们利用</SPAN><SPAN lang=EN-US>MFC</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">框架开发程序的时候，尤其是开发界面应用程序的时候，必定要用到</SPAN><SPAN lang=EN-US>CWnd</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">或者派生于</SPAN><SPAN lang=EN-US>CWnd</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">的类。根据面向对象的设计原则，对于</SPAN><SPAN lang=EN-US>CWnd</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">的一些通用函数，例如窗口大学改变（</SPAN><SPAN lang=EN-US>OnSize</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">）</SPAN><SPAN lang=EN-US>,</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">窗口移动</SPAN><SPAN lang=EN-US>(OnMove),</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">最好是在</SPAN><SPAN lang=EN-US>CWnd</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">中声明为虚函数，然后在继承的类里面重载他们。但是，这样以来，每个相关的派生类都要有一个</SPAN><SPAN lang=EN-US>Vpointer</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">和一套记录</SPAN><SPAN lang=EN-US>Vtable,</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">而</SPAN><SPAN lang=EN-US>CWnd</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">中通用函数是如此至多，</SPAN><SPAN lang=EN-US>CWnd</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">的派生类也很多，必然会导致系统在运行是占用过多的资源（内存），这样显然是不合适的。</SPAN></P>
<P class=MsoNormal style="TEXT-INDENT: 31.5pt; mso-char-indent-count: 3.0; mso-char-indent-size: 10.5pt"><SPAN lang=EN-US>&nbsp;<o:p></o:p></SPAN></P>
<P class=MsoNormal style="TEXT-INDENT: 31.6pt; mso-char-indent-count: 3.0; mso-char-indent-size: 10.5pt"><B><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">那么</SPAN><SPAN lang=EN-US>MFC</SPAN></B><B><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">是如何实现的呢？</SPAN><SPAN lang=EN-US><o:p></o:p></SPAN></B></P>
<P class=MsoNormal style="TEXT-INDENT: 31.5pt; mso-char-indent-count: 3.0; mso-char-indent-size: 10.5pt"><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">答案就是在</SPAN><SPAN lang=EN-US>CWnd</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">基类中尽可能的少用虚函数，采用消息映射机制来代替。</SPAN></P>
<P class=MsoNormal style="TEXT-INDENT: 31.5pt; mso-char-indent-count: 3.0; mso-char-indent-size: 10.5pt"><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">大家可以看一下</SPAN><SPAN lang=EN-US>CWnd</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">的类中的函数，就会发现这一点。</SPAN></P>
<H1><SPAN lang=EN-US style="FONT-WEIGHT: normal; FONT-SIZE: 10.5pt; FONT-FAMILY: ''''Times New Roman''''; mso-bidi-font-size: 12.0pt; mso-font-kerning: 1.0pt">CWnd::OnMove&nbsp; </SPAN><SPAN lang=EN-US style="FONT-FAMILY: Verdana"><o:p></o:p></SPAN></H1>
<P><B><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">afx_msg</SPAN></B><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana"> <B>void</B> <B>OnMove(</B> <B>int</B> <I>x</I><B>,</B> <B>int</B> <I>y</I> <B>);<o:p></o:p></B></SPAN></P>
<P><B><SPAN style="FONT-SIZE: 10pt; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">上面这个函数就不是虚函数。</SPAN></B><B><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana"><o:p></o:p></SPAN></B></P>
<P style="TEXT-INDENT: 10.05pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.05pt"><B><SPAN style="FONT-SIZE: 10pt; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">　最后的问题消息映射是如何实现的呢？</SPAN></B><B><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana"><o:p></o:p></SPAN></B></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN style="FONT-SIZE: 10pt; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">　用一句话说，就是利用宏定义来实现面向过程的消息处理。</SPAN><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana"><o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN style="FONT-SIZE: 10pt; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">例如在</SPAN><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">VC</SPAN><SPAN style="FONT-SIZE: 10pt; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">中有如下的消息映射宏。</SPAN><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana"><o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: -10pt; mso-char-indent-count: -1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">BEGIN_MESSAGE_MAP(CMainFrame, CFrameWnd)<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>//{{AFX_MSG_MAP(CMainFrame) <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: -10pt; mso-char-indent-count: -1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">ON_WM_CREATE()<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">//}}AFX_MSG_MAP <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">ON_COMMAND(ID_FONT_DROPDOWN, DoNothing) <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">END_MESSAGE_MAP() <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN style="FONT-SIZE: 10pt; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">经过编译后，代码被替换为如下形式（这只是作讲解，实际情况比这复杂得多）：</SPAN><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana"> <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">//BEGIN_MESSAGE_MAP(CMainFrame, CFrameWnd)<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">CMainFrame::newWndProc(...) <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">{ <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">switch(...) <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">{ <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">//{{AFX_MSG_MAP(CMainFrame) <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">// ON_WM_CREATE()<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">case(WM_CREATE): <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">OnCreate(...); <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">break; <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">//}}AFX_MSG_MAP <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">// ON_COMMAND(ID_FONT_DROPDOWN, DoNothing) <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">case(WM_COMMAND): <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">if(HIWORD(wP)==ID_FONT_DROPDOWN) <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">{ <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">DoNothing(...); <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">} <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">break; <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">//END_MESSAGE_MAP() <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">} <o:p></o:p></SPAN></P>
<P style="TEXT-INDENT: 10pt; mso-char-indent-count: 1.0; mso-char-indent-size: 10.0pt"><SPAN lang=EN-US style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana">}<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">这样， 
<P id=gfvgpfrgartkpw style="DISPLAY: none">~Z[._R理业供v[供~y</P>
<P id=shbksqgpvaiqhlmlie style="DISPLAY: none">kkPuq}72V}[Kne育教垠@</P>
<DIV id=mcnvposfwkmftccto style="DISPLAY: none">C络rCp;6=+K专^}T3rk</DIV>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN id=odrojkjnpvnuilgulei style="DISPLAY: none">$%Q软\%育HKS理A;b+垠RL垠</SPAN> </P>
<DIV id=fktmcuevvfp style="DISPLAY: none">$H无Lg'网T垠G的</DIV>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"></SPAN><SPAN lang=EN-US><FONT face="宋体, MS Song">VC++</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">就消除了对部分虚拟函数的需要，从而节省了内存空间。</SPAN><FONT face="宋体, MS Song"> </FONT></P>
<P></P>
<P class=MsoNormal><SPAN lang=EN-US>&nbsp;<o:p></o:p></SPAN></P>
<P class=MsoNormal><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">参考资料：</SPAN></P>
<P class=MsoNormal><SPAN lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Thingking in C++,Bruce Eckel;</SPAN></P>
<P class=MsoNormal><SPAN lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><A href="http://www.vchelp.net/">http://www.vchelp.net/</A><SPAN style="mso-spacerun: yes">&nbsp; </SPAN></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">闻怡洋</SPAN></P>
<P class=MsoNormal><SPAN lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN></SPAN><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">寒岩之上，唯我独行</SPAN><SPAN lang=EN-US style="FONT-SIZE: 10pt">---</SPAN><SPAN style="FONT-SIZE: 10pt; FONT-FAMILY: 宋体; mso-ascii-font-family: ''''Times New Roman''''; mso-hansi-font-family: ''''Times New Roman''''">小朱</SPAN></P></SPAN></FONT>