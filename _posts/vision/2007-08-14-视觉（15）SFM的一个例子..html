<p>这里采用的是Yi Ma&nbsp;, Stefano Soatto. An Invitation to 3-D Vision , From Images to Geometric Models 的算法<br></p>
<p><img height=768 alt="" src="http://www.cnblogs.com/images/cnblogs_com/cutepig/snap066.jpg" width=548 border=0><br><img height=512 alt="" src="http://www.cnblogs.com/images/cnblogs_com/cutepig/snap067.jpg" width=686 border=0><br></p>
<div style="BORDER-RIGHT: #cccccc 1px solid; PADDING-RIGHT: 5px; BORDER-TOP: #cccccc 1px solid; PADDING-LEFT: 4px; FONT-SIZE: 13px; PADDING-BOTTOM: 4px; BORDER-LEFT: #cccccc 1px solid; WIDTH: 98%; WORD-BREAK: break-all; PADDING-TOP: 4px; BORDER-BOTTOM: #cccccc 1px solid; BACKGROUND-COLOR: #eeeeee"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;Algorithm&nbsp;8.1.&nbsp;also&nbsp;11.7</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;Rank&nbsp;based&nbsp;factorization&nbsp;algorithm&nbsp;for&nbsp;multiview&nbsp;reconstruction&nbsp;&nbsp;</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;using&nbsp;point&nbsp;features&nbsp;</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;as&nbsp;described&nbsp;in&nbsp;Chapter&nbsp;8,&nbsp;"An&nbsp;introduction&nbsp;to&nbsp;3-D&nbsp;Vision"</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;by&nbsp;Y.&nbsp;Ma,&nbsp;S.&nbsp;Soatto,&nbsp;J.&nbsp;Kosecka,&nbsp;S.&nbsp;Sastry&nbsp;(MASKS)</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;Code&nbsp;distributed&nbsp;free&nbsp;for&nbsp;non-commercial&nbsp;use</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;MASKS,&nbsp;2003</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;Generates&nbsp;multiple&nbsp;synthetic&nbsp;views&nbsp;of&nbsp;a&nbsp;house&nbsp;and&nbsp;computes&nbsp;the&nbsp;</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;motion&nbsp;and&nbsp;structure,&nbsp;calibrated&nbsp;case,&nbsp;point&nbsp;features&nbsp;only</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;Jana&nbsp;Kosecka,&nbsp;George&nbsp;Mason&nbsp;University,&nbsp;2002</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;======================================================================</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>close&nbsp;all;&nbsp;clear;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>FRAMES&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>PLOTS&nbsp;&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;transformation&nbsp;is&nbsp;expressed&nbsp;wrt&nbsp;to&nbsp;the&nbsp;camera&nbsp;frame</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>Zinit&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">5</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;cube&nbsp;in&nbsp;the&nbsp;object&nbsp;frame</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;XW&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;[</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0.2</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0.8</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0.2</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0.8</span><span style="COLOR: #000000">&nbsp;;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1.5</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1.5</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1.5</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1.5</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0.8</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0.8</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0.2</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0.2</span><span style="COLOR: #000000">&nbsp;;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">];<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>NPOINTS&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">12</span><span style="COLOR: #000000">;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>XC&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;zeros(</span><span style="COLOR: #000000">4</span><span style="COLOR: #000000">,NPOINTS,FRAMES);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;initial&nbsp;displacement摄像机的初始位置</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">Rinit&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;rot_matrix([</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">],</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">);&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>Tinit&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;[&nbsp;Rinit(</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">,:)&nbsp;</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">0.5</span><span style="COLOR: #000000">&nbsp;;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rinit(</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">,:)&nbsp;</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">0.5</span><span style="COLOR: #000000">&nbsp;;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rinit(</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">,:)&nbsp;Zinit;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">];<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;first&nbsp;camera&nbsp;coodinates&nbsp;</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">XC(:,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">)&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;Tinit</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">XW;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">画出三维的结构&nbsp;original&nbsp;motion&nbsp;and&nbsp;3D&nbsp;structure</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">figure;&nbsp;hold&nbsp;on;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>plot3_struct(XC(</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">),XC(</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">),XC(</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">));<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>plot3(XC(</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">),XC(</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">),XC(</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">),</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>draw_frame_scaled([diag([</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">]),&nbsp;zeros(</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">)],</span><span style="COLOR: #000000">0.5</span><span style="COLOR: #000000">);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>title(</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">original&nbsp;motion&nbsp;and&nbsp;3D&nbsp;structure</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>view(</span><span style="COLOR: #000000">220</span><span style="COLOR: #000000">,</span><span style="COLOR: #000000">20</span><span style="COLOR: #000000">);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>grid&nbsp;on;&nbsp;axis&nbsp;equal;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;axis&nbsp;off;</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">pause;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;image&nbsp;coordinates&nbsp;计算第一帧时的图像坐标</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">xim(:,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">)&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;project(XC(:,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">));<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>Zmax&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;max(XC(</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">));<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>Zmin&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;min(XC(</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">));<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>rinc&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;pi</span><span style="COLOR: #000000">/</span><span style="COLOR: #000000">30</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>rot_axis&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;[</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">;&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">]</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">;</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">trans_axis&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;[</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">;&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">]</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">;</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>ratio&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>rinc&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">10</span><span style="COLOR: #000000">;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;rotation&nbsp;increment&nbsp;20&nbsp;degrees</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">Zmid&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;(Zmax</span><span style="COLOR: #000000">+</span><span style="COLOR: #000000">Zmin)</span><span style="COLOR: #000000">/</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>tinc&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0.5</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">ratio</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">Zmid</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">rinc</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">pi</span><span style="COLOR: #000000">/</span><span style="COLOR: #000000">180</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>ploting&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">for</span><span style="COLOR: #000000">&nbsp;i</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">:FRAMES&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">计算第i帧的图像坐标xim</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;theta&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;(i</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">)</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">rinc</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">pi</span><span style="COLOR: #000000">/</span><span style="COLOR: #000000">180</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;r_axis&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;rot_axis(:,i</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">)</span><span style="COLOR: #000000">/</span><span style="COLOR: #000000">norm(rot_axis(:,i</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">));<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;t_axis&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;trans_axis(:,i</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">)</span><span style="COLOR: #000000">/</span><span style="COLOR: #000000">norm(trans_axis(:,i</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">));<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;trans&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;(i</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">)</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">tinc</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">t_axis;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;R&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;rot_matrix(r_axis,theta);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;translation&nbsp;represents&nbsp;origin&nbsp;of&nbsp;the&nbsp;camera&nbsp;frame</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;in&nbsp;the&nbsp;world&nbsp;frame&nbsp;</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;T(:,:,i)&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;([&nbsp;R&nbsp;trans;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">]);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;all&nbsp;transformation&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;object&nbsp;frame</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;XC(:,:,i)&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;T(:,:,i)</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">XC(:,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">);&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;XW;</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;draw_frame_scaled(T(</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">:</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">,:,i),</span><span style="COLOR: #000000">0.5</span><span style="COLOR: #000000">);&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;xim(:,:,i)&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;[XC(</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">,:,i).</span><span style="COLOR: #000000">/</span><span style="COLOR: #000000">XC(</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">,:,i);&nbsp;XC(</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">,:,i).</span><span style="COLOR: #000000">/</span><span style="COLOR: #000000">XC(</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">,:,i);&nbsp;<img src="http://www.cnblogs.com/Images/dot.gif"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ones(</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">,NPOINTS)];<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>end;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">for</span><span style="COLOR: #000000">&nbsp;j&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">:FRAMES<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;T_ini(:,j)&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;T(</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">:</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">,</span><span style="COLOR: #000000">4</span><span style="COLOR: #000000">,j);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>end;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;noise&nbsp;can&nbsp;be&nbsp;added&nbsp;here</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">for</span><span style="COLOR: #000000">&nbsp;i</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">:FRAMES&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;xim_noisy(:,:,i)&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;xim(:,:,i);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>end&nbsp;&nbsp;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;pause&nbsp;以下为SFM算法</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">---------------------------------------------------------------------</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;compute&nbsp;initial&nbsp;\alpha's&nbsp;for&nbsp;each&nbsp;point&nbsp;using&nbsp;first&nbsp;two&nbsp;frames&nbsp;only&nbsp;1）首先用八点算法计算初始的R0,T0(我感觉T0~即1，0帧之间的相对移动~和实际的应该相差常数倍，因此会导致恢复的结构和实际相差常数倍)，然后估计lambda。。。</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">[T0,&nbsp;R0]&nbsp;&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;essentialDiscrete(xim_noisy(:,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">),xim_noisy(:,:,</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">));<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">for</span><span style="COLOR: #000000">&nbsp;i&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">:NPOINTS<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;alpha(:,i)&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">(skew(xim_noisy(:,i,</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">))</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">T0)</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">*<img src="http://www.cnblogs.com/Images/dot.gif"></span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(skew(xim_noisy(:,i,</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">))</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">R0</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">xim_noisy(:,i,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">))<img src="http://www.cnblogs.com/Images/dot.gif"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">/</span><span style="COLOR: #000000">(norm(skew(xim_noisy(:,i,</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">))</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">T0))</span><span style="COLOR: #000000">^</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;lambda(:,i)&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">/</span><span style="COLOR: #000000">alpha(:,i);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>end<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>scale&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;norm(alpha(:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;set&nbsp;the&nbsp;global&nbsp;scale</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">alpha&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;alpha</span><span style="COLOR: #000000">/</span><span style="COLOR: #000000">scale;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;normalize&nbsp;everything</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">scale&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;norm(lambda(:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;set&nbsp;the&nbsp;global&nbsp;scale</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">lambda&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;lambda</span><span style="COLOR: #000000">/</span><span style="COLOR: #000000">scale;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;normalize&nbsp;everything</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">---------------------------------------------------------------------</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;Compute&nbsp;initial&nbsp;motion&nbsp;estimates&nbsp;for&nbsp;all&nbsp;frames</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;Here&nbsp;do&nbsp;3&nbsp;iterations&nbsp;-&nbsp;in&nbsp;real&nbsp;setting&nbsp;look&nbsp;at&nbsp;the&nbsp;change&nbsp;of&nbsp;scales</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>iter&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">while</span><span style="COLOR: #000000">&nbsp;(iter&nbsp;</span><span style="COLOR: #000000">&lt;</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">5</span><span style="COLOR: #000000">);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;</span><span style="COLOR: #0000ff">for</span><span style="COLOR: #000000">&nbsp;j&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">:FRAMES<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;[];&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;&nbsp;setup&nbsp;matrix&nbsp;P</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #0000ff">for</span><span style="COLOR: #000000">&nbsp;i&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">:NPOINTS<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;[kron(skew(xim_noisy(:,i,j)),xim(:,i,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">)</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">)&nbsp;<img src="http://www.cnblogs.com/Images/dot.gif"></span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alpha(:,i)</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">skew(xim_noisy(:,i,j))];<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;[P;&nbsp;a];<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;end;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;pause</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;[um,&nbsp;sm,&nbsp;vm]&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;svd(P);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;Ti&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;vm(</span><span style="COLOR: #000000">10</span><span style="COLOR: #000000">:</span><span style="COLOR: #000000">12</span><span style="COLOR: #000000">,</span><span style="COLOR: #000000">12</span><span style="COLOR: #000000">);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;Ri&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;transpose(reshape(vm(</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">:</span><span style="COLOR: #000000">9</span><span style="COLOR: #000000">,</span><span style="COLOR: #000000">12</span><span style="COLOR: #000000">)</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">,3,3));</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;[uu,ss,vv]&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;&nbsp;svd(Ri);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;Rhat(:,:,j)&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;sign(det(uu</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">vv</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">))*uu*vv</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;Ti&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;sign(det(uu</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">vv</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">))*Ti/((det(ss))^(1/3));</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;That(:,j)&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;Ti;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;True&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;T(</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">:</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">,</span><span style="COLOR: #000000">4</span><span style="COLOR: #000000">,j);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;end<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;recompute&nbsp;alpha's&nbsp;based&nbsp;on&nbsp;all&nbsp;views</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;lambda_prev&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;lambda;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;</span><span style="COLOR: #0000ff">for</span><span style="COLOR: #000000">&nbsp;i&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">:NPOINTS<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;[];&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;setup&nbsp;matrix&nbsp;M</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #0000ff">for</span><span style="COLOR: #000000">&nbsp;j</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">:FRAMES&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;set&nbsp;up&nbsp;Hl&nbsp;matrix&nbsp;for&nbsp;all&nbsp;m&nbsp;views</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;[&nbsp;skew(xim(:,i,j))</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">That(:,j)&nbsp;<img src="http://www.cnblogs.com/Images/dot.gif"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;skew(xim(:,i,j))</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">Rhat(:,:,j)</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">xim(:,i,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">)];<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;[M;&nbsp;a];<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;end;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;a1&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">M(:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">)</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">*M(:,2)/norm(M(:,1))^2;</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;lambda(:,i)&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">/</span><span style="COLOR: #000000">a1;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;end;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;scale&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;norm(lambda(:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">));&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;set&nbsp;the&nbsp;global&nbsp;scale</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;lambda&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;lambda</span><span style="COLOR: #000000">/</span><span style="COLOR: #000000">scale;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;normalize&nbsp;everything</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;iter&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;iter&nbsp;</span><span style="COLOR: #000000">+</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>end&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;end&nbsp;while&nbsp;iter</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;final&nbsp;structure&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;first&nbsp;frame</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">XF&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;[lambda.</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">xim(</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lambda.</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">xim(</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lambda.</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">xim(</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">)];<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>figure;&nbsp;hold&nbsp;on;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>plot3(XF(</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">),XF(</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">),XF(</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">),</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">r*</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>plot3_struct(XF(</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">),&nbsp;XF(</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">),&nbsp;XF(</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">,:,</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">));<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>title(</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">recovered&nbsp;structure</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>view(</span><span style="COLOR: #000000">220</span><span style="COLOR: #000000">,</span><span style="COLOR: #000000">20</span><span style="COLOR: #000000">);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>grid&nbsp;on;&nbsp;axis&nbsp;equal;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">&nbsp;axis&nbsp;off;</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">pause;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span></div>
