首先是测试了从网上down的一段代码<br>
<div style="BORDER-RIGHT: #cccccc 1px solid; PADDING-RIGHT: 5px; BORDER-TOP: #cccccc 1px solid; PADDING-LEFT: 4px; FONT-SIZE: 13px; PADDING-BOTTOM: 4px; BORDER-LEFT: #cccccc 1px solid; WIDTH: 98%; WORD-BREAK: break-all; PADDING-TOP: 4px; BORDER-BOTTOM: #cccccc 1px solid; BACKGROUND-COLOR: #eeeeee"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;KALMANF&nbsp;</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">&nbsp;updates&nbsp;a&nbsp;system&nbsp;state&nbsp;vector&nbsp;estimate&nbsp;based&nbsp;upon&nbsp;an<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;observation,&nbsp;</span><span style="COLOR: #0000ff">using</span><span style="COLOR: #000000">&nbsp;a&nbsp;discrete&nbsp;Kalman&nbsp;filter.<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;Version&nbsp;</span><span style="COLOR: #000000">1.0</span><span style="COLOR: #000000">,&nbsp;June&nbsp;</span><span style="COLOR: #000000">30</span><span style="COLOR: #000000">,&nbsp;</span><span style="COLOR: #000000">2004</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;This&nbsp;tutorial&nbsp;function&nbsp;was&nbsp;written&nbsp;by&nbsp;Michael&nbsp;C.&nbsp;Kleder<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;(Comments&nbsp;are&nbsp;appreciated&nbsp;at:&nbsp;</span><span style="COLOR: #0000ff">public</span><span style="COLOR: #000000">@kleder.com)<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;INTRODUCTION<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;Many&nbsp;people&nbsp;have&nbsp;heard&nbsp;of&nbsp;Kalman&nbsp;filtering,&nbsp;but&nbsp;regard&nbsp;the&nbsp;topic<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #0000ff">as</span><span style="COLOR: #000000">&nbsp;mysterious.&nbsp;While&nbsp;it</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">s&nbsp;true&nbsp;that&nbsp;deriving&nbsp;the&nbsp;Kalman&nbsp;filter&nbsp;and</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;proving&nbsp;mathematically&nbsp;that&nbsp;it&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">optimal</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">&nbsp;under&nbsp;a&nbsp;variety&nbsp;of<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;circumstances&nbsp;can&nbsp;be&nbsp;rather&nbsp;intense,&nbsp;applying&nbsp;the&nbsp;filter&nbsp;to<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;a&nbsp;basic&nbsp;linear&nbsp;system&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;actually&nbsp;very&nbsp;easy.&nbsp;This&nbsp;Matlab&nbsp;file&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;intended&nbsp;to&nbsp;demonstrate&nbsp;that.<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;An&nbsp;excellent&nbsp;paper&nbsp;on&nbsp;Kalman&nbsp;filtering&nbsp;at&nbsp;the&nbsp;introductory&nbsp;level,<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;without&nbsp;detailing&nbsp;the&nbsp;mathematical&nbsp;underpinnings,&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">An&nbsp;Introduction&nbsp;to&nbsp;the&nbsp;Kalman&nbsp;Filter</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;Greg&nbsp;Welch&nbsp;and&nbsp;Gary&nbsp;Bishop,&nbsp;University&nbsp;of&nbsp;North&nbsp;Carolina<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;http:</span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">www.cs.unc.edu/~welch/kalman/kalmanIntro.html</span><span style="COLOR: #008000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;PURPOSE:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;The&nbsp;purpose&nbsp;of&nbsp;each&nbsp;iteration&nbsp;of&nbsp;a&nbsp;Kalman&nbsp;filter&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;to&nbsp;update<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;the&nbsp;estimate&nbsp;of&nbsp;the&nbsp;state&nbsp;vector&nbsp;of&nbsp;a&nbsp;system&nbsp;(and&nbsp;the&nbsp;covariance<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;of&nbsp;that&nbsp;vector)&nbsp;based&nbsp;upon&nbsp;the&nbsp;information&nbsp;</span><span style="COLOR: #0000ff">in</span><span style="COLOR: #000000">&nbsp;a&nbsp;</span><span style="COLOR: #0000ff">new</span><span style="COLOR: #000000">&nbsp;observation.<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;The&nbsp;version&nbsp;of&nbsp;the&nbsp;Kalman&nbsp;filter&nbsp;</span><span style="COLOR: #0000ff">in</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #0000ff">this</span><span style="COLOR: #000000">&nbsp;function&nbsp;assumes&nbsp;that<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;observations&nbsp;occur&nbsp;at&nbsp;</span><span style="COLOR: #0000ff">fixed</span><span style="COLOR: #000000">&nbsp;discrete&nbsp;time&nbsp;intervals.&nbsp;Also,&nbsp;</span><span style="COLOR: #0000ff">this</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;function&nbsp;assumes&nbsp;a&nbsp;linear&nbsp;system,&nbsp;meaning&nbsp;that&nbsp;the&nbsp;time&nbsp;evolution<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;of&nbsp;the&nbsp;state&nbsp;vector&nbsp;can&nbsp;be&nbsp;calculated&nbsp;by&nbsp;means&nbsp;of&nbsp;a&nbsp;state&nbsp;transition<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;matrix.<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;USAGE:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;s&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;kalmanf(s)<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">s</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;a&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">system</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #0000ff">struct</span><span style="COLOR: #000000">&nbsp;containing&nbsp;various&nbsp;fields&nbsp;used&nbsp;</span><span style="COLOR: #0000ff">as</span><span style="COLOR: #000000">&nbsp;input<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;and&nbsp;output.&nbsp;The&nbsp;state&nbsp;estimate&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">x</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">&nbsp;and&nbsp;its&nbsp;covariance&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">P</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">&nbsp;are<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;updated&nbsp;by&nbsp;the&nbsp;function.&nbsp;The&nbsp;other&nbsp;fields&nbsp;describe&nbsp;the&nbsp;mechanics<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;of&nbsp;the&nbsp;system&nbsp;and&nbsp;are&nbsp;left&nbsp;unchanged.&nbsp;A&nbsp;calling&nbsp;routine&nbsp;may&nbsp;change<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;these&nbsp;other&nbsp;fields&nbsp;</span><span style="COLOR: #0000ff">as</span><span style="COLOR: #000000">&nbsp;needed&nbsp;</span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000">&nbsp;state&nbsp;dynamics&nbsp;are&nbsp;time</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">dependent;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;otherwise,&nbsp;they&nbsp;should&nbsp;be&nbsp;left&nbsp;alone&nbsp;after&nbsp;initial&nbsp;values&nbsp;are&nbsp;</span><span style="COLOR: #0000ff">set</span><span style="COLOR: #000000">.<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;The&nbsp;exceptions&nbsp;are&nbsp;the&nbsp;observation&nbsp;vectro&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">z</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">&nbsp;and&nbsp;the&nbsp;input&nbsp;control<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;(or&nbsp;forcing&nbsp;function)&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">u.</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">&nbsp;If&nbsp;there&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;an&nbsp;input&nbsp;function,&nbsp;then<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">u</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">&nbsp;should&nbsp;be&nbsp;</span><span style="COLOR: #0000ff">set</span><span style="COLOR: #000000">&nbsp;to&nbsp;some&nbsp;nonzero&nbsp;value&nbsp;by&nbsp;the&nbsp;calling&nbsp;routine.<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;SYSTEM&nbsp;DYNAMICS:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;The&nbsp;system&nbsp;evolves&nbsp;according&nbsp;to&nbsp;the&nbsp;following&nbsp;difference&nbsp;equations,<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;where&nbsp;quantities&nbsp;are&nbsp;further&nbsp;defined&nbsp;below:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;x&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;Ax&nbsp;</span><span style="COLOR: #000000">+</span><span style="COLOR: #000000">&nbsp;Bu&nbsp;</span><span style="COLOR: #000000">+</span><span style="COLOR: #000000">&nbsp;w&nbsp;meaning&nbsp;the&nbsp;state&nbsp;vector&nbsp;x&nbsp;evolves&nbsp;during&nbsp;one&nbsp;time<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;step&nbsp;by&nbsp;premultiplying&nbsp;by&nbsp;the&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">state&nbsp;transition</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;matrix</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">&nbsp;A.&nbsp;There&nbsp;is&nbsp;optionally&nbsp;(if&nbsp;nonzero)&nbsp;an&nbsp;input</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;vector&nbsp;u&nbsp;which&nbsp;affects&nbsp;the&nbsp;state&nbsp;linearly,&nbsp;and&nbsp;</span><span style="COLOR: #0000ff">this</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;linear&nbsp;effect&nbsp;on&nbsp;the&nbsp;state&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;represented&nbsp;by<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;premultiplying&nbsp;by&nbsp;the&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">input&nbsp;matrix</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">&nbsp;B.&nbsp;There&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;also<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;gaussian&nbsp;process&nbsp;noise&nbsp;w.<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;z&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;Hx&nbsp;</span><span style="COLOR: #000000">+</span><span style="COLOR: #000000">&nbsp;v&nbsp;meaning&nbsp;the&nbsp;observation&nbsp;vector&nbsp;z&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;a&nbsp;linear&nbsp;function<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;of&nbsp;the&nbsp;state&nbsp;vector,&nbsp;and&nbsp;</span><span style="COLOR: #0000ff">this</span><span style="COLOR: #000000">&nbsp;linear&nbsp;relationship&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;represented&nbsp;by&nbsp;premultiplication&nbsp;by&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">observation</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;matrix</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">&nbsp;H.&nbsp;There&nbsp;is&nbsp;also&nbsp;gaussian&nbsp;measurement</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;noise&nbsp;v.<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;where&nbsp;w&nbsp;</span><span style="COLOR: #000000">~</span><span style="COLOR: #000000">&nbsp;N(</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">,Q)&nbsp;meaning&nbsp;w&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;gaussian&nbsp;noise&nbsp;with&nbsp;covariance&nbsp;Q<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;v&nbsp;</span><span style="COLOR: #000000">~</span><span style="COLOR: #000000">&nbsp;N(</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">,R)&nbsp;meaning&nbsp;v&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;gaussian&nbsp;noise&nbsp;with&nbsp;covariance&nbsp;R<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;VECTOR&nbsp;VARIABLES:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;s.x&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;state&nbsp;vector&nbsp;estimate.&nbsp;In&nbsp;the&nbsp;input&nbsp;</span><span style="COLOR: #0000ff">struct</span><span style="COLOR: #000000">,&nbsp;</span><span style="COLOR: #0000ff">this</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;the<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">a&nbsp;priori</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">&nbsp;state&nbsp;estimate&nbsp;(prior&nbsp;to&nbsp;the&nbsp;addition&nbsp;of&nbsp;the<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;information&nbsp;from&nbsp;the&nbsp;</span><span style="COLOR: #0000ff">new</span><span style="COLOR: #000000">&nbsp;observation).&nbsp;In&nbsp;the&nbsp;output&nbsp;</span><span style="COLOR: #0000ff">struct</span><span style="COLOR: #000000">,<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #0000ff">this</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;the&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">a&nbsp;posteriori</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">&nbsp;state&nbsp;estimate&nbsp;(after&nbsp;the&nbsp;</span><span style="COLOR: #0000ff">new</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;measurement&nbsp;information&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;included).<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;s.z&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;observation&nbsp;vector<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;s.u&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;input&nbsp;control&nbsp;vector,&nbsp;optional&nbsp;(defaults&nbsp;to&nbsp;zero).<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;MATRIX&nbsp;VARIABLES:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;s.A&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;state&nbsp;transition&nbsp;matrix&nbsp;(defaults&nbsp;to&nbsp;identity).<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;s.P&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;covariance&nbsp;of&nbsp;the&nbsp;state&nbsp;vector&nbsp;estimate.&nbsp;In&nbsp;the&nbsp;input&nbsp;</span><span style="COLOR: #0000ff">struct</span><span style="COLOR: #000000">,<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #0000ff">this</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">a&nbsp;priori,</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">&nbsp;and&nbsp;</span><span style="COLOR: #0000ff">in</span><span style="COLOR: #000000">&nbsp;the&nbsp;output&nbsp;it&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">a&nbsp;posteriori.</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;(required&nbsp;unless&nbsp;autoinitializing&nbsp;</span><span style="COLOR: #0000ff">as</span><span style="COLOR: #000000">&nbsp;described&nbsp;below).<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;s.B&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;input&nbsp;matrix,&nbsp;optional&nbsp;(defaults&nbsp;to&nbsp;zero).<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;s.Q&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;process&nbsp;noise&nbsp;covariance&nbsp;(defaults&nbsp;to&nbsp;zero).<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;s.R&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;measurement&nbsp;noise&nbsp;covariance&nbsp;(required).<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;s.H&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;observation&nbsp;matrix&nbsp;(defaults&nbsp;to&nbsp;identity).<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;NORMAL&nbsp;OPERATION:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;(</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">)&nbsp;define&nbsp;all&nbsp;state&nbsp;definition&nbsp;fields:&nbsp;A,B,H,Q,R<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;(</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">)&nbsp;define&nbsp;intial&nbsp;state&nbsp;estimate:&nbsp;x,P<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;(</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">)&nbsp;obtain&nbsp;observation&nbsp;and&nbsp;control&nbsp;vectors:&nbsp;z,u<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;(</span><span style="COLOR: #000000">4</span><span style="COLOR: #000000">)&nbsp;call&nbsp;the&nbsp;filter&nbsp;to&nbsp;obtain&nbsp;updated&nbsp;state&nbsp;estimate:&nbsp;x,P<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;(</span><span style="COLOR: #000000">5</span><span style="COLOR: #000000">)&nbsp;</span><span style="COLOR: #0000ff">return</span><span style="COLOR: #000000">&nbsp;to&nbsp;step&nbsp;(</span><span style="COLOR: #000000">3</span><span style="COLOR: #000000">)&nbsp;and&nbsp;repeat<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;INITIALIZATION:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;If&nbsp;an&nbsp;initial&nbsp;state&nbsp;estimate&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;unavailable,&nbsp;it&nbsp;can&nbsp;be&nbsp;obtained<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;from&nbsp;the&nbsp;first&nbsp;observation&nbsp;</span><span style="COLOR: #0000ff">as</span><span style="COLOR: #000000">&nbsp;follows,&nbsp;provided&nbsp;that&nbsp;there&nbsp;are&nbsp;the<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;same&nbsp;number&nbsp;of&nbsp;observable&nbsp;variables&nbsp;</span><span style="COLOR: #0000ff">as</span><span style="COLOR: #000000">&nbsp;state&nbsp;variables.&nbsp;This&nbsp;</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">auto-</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;intitialization</span><span style="COLOR: #000000">"</span><span style="COLOR: #000000">&nbsp;is&nbsp;done&nbsp;automatically&nbsp;if&nbsp;s.x&nbsp;is&nbsp;absent&nbsp;or&nbsp;NaN.</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">x&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;inv(H)</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">z<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">P&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;inv(H)</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">R</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">inv(H</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">)</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;This&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;mathematically&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;the&nbsp;initial&nbsp;state&nbsp;estimate<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;covariance&nbsp;to&nbsp;infinity.<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;SCALAR&nbsp;EXAMPLE&nbsp;(Automobile&nbsp;Voltimeter):<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;Define&nbsp;the&nbsp;system&nbsp;</span><span style="COLOR: #0000ff">as</span><span style="COLOR: #000000">&nbsp;a&nbsp;constant&nbsp;of&nbsp;</span><span style="COLOR: #000000">12</span><span style="COLOR: #000000">&nbsp;volts:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>function&nbsp;T<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>clear&nbsp;s<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>s.x&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">12</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>s.A&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;Define&nbsp;a&nbsp;process&nbsp;noise&nbsp;(stdev)&nbsp;of&nbsp;</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">&nbsp;volts&nbsp;</span><span style="COLOR: #0000ff">as</span><span style="COLOR: #000000">&nbsp;the&nbsp;car&nbsp;operates:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>s.Q&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">^</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;variance,&nbsp;hence&nbsp;stdev</span><span style="COLOR: #000000">^</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;Define&nbsp;the&nbsp;voltimeter&nbsp;to&nbsp;measure&nbsp;the&nbsp;voltage&nbsp;itself:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>s.H&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;Define&nbsp;a&nbsp;measurement&nbsp;error&nbsp;(stdev)&nbsp;of&nbsp;</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">&nbsp;volts:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>s.R&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">^</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;variance,&nbsp;hence&nbsp;stdev</span><span style="COLOR: #000000">^</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">Do&nbsp;not&nbsp;define&nbsp;any&nbsp;system&nbsp;input&nbsp;(control)&nbsp;functions:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>s.B&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>s.u&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;Do&nbsp;not&nbsp;specify&nbsp;an&nbsp;initial&nbsp;state:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>s.x&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;nan;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>s.P&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;nan;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;Generate&nbsp;random&nbsp;voltages&nbsp;and&nbsp;watch&nbsp;the&nbsp;filter&nbsp;operate.<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>tru</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">[];&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;truth&nbsp;voltage<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">for</span><span style="COLOR: #000000">&nbsp;t</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">:</span><span style="COLOR: #000000">20</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;tru(end</span><span style="COLOR: #000000">+</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">)&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;randn</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">+</span><span style="COLOR: #000000">12</span><span style="COLOR: #000000">;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;s(end).z&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;tru(end)&nbsp;</span><span style="COLOR: #000000">+</span><span style="COLOR: #000000">&nbsp;randn</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;create&nbsp;a&nbsp;measurement<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;s(end</span><span style="COLOR: #000000">+</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">)</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">kalmanf(s(end));&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;perform&nbsp;a&nbsp;Kalman&nbsp;filter&nbsp;iteration<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;end<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;figure<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;hold&nbsp;on<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;grid&nbsp;on<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;plot&nbsp;measurement&nbsp;data:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;hz</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">plot([s(</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">:end</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">1</span><span style="COLOR: #000000">).z],</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">r</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);hold&nbsp;on<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;plot&nbsp;a</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">posteriori&nbsp;state&nbsp;estimates:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;hk</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">plot([s(</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">:end).x],</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">b-</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);hold&nbsp;on<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;ht</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">plot(tru,</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">g-</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);hold&nbsp;on<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;legend(</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">observations</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">,</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">Kalman&nbsp;output</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">,</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">true&nbsp;voltage</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">,</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">)<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;title(</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">Automobile&nbsp;Voltimeter&nbsp;Example</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">)<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;hold&nbsp;off<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>end&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>function&nbsp;s&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;kalmanf(s)<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #0000ff">set</span><span style="COLOR: #000000">&nbsp;defaults&nbsp;</span><span style="COLOR: #0000ff">for</span><span style="COLOR: #000000">&nbsp;absent&nbsp;fields:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">~</span><span style="COLOR: #000000">isfield(s,</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">x</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);&nbsp;s.x</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">nan</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">z;&nbsp;end<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">~</span><span style="COLOR: #000000">isfield(s,</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">P</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);&nbsp;s.P</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">nan;&nbsp;end<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">~</span><span style="COLOR: #000000">isfield(s,</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">z</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);&nbsp;error(</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">Observation&nbsp;vector&nbsp;missing</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);&nbsp;end<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">~</span><span style="COLOR: #000000">isfield(s,</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">u</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);&nbsp;s.u</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">;&nbsp;end<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">~</span><span style="COLOR: #000000">isfield(s,</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">A</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);&nbsp;s.A</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">eye(length(x));&nbsp;end<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">~</span><span style="COLOR: #000000">isfield(s,</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">B</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);&nbsp;s.B</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">0</span><span style="COLOR: #000000">;&nbsp;end<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">~</span><span style="COLOR: #000000">isfield(s,</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">Q</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);&nbsp;s.Q</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">zeros(length(x));&nbsp;end<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">~</span><span style="COLOR: #000000">isfield(s,</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">R</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);&nbsp;error(</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">Observation&nbsp;covariance&nbsp;missing</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);&nbsp;end<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #000000">~</span><span style="COLOR: #000000">isfield(s,</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">H</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);&nbsp;s.H</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">eye(length(x));&nbsp;end<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000">&nbsp;isnan(s.x)<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;initialize&nbsp;state&nbsp;estimate&nbsp;from&nbsp;first&nbsp;observation<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000">&nbsp;diff(size(s.H))<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error(</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">Observation&nbsp;matrix&nbsp;must&nbsp;be&nbsp;square&nbsp;and&nbsp;invertible&nbsp;for&nbsp;state&nbsp;autointialization.</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;end<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;s.x&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;inv(s.H)</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">s.z;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;s.P&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;inv(s.H)</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">s.R</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">inv(s.H</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">);&nbsp;</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #0000ff">else</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;This&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;the&nbsp;code&nbsp;which&nbsp;implements&nbsp;the&nbsp;discrete&nbsp;Kalman&nbsp;filter:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;Prediction&nbsp;</span><span style="COLOR: #0000ff">for</span><span style="COLOR: #000000">&nbsp;state&nbsp;vector&nbsp;and&nbsp;covariance:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;s.x&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;s.A</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">s.x&nbsp;</span><span style="COLOR: #000000">+</span><span style="COLOR: #000000">&nbsp;s.B</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">s.u;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;s.P&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;s.A&nbsp;</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">&nbsp;s.P&nbsp;</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">&nbsp;s.A</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">&nbsp;+&nbsp;s.Q;</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;Compute&nbsp;Kalman&nbsp;gain&nbsp;factor:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;K&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;s.P</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">s.H</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">*inv(s.H*s.P*s.H</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">+</span><span style="COLOR: #000000">s.R);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;Correction&nbsp;based&nbsp;on&nbsp;observation:<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;s.x&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;s.x&nbsp;</span><span style="COLOR: #000000">+</span><span style="COLOR: #000000">&nbsp;K</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">(s.z</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">s.H</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">s.x);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;s.P&nbsp;</span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">&nbsp;s.P&nbsp;</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">&nbsp;K</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">s.H</span><span style="COLOR: #000000">*</span><span style="COLOR: #000000">s.P;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;Note&nbsp;that&nbsp;the&nbsp;desired&nbsp;result,&nbsp;which&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;an&nbsp;improved&nbsp;estimate<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;of&nbsp;the&nbsp;sytem&nbsp;state&nbsp;vector&nbsp;x&nbsp;and&nbsp;its&nbsp;covariance&nbsp;P,&nbsp;was&nbsp;obtained<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;</span><span style="COLOR: #0000ff">in</span><span style="COLOR: #000000">&nbsp;only&nbsp;five&nbsp;lines&nbsp;of&nbsp;code,&nbsp;once&nbsp;the&nbsp;system&nbsp;was&nbsp;defined.&nbsp;(That</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">s</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;how&nbsp;simple&nbsp;the&nbsp;discrete&nbsp;Kalman&nbsp;filter&nbsp;</span><span style="COLOR: #0000ff">is</span><span style="COLOR: #000000">&nbsp;to&nbsp;use.)&nbsp;Later,<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: #000000">%</span><span style="COLOR: #000000">&nbsp;we</span><span style="COLOR: #000000">'</span><span style="COLOR: #000000">ll&nbsp;discuss&nbsp;how&nbsp;to&nbsp;deal&nbsp;with&nbsp;nonlinear&nbsp;systems.</span><span style="COLOR: #000000"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span><span style="COLOR: #000000">&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>end<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></span></div>
<br>后来不过瘾，自己写了一个，没想到稍微改了一改竟然成功了，效果还不错<br>
<div style="BORDER-RIGHT: #cccccc 1px solid; PADDING-RIGHT: 5px; BORDER-TOP: #cccccc 1px solid; PADDING-LEFT: 4px; FONT-SIZE: 13px; PADDING-BOTTOM: 4px; BORDER-LEFT: #cccccc 1px solid; WIDTH: 98%; WORD-BREAK: break-all; PADDING-TOP: 4px; BORDER-BOTTOM: #cccccc 1px solid; BACKGROUND-COLOR: #eeeeee"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>%&nbsp;状态<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>%&nbsp;xk=A&#8226;xk-1+B&#8226;uk+wk<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>%&nbsp;zk=H&#8226;xk+vk,<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>%&nbsp;p(w)&nbsp;~&nbsp;N(0,Q)<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>%&nbsp;p(v)&nbsp;~&nbsp;N(0,R),<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>%&nbsp;预测<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>%&nbsp;x'k=A&#8226;xk+B&#8226;uk<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>%&nbsp;P'k=A&#8226;P(k-1)*AT&nbsp;+&nbsp;Q<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>%&nbsp;修正<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>%&nbsp;Kk=P'k&#8226;HT&#8226;(H&#8226;P'k&#8226;HT+R)-1<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>%&nbsp;xk=x'k+Kk&#8226;(zk-H&#8226;x'k)<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>%&nbsp;Pk=(I-Kk&#8226;H)&#8226;P'k<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><span style="COLOR: red">%要注意的是：必须把系统状态和kalman滤波器内部预测的状态分开<br></span><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>function&nbsp;Test<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>A=[1&nbsp;0.1;0&nbsp;1];<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>B=0;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>Xp=rand(2,1)*0.1;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>X=[0&nbsp;0]';<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>H=[1&nbsp;0];<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>Q=eye(2)*1e-5;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>R=eye(1)*0.1;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>P=eye(2);%&nbsp;P'(k)<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>angle=[];<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>angle_m=[];<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>angle_real=[];<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>for&nbsp;i=1:500<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;angle_real=[angle_real&nbsp;X(1)];&nbsp;%实际角度<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;[Xp,P]=Predict(A,Xp,P,Q);&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;X=A*X+rand(2,1)*1e-5;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;z_m=H*X+rand(1,1)*0.1-0.05;&nbsp;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;angle_m=[angle_m&nbsp;z_m(1)];&nbsp;&nbsp;&nbsp;%测量的角度<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;[Xp,P]=Correct(P,H,R,X,z_m);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>&nbsp;&nbsp;&nbsp;&nbsp;angle=[angle&nbsp;Xp(1)];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%预测的角度&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>end<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>t=1:500;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>plot(t,angle,'r',t,angle_m,'g',t,angle_real,'b')<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>legend('预测值','测量值','实际值')<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>figure<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>plot(t,angle-angle_real,'r',t,angle_m-angle_real,'g')<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>legend('滤波后的误差','测量的误差')<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>title('误差分析')<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>xlabel('time');<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>ylabel('error');<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>function&nbsp;[Xk,Pk]=Predict(A,Xk,Pk_1,Q)<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>Xk=A*Xk;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>Pk=A*Pk_1*A'+Q;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>function&nbsp;[Xk,Pk]=Correct(Pk,H,R,Xk,zk)<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>Kk=Pk&nbsp;*&nbsp;H'&nbsp;*&nbsp;inv(H&nbsp;*&nbsp;Pk&nbsp;*&nbsp;H'&nbsp;+&nbsp;R);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>Xk=Xk+&nbsp;Kk*(zk-H*Xk);<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top>Pk=(eye(size(Pk,1))&nbsp;-&nbsp;Kk*H)*Pk;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" align=top></div>
