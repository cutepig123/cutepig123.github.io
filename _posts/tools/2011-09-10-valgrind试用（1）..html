<p>valgrind试用（1）</p>
<p>安装程序<br /><strong>sudo apt-get install valgrind</strong></p>
<p></p>
<p>编辑测试程序<br /><br /><strong>gedit test.cpp</strong><br /><br />#include &lt;string.h&gt;<br />#include &lt;stdlib.h&gt;<br /><br /><br />int main(int argc, char *argv[])<br />{<br />&nbsp;&nbsp;&nbsp; char *ptr;<br /><br />&nbsp;&nbsp;&nbsp; ptr = (char*) malloc(10);<br />&nbsp;&nbsp;&nbsp; strcpy(ptr, "01234567890");<br /><br />&nbsp;&nbsp;&nbsp; return 0;<br />}</p>
<p>编译运行<br /><strong>cutepig@ubuntu:~/testValgrind$ g++ -g -o test test.cpp</strong><br /><strong>cutepig@ubuntu:~/testValgrind$ valgrind --tool=memcheck --leak-check=yes ./test</strong><br />==13038== Memcheck, a memory error detector<br />==13038== Copyright (C) 2002-2009, and GNU GPL'd, by Julian Seward et al.<br />==13038== Using Valgrind-3.5.0-Debian and LibVEX; rerun with -h for copyright info<br />==13038== Command: ./test<br />==13038== <br />==13038== Invalid write of size 1<br />==13038==&nbsp;&nbsp;&nbsp; at 0x4026195: memcpy (mc_replace_strmem.c:482)<br />==13038==&nbsp;&nbsp;&nbsp; by 0x8048538: main (test.cpp:10)<br />==13038==&nbsp; Address 0x42b6032 is 0 bytes after a block of size 10 alloc'd<br />==13038==&nbsp;&nbsp;&nbsp; at 0x4024C1C: malloc (vg_replace_malloc.c:195)<br />==13038==&nbsp;&nbsp;&nbsp; by 0x8048518: main (test.cpp:9)<br />==13038== <br />==13038== Invalid write of size 1<br />==13038==&nbsp;&nbsp;&nbsp; at 0x402619E: memcpy (mc_replace_strmem.c:482)<br />==13038==&nbsp;&nbsp;&nbsp; by 0x8048538: main (test.cpp:10)<br />==13038==&nbsp; Address 0x42b6033 is 1 bytes after a block of size 10 alloc'd<br />==13038==&nbsp;&nbsp;&nbsp; at 0x4024C1C: malloc (vg_replace_malloc.c:195)<br />==13038==&nbsp;&nbsp;&nbsp; by 0x8048518: main (test.cpp:9)<br />==13038== <br />==13038== <br />==13038== HEAP SUMMARY:<br />==13038==&nbsp;&nbsp;&nbsp;&nbsp; in use at exit: 10 bytes in 1 blocks<br />==13038==&nbsp;&nbsp; total heap usage: 1 allocs, 0 frees, 10 bytes allocated<br />==13038== <br />==13038== 10 bytes in 1 blocks are definitely lost in loss record 1 of 1<br />==13038==&nbsp;&nbsp;&nbsp; at 0x4024C1C: malloc (vg_replace_malloc.c:195)<br />==13038==&nbsp;&nbsp;&nbsp; by 0x8048518: main (test.cpp:9)<br />==13038== <br />==13038== LEAK SUMMARY:<br />==13038==&nbsp;&nbsp;&nbsp; definitely lost: 10 bytes in 1 blocks<br />==13038==&nbsp;&nbsp;&nbsp; indirectly lost: 0 bytes in 0 blocks<br />==13038==&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; possibly lost: 0 bytes in 0 blocks<br />==13038==&nbsp;&nbsp;&nbsp; still reachable: 0 bytes in 0 blocks<br />==13038==&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; suppressed: 0 bytes in 0 blocks<br />==13038== <br />==13038== For counts of detected and suppressed errors, rerun with: -v<br />==13038== ERROR SUMMARY: 3 errors from 3 contexts (suppressed: 18 from 7)<br /><br /><strong>检查到越界，位于main (test.cpp:10)，泄露，位于main (test.cpp:9)</strong><br /><br /><strong>再写一个没问题的程序</strong><br />cutepig@ubuntu:~/testValgrind$ gedit test2.cpp <br /><br />#include &lt;string.h&gt;<br />#include &lt;stdlib.h&gt;<br /><br /><br />int main(int argc, char *argv[])<br />{<br />&nbsp;&nbsp;&nbsp; char *ptr;<br /><br />&nbsp;&nbsp;&nbsp; ptr = (char*) malloc(100);<br />&nbsp;&nbsp;&nbsp; strcpy(ptr, "01234567890");<br />&nbsp;&nbsp;&nbsp; free(ptr);<br /><br />&nbsp;&nbsp;&nbsp; return 0;<br />}<br /><br /><strong>cutepig@ubuntu:~/testValgrind$ g++ test2.cpp </strong><br /><strong>cutepig@ubuntu:~/testValgrind$ valgrind --tool=memcheck --leak-check=yes ./a.out</strong> <br />==12949== Memcheck, a memory error detector<br />==12949== Copyright (C) 2002-2009, and GNU GPL'd, by Julian Seward et al.<br />==12949== Using Valgrind-3.5.0-Debian and LibVEX; rerun with -h for copyright info<br />==12949== Command: ./a.out<br />==12949== <br />==12949== <br />==12949== HEAP SUMMARY:<br />==12949==&nbsp;&nbsp;&nbsp;&nbsp; in use at exit: 0 bytes in 0 blocks<br />==12949==&nbsp;&nbsp; total heap usage: 1 allocs, 1 frees, 100 bytes allocated<br />==12949== <br />==12949== All heap blocks were freed -- no leaks are possible<br />==12949== <br />==12949== For counts of detected and suppressed errors, rerun with: -v<br />==12949== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 18 from 7)</p>
<p>ok，没有内存问题<br /><strong>http://www.cnblogs.com/cutepig/archive/2009/08/02/1537180.html</strong></p>