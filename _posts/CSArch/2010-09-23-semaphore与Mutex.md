---
categories: CSArch
---
C# Semaphore Class<br />http://msdn.microsoft.com/en-us/library/system.threading.semaphore.aspx<br /><br />wiki<br />Semaphore (programming)<br />http://en.wikipedia.org/wiki/Semaphore_%28programming%29<br /><br /><br />理解Semaphore和Mutex<br />Mutex是一把钥匙，一个人拿了就可进入一个房间，出来的时候把钥匙交给队列的第一个。一般的用法是用于串行化对critical section代码的访问，保证这段代码不会被并行的运行。<br /><br />&nbsp;<br /><br />Semaphore是一件可以容纳N人的房间，如果人不满就可以进去，如果人满了，就要等待有人出来。对于N=1的情况，称为binary semaphore。一般的用法是，用于限制对于某一资源的同时访问。<br /><br />&nbsp;<br /><br />Binary semaphore与Mutex的差异：<br /><br />在有的系统中Binary semaphore与Mutex是没有差异的。在有的系统上，主要的差异是mutex一定要由获得锁的进程来释放。而semaphore可以由其它进程释放（这时的semaphore实际就是个原子的变量，大家可以加或减），因此semaphore可以用于进程间同步。Semaphore的同步功能是所有系统都支持的，而Mutex能否由其他进程释放则未定，因此建议mutex只用于保护critical section。而semaphore则用于保护某变量，或者同步。<br /><br />&nbsp;<br /><br />另一个概念是spin lock，这是一个内核态概念。spin lock与semaphore的主要区别是spin lock是busy waiting，而semaphore是sleep。对于可以sleep的进程来说，busy waiting当然没有意义。对于单CPU的系统，busy waiting当然更没意义（没有CPU可以释放锁）。因此，只有多CPU的内核态非进程空间，才会用到spin lock。Linux kernel的spin lock在非SMP的情况下，只是关irq，没有别的操作，用于确保该段程序的运行不会被打断。其实也就是类似mutex的作用，串行化对 critical section的访问。但是mutex不能保护中断的打断，也不能在中断处理程序中被调用。而spin lock也一般没有必要用于可以sleep的进程空间。<br /><br /><p>用semaphore实现mutex</p><p>以及 用mutex 实现semaphore<br /></p>http://bbs.chinaunix.net/viewthread.php?tid=963707<br /><br />