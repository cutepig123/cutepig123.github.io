<div>http://en.wikipedia.org/wiki/Semaphore_%28programming%29</div><div>In computer science, a <strong>semaphore</strong> is a protected <a href="http://en.wikipedia.org/wiki/Variable_%28programming%29" title="Variable (programming)">variable</a> or <a href="http://en.wikipedia.org/wiki/Abstract_data_type" title="Abstract data type">abstract data type</a> that provides a simple but useful abstraction for controlling access by multiple <a href="http://en.wikipedia.org/wiki/Process_%28computing%29" title="Process (computing)">processes</a> to a common resource in a <a href="http://en.wikipedia.org/wiki/Parallel_computing" title="Parallel computing">parallel programming</a> environment.</div><div><p>Counting semaphores are equipped with two operations, historically denoted as <strong>V</strong> (also known as signal()) and <strong>P</strong> (or wait())(see below). Operation <strong>V</strong> <a href="http://en.wikipedia.org/wiki/Increment" title="Increment">increments</a> the semaphore <strong>S</strong>, and operation <strong>P</strong> <a href="http://en.wikipedia.org/wiki/Decrement" title="Decrement">decrements</a> it. The semantics of these operations is shown below. Square brackets are used to indicate <a href="http://en.wikipedia.org/wiki/Atomic_operation" title="Atomic operation">atomic operations</a>, i.e. operations which appear indivisible from the perspective of other processes.</p> <pre><strong>function</strong> V(semaphore S):<br />    <em>Atomically increment S</em><br />    [S &#8592; S + 1]<br /><br /><strong>function</strong> P(semaphore S):<br />    <strong>repeat:</strong><br />        <em>Between repetitions of the loop other processes may operate on the semaphore</em><br />        [<strong>if</strong> S &gt; 0:<br />            <em>Atomically decrement S - note that S cannot become negative</em><br />            S &#8592; S - 1<br />            <strong>break</strong>]<br /></pre> <p>The value of the semaphore <strong>S</strong> is the number of units of the resource that are currently available. The <strong>P</strong> operation <a href="http://en.wikipedia.org/wiki/Busy_waiting" title="Busy waiting">wastes time</a> or <a href="http://en.wikipedia.org/wiki/Sleep_%28operating_system%29" title="Sleep (operating system)">sleeps</a> until a resource protected by the semaphore becomes available, at which time the resource is immediately claimed. The <strong>V</strong> operation is the inverse: it makes a resource available again after the process has finished using it.</p> <p>Many operating systems provide efficient semaphore primitives which mean that one waiting processes is awoken when the semaphore is free. This means that processes do not waste time checking the semaphore value and <a href="http://en.wikipedia.org/wiki/Context_switch" title="Context switch">context switching</a> unnecessarily.</p><p>&nbsp;</p><p><div>http://msdn.microsoft.com/en-us/library/system.threading.monitor%28v=vs.71%29.aspx</div>&nbsp;</p></div><div>The <strong>Monitor</strong> class controls access to objects by granting a lock for an object to a single thread. Object locks provide the ability to restrict access to a block of code, commonly called a critical section. While a thread owns the lock for an object, no other thread can acquire that lock. You can also use <strong>Monitor</strong> to ensure that no other thread is allowed to access a section of application code being executed by the lock owner, unless the other thread is executing the code using a different locked object.</div><div><p><strong>Monitor</strong> has the following features:  </p><ul type="disc"><li>It is associated with an object on demand.</li><li>It is unbound, which means it can be called directly from any context.</li><li>An instance of the <strong>Monitor</strong> class cannot be created.</li></ul> <p>The following information is maintained for each synchronized object:  </p><ul type="disc"><li>A reference to the thread that currently holds the lock.</li><li>A reference to a ready queue, which contains the threads that are ready to obtain the lock.</li><li>A reference to a waiting queue, which contains the threads that are waiting for notification of a change in the state of the locked object.</li></ul>Mutex: <div>A synchronization primitive than can also be used for interprocess synchronization.</div><div><table><tbody><tr><td><div><p>For Windows, critical sections are lighter-weight than mutexes.</p>  <p>Mutexes can be shared between processes, but always result in a system call to the kernel which has some overhead.</p>  <p>Critical sections can only be used within one process, but have the advantage that they only switch to kernel mode in the case of contention - Uncontended acquires, which should be the common case, are incredibly fast. In the case of contention, they enter the kernel to wait on some synchronization primitive (like an event or semaphore).</p>  <p>I wrote a quick sample app that compares the time between the two of them. On my system for 1,000,000 uncontended acquires and releases, a mutex takes over one second. A critical section takes ~50 ms for 1,000,000 acquires.</p>  <p>Here's the test code, I ran this and got similar results if mutex is first or second, so we aren't seeing any other effects.</p>  <pre prettyprint=""><code>HANDLE mutex = CreateMutex(NULL, FALSE, NULL);<br />CRITICAL_SECTION critSec;<br />InitializeCriticalSection(&amp;critSec);<br /><br />LARGE_INTEGER freq;<br />QueryPerformanceFrequency(&amp;freq);<br />LARGE_INTEGER start, end;<br /><br />// Force code into memory, so we don't see any effects of paging.<br />EnterCriticalSection(&amp;critSec);<br />LeaveCriticalSection(&amp;critSec);<br />QueryPerformanceCounter(&amp;start);<br />for (int i = 0; i &lt; 1000000; i++)<br />{<br />&nbsp; &nbsp; EnterCriticalSection(&amp;critSec);<br />&nbsp; &nbsp; LeaveCriticalSection(&amp;critSec);<br />}<br /><br />QueryPerformanceCounter(&amp;end);<br /><br />int totalTimeCS = (int)((end.QuadPart - start.QuadPart) * 1000 / freq.QuadPart);<br /><br />// Force code into memory, so we don't see any effects of paging.<br />WaitForSingleObject(mutex, INFINITE);<br />ReleaseMutex(mutex);<br /><br />QueryPerformanceCounter(&amp;start);<br />for (int i = 0; i &lt; 1000000; i++)<br />{<br />&nbsp; &nbsp; WaitForSingleObject(mutex, INFINITE);<br />&nbsp; &nbsp; ReleaseMutex(mutex);<br />}<br /><br />QueryPerformanceCounter(&amp;end);<br /><br />int totalTime = (int)((end.QuadPart - start.QuadPart) * 1000 / freq.QuadPart);<br /><br />printf("Mutex: %d CritSec: %d\n", totalTime, totalTimeCS);<br /></code></pre> </div>             <table>             <tbody><tr>             <td>                 <div><a href="http://stackoverflow.com/questions/800383/what-is-the-difference-between-mutex-and-critical-section/800422#800422" title="permalink to this answer">link</a>|<a id="flag-post-800422" title="flag this post for serious problems or moderator attention">flag</a></div>                              </td>                          <td align="right">             <div><div>edited <a href="http://stackoverflow.com/posts/800422/revisions" title="show all edits to this post"><span title="2009-04-29 01:21:07Z">Apr 29 '09 at 1:21</span></a></div><div><a href="http://stackoverflow.com/users/83871/zifre"><img src="http://www.gravatar.com/avatar/688da15c29b1fc47987de667a817e82c?s=32&amp;d=identicon&amp;r=PG" alt="" height="32" width="32" /></a></div><div><a href="http://stackoverflow.com/users/83871/zifre">Zifre</a><br /><span title="reputation score">8,701</span><span title="1 gold badge">1</span><span title="18 silver badges">18</span><span title="41 bronze badges">41</span></div></div>             </td>                          <td align="right">             <div><div>answered <span title="2009-04-29 00:38:46Z">Apr 29 '09 at 0:38</span></div><div><a href="http://stackoverflow.com/users/67132/michael"><img src="http://www.gravatar.com/avatar/264f4763794955ff0dd44841b858215b?s=32&amp;d=identicon&amp;r=PG" alt="" height="32" width="32" /></a></div><div><a href="http://stackoverflow.com/users/67132/michael">Michael</a><br /><span title="reputation score 21726">21.7k</span><span title="25 silver badges">25</span><span title="63 bronze badges">63</span></div></div>             </td>             </tr>             </tbody></table>         </td>         </tr>           <tr> <td><br /></td> <td>     <div id="comments-800422">         <table>         <tbody>                          <tr id="comment-610557">         <td><br /></td>         <td><div>beats me - maybe you should post your code. I voted you up one if it makes you feel better &#8211;&nbsp;<a href="http://stackoverflow.com/users/3146/1800-information" title="28617 reputation">1800 INFORMATION</a> <span title="2009-04-29 01:04:13Z">Apr 29 '09 at 1:04</span></div></td>     </tr>                  <tr id="comment-610824">         <td><table><tbody><tr> <td> <span title="number of 'great comment' votes received">1</span> </td> <td> &nbsp; </td></tr> </tbody></table></td>         <td><div>Well done. Upvoted. &#8211;&nbsp;<a href="http://stackoverflow.com/users/44996/applepieisgood" title="974 reputation">ApplePieIsGood</a> <span title="2009-04-29 03:18:34Z">Apr 29 '09 at 3:18</span></div></td>     </tr>                  <tr id="comment-989619">         <td><br /></td>         <td><div><span>Not sure if this relates or not (since I haven't compiled and tried your code), but I've found that calling WaitForSingleObject with INFINITE results in poor performance. Passing it a timeout value of 1 then looping while checking it's return has made a huge difference in the performance of some of my code. This is mostly in the context of waiting for an external process handle, however... Not a mutex. YMMV. I'd be interested in seeing how mutex performs with that modification. The resulting time difference from this test seems bigger than should be expected.</span> &#8211;&nbsp;<a href="http://stackoverflow.com/users/19258/troy-howard" title="1195 reputation">Troy Howard</a> <span title="2009-07-23 05:37:03Z">Jul 23 '09 at 5:37</span></div></td>     </tr>          </tbody>              </table>     </div>      </td> </tr>         </tbody></table>           <div id="adzerk3"><a href="http://engine.adzerk.net/redirect/0/2568/2444/8277/0f4d0743212f4ba5a341f47c1b641785/44" rel="nofollow" target="_blank" title=""><img src="http://static.adzerk.net/Advertisers/2568.jpg" title="" alt="" border="0" height="90" width="728" /></a></div>                        <a name="800492"></a>          <div id="answer-800492">                  <table>         <tbody><tr>         <td>              <div>     <input value="800492" type="hidden" />     <a title="This answer is useful (click again to undo)">up vote</a>     11     <a title="This answer is not useful (click again to undo)">down vote</a>  </div>          </td>         <td>             <div><p>From a theoretical perspective, a <a href="http://en.wikipedia.org/wiki/Critical%5Fsection" rel="nofollow">critical section</a> is a piece of code that must not be run by multiple processes at once because the code accesses shared resources.</p>  <p>A <a href="http://en.wikipedia.org/wiki/Mutual%5Fexclusion" rel="nofollow">mutex</a> is an algorithm (and sometimes the name of a data structure) that is used to protect critical sections.</p>  <p><a href="http://en.wikipedia.org/wiki/Semaphore%5F%28programming%29" rel="nofollow">Semaphores</a> and <a href="http://en.wikipedia.org/wiki/Monitor%5F%28synchronization%29" rel="nofollow">Monitors</a> are common implementations of a mutex.</p>  <p>In practice there are many mutex implementation availiable in windows. They mainly differ as consequence of their implementation by their level of locking, their scopes, their costs, and their performance under different levels of contention. See <a href="http://msdn.microsoft.com/en-us/magazine/cc163552.aspx#S7" rel="nofollow">CLR Inside Out - Using concurrency for scalability</a> for an chart of the costs of different mutex implementations.</p>  <p>Availiable synchronization primitives.</p>  <ul><li><a href="http://msdn.microsoft.com/en-us/library/system.threading.monitor.aspx" rel="nofollow">Monitor</a></li><li><a href="http://msdn.microsoft.com/en-us/library/system.threading.mutex.aspx" rel="nofollow">Mutex</a></li><li><a href="http://msdn.microsoft.com/en-us/library/system.threading.semaphore.aspx" rel="nofollow">Semaphore</a></li><li><a href="http://msdn.microsoft.com/en-us/library/system.threading.readerwriterlock.aspx" rel="nofollow">ReaderWriterLock</a></li><li><a href="http://msdn.microsoft.com/en-us/library/system.threading.readerwriterlockslim.aspx" rel="nofollow">ReaderWriterLockSlim</a></li><li><a href="http://msdn.microsoft.com/en-us/library/system.threading.interlocked.aspx" rel="nofollow">Interlocked</a></li></ul>  <p>The <code>lock(object)</code> statement is implemented using a <code>Monitor</code>. See <a href="http://msdn.microsoft.com/en-us/library/aa664735%28VS.71%29.aspx" rel="nofollow">MSDN</a> for reference.</p>  <p>In the last years much research is done on <a href="http://en.wikipedia.org/wiki/Non-blocking%5Fsynchronization" rel="nofollow">non-blocking synchronization</a>. The goal is to implement algorithms in a lock-free or wait-free way. In such algorithms a process helps other processes to finish their work so that the process can finally finish its work. In consequence a process can finish its work even when other processes, that tried to perform some work, hang. Usinig locks, they would not release their locks and prevent other processes from continuing.</p> </div>             <table>             <tbody><tr>             <td>                 <div><a href="http://stackoverflow.com/questions/800383/what-is-the-difference-between-mutex-and-critical-section/800492#800492" title="permalink to this answer">link</a>|<a id="flag-post-800492" title="flag this post for serious problems or moderator attention">flag</a></div>                              </td>                          <td align="right">             <div><div>edited <a href="http://stackoverflow.com/posts/800492/revisions" title="show all edits to this post"><span title="2009-04-29 01:45:15Z">Apr 29 '09 at 1:45</span></a></div><div></div></div>             </td>                          <td align="right">             <div><div>answered <span title="2009-04-29 01:14:25Z">Apr 29 '09 at 1:14</span></div><div><a href="http://stackoverflow.com/users/77507/daniel-bruckner"><img src="http://www.gravatar.com/avatar/98816390123972e9a2003fa55c8cac49?s=32&amp;d=identicon&amp;r=PG" alt="" height="32" width="32" /></a></div><div><a href="http://stackoverflow.com/users/77507/daniel-bruckner">Daniel Br&#252;ckner</a><br /><span title="reputation score 18798">18.8k</span><span title="8 silver badges">8</span><span title="37 bronze badges">37</span></div></div>             </td>             </tr>             </tbody></table>         </td>         </tr>           <tr> <td><br /></td> <td>     <div id="comments-800492" dno="">         <table>         <tbody>                      <tr><td><br /></td><td><br /></td></tr>                  </tbody>              </table>     </div>      <br /></td> </tr>         </tbody></table>     </div>      <a name="800400"></a>          <div id="answer-800400">                  <table>         <tbody><tr>         <td>              <div>     <input value="800400" type="hidden" />     <a title="This answer is useful (click again to undo)">up vote</a>     6     <a title="This answer is not useful (click again to undo)">down vote</a>  </div>          </td>         <td>             <div><p>A mutex is an object that a thread can acquire, preventing other threads from acquiring it. It is advisory, not mandatory; a thread can use the resource the mutex represents without acquiring it.</p>  <p>A critical section is a length of code that is guaranteed by the operating system to not be interupted. In pseudo-code, it would be like:</p>  <pre prettyprint=""><code>StartCriticalSection();<br />&nbsp; &nbsp; DoSomethingImportant();<br />&nbsp; &nbsp; DoSomeOtherImportantThing();<br />EndCriticalSection();<br /></code></pre> </div>             <table>             <tbody><tr>             <td>                 <div><a href="http://stackoverflow.com/questions/800383/what-is-the-difference-between-mutex-and-critical-section/800400#800400" title="permalink to this answer">link</a>|<a id="flag-post-800400" title="flag this post for serious problems or moderator attention">flag</a></div>                              </td>                          <td align="right">             <div><div>answered <span title="2009-04-29 00:28:57Z">Apr 29 '09 at 0:28</span></div><div><a href="http://stackoverflow.com/users/83871/zifre"><img src="http://www.gravatar.com/avatar/688da15c29b1fc47987de667a817e82c?s=32&amp;d=identicon&amp;r=PG" alt="" height="32" width="32" /></a></div><div><a href="http://stackoverflow.com/users/83871/zifre">Zifre</a><br /><span title="reputation score">8,701</span><span title="1 gold badge">1</span><span title="18 silver badges">18</span><span title="41 bronze badges">41</span></div></div>             </td>             </tr>             </tbody></table>         </td>         </tr>           <tr> <td><br /></td> <td>     <div id="comments-800400">         <table>         <tbody>                          <tr id="comment-610589">         <td><table><tbody><tr> <td> <span title="number of 'great comment' votes received">1</span> </td> <td> &nbsp; </td></tr> </tbody></table></td>         <td><div>Am I incorrect? I would appreciate it if down voters would comment with a reason. &#8211;&nbsp;<a href="http://stackoverflow.com/users/83871/zifre" title="8701 reputation">Zifre</a> <span title="2009-04-29 01:18:40Z">Apr 29 '09 at 1:18</span></div></td>     </tr>                  <tr id="comment-610594">         <td><br /></td>         <td><div><span>+1 because the down vote confuses me. :p I'd say this is more correct than the statements that hint to Mutex and Critical Section being two different mechanisms for multithreading. Critical section is any section of code which ought to be accessed only by one thread. Using mutexes is one way to implement critical sections.</span> &#8211;&nbsp;<a href="http://stackoverflow.com/users/95157/mikko-rantanen" title="2271 reputation">Mikko Rantanen</a> <span title="2009-04-29 01:22:32Z">Apr 29 '09 at 1:22</span></div></td>     </tr>                  <tr id="comment-610595">         <td><br /></td>         <td><div><span>I think the poster was talking about user mode synchronization primitives, like a win32 Critical section object, which just provides mutual exclusion. I don't know about Linux, but Windows kernel has critical regions which behave like you describe - non-interruptable. </span> &#8211;&nbsp;<a href="http://stackoverflow.com/users/67132/michael" title="21726 reputation">Michael</a> <span title="2009-04-29 01:22:39Z">Apr 29 '09 at 1:22</span></div></td>     </tr>                  <tr id="comment-610596">         <td><br /></td>         <td><div><span>I don't know why you got downvoted.  There's the <em>concept</em> of a critical section, which you've described correctly, which is different from the Windows kernel object called a CriticalSection, which is a type of mutex. I believe the OP was asking about the latter definition.</span> &#8211;&nbsp;<a href="http://stackoverflow.com/users/9530/adam-rosenfield" title="55548 reputation">Adam Rosenfield</a> <span title="2009-04-29 01:22:50Z">Apr 29 '09 at 1:22</span></div></td>     </tr>                  <tr id="comment-610603">         <td><br /></td>         <td><div><span>At least I got confused by the language agnostic tag. But in any case this is what we get for Microsoft naming their implementation the same as their base class. Bad coding practice!</span> &#8211;&nbsp;<a href="http://stackoverflow.com/users/95157/mikko-rantanen" title="2271 reputation">Mikko Rantanen</a> <span title="2009-04-29 01:27:55Z">Apr 29 '09 at 1:27</span></div></td>     </tr>          </tbody>              </table>     </div>     <a id="comments-link-800400" title="expand to show all comments on this post">show <strong>1</strong> more comment</a> </td> </tr>         </tbody></table>     </div>      <a name="800406"></a>          <div id="answer-800406">                  <table>         <tbody><tr>         <td>              <div>     <input value="800406" type="hidden" />     <a title="This answer is useful (click again to undo)">up vote</a>     5     <a title="This answer is not useful (click again to undo)">down vote</a>  </div>          </td>         <td>             <div><p>Critical Section and Mutex are not Operating system specific, their concepts of multithreading/multiprocessing. </p>  <p><strong>Critical Section</strong> Is a piece of code that must only run by it self at any given time (for example, there are 5 threads running simultaneously and a function called "critical_section_function" which updates a array... you don't want all 5 threads updating the array at once. So when the program is running critical_section_function(), none of the other threads must run their critical_section_function. </p>  <p><strong>mutex*</strong> Mutex is a way of implementing the critical section code (think of it like a token... the thread must have possession of it to run the critical_section_code)</p> </div>             <table>             <tbody><tr>             <td>                 <div><a href="http://stackoverflow.com/questions/800383/what-is-the-difference-between-mutex-and-critical-section/800406#800406" title="permalink to this answer">link</a>|<a id="flag-post-800406" title="flag this post for serious problems or moderator attention">flag</a></div>                              </td>                          <td align="right">             <div><div>answered <span title="2009-04-29 00:31:45Z">Apr 29 '09 at 0:31</span></div><div><a href="http://stackoverflow.com/users/96723/the-unknown"><img src="http://www.gravatar.com/avatar/d17a6f29c1afac6da7fe5949b066334c?s=32&amp;d=identicon&amp;r=PG" alt="" height="32" width="32" /></a></div><div><a href="http://stackoverflow.com/users/96723/the-unknown">The Unknown</a><br /><span title="reputation score">782</span><span title="8 silver badges">8</span><span title="33 bronze badges">33</span></div></div>             </td>             </tr>             </tbody></table>         </td>         </tr>           <tr> <td><br /></td> <td>     <div id="comments-800406">         <table>         <tbody>                          <tr id="comment-610568">         <td><br /></td>         <td><div>Also, mutexes can be shared across processes. &#8211;&nbsp;<a href="http://stackoverflow.com/users/9536/configurator" title="5347 reputation">configurator</a> <span title="2009-04-29 01:07:50Z">Apr 29 '09 at 1:07</span></div></td>     </tr>          </tbody>              </table>     </div>      </td> </tr>         </tbody></table>     </div>      <a name="800392"></a>          <div id="answer-800392">                  <table>         <tbody><tr>         <td>              <div>     <input value="800392" type="hidden" />     <a title="This answer is useful (click again to undo)">up vote</a>     4     <a title="This answer is not useful (click again to undo)">down vote</a>  </div>          </td>         <td>             <div><p>In Windows, a critical section is local to your process. A mutex can be shared/accessed across processes. Basically, critical sections are much cheaper. Can't comment on Linux specifically, but on some systems they're just aliases for the same thing.</p> </div>             <table>             <tbody><tr>             <td>                 <div><a href="http://stackoverflow.com/questions/800383/what-is-the-difference-between-mutex-and-critical-section/800392#800392" title="permalink to this answer">link</a>|<a id="flag-post-800392" title="flag this post for serious problems or moderator attention">flag</a></div>                              </td>                          <td align="right">             <div><div>answered <span title="2009-04-29 00:25:45Z">Apr 29 '09 at 0:25</span></div><div><a href="http://stackoverflow.com/users/91405/promit"><img src="http://www.gravatar.com/avatar/0a53e788a9f8c852a97d12a1fa13f852?s=32&amp;d=identicon&amp;r=PG" alt="" height="32" width="32" /></a></div><div><a href="http://stackoverflow.com/users/91405/promit">Promit</a><br /><span title="reputation score">2,023</span><span title="3 silver badges">3</span><span title="19 bronze badges">19</span></div></div>             </td>             </tr>             </tbody></table>         </td>         </tr>           <tr> <td><br /></td> <td>     <div id="comments-800392" dno="">         <table>         <tbody>                      <tr><td><br /></td><td><br /></td></tr>                  </tbody>              </table>     </div>      <br /></td> </tr>         </tbody></table>     </div>      <a name="800475"></a>          <div id="answer-800475">                  <table>         <tbody><tr>         <td>              <div>     <input value="800475" type="hidden" />     <a title="This answer is useful (click again to undo)">up vote</a>     3     <a title="This answer is not useful (click again to undo)">down vote</a>  </div>          </td>         <td>             <div><p>In addition to the other answers, the following details are specific to critical sections on windows:</p>  <ul><li>in the absence of contention, acquiring a critical section is as simple as an <code>InterlockedCompareExchange</code> operation</li><li>the critical section structure holds room for a mutex. It is initially unallocated</li><li>if there is contention between threads for a critical section, the mutex will be allocated and used. The performance of the critical section will degrade to that of the mutex</li><li>if you anticipate high contention, you can allocate the critical section specifying a spin count.</li><li>if there is contention on a critical section with a spin count, the thread attempting to acquire the critical section will spin (busy-wait) for that many processor cycles. This can result in better performance than sleeping, as the number of cycles to perform a context switch to another thread can be much higher than the number of cycles taken by the owning thread to release the mutex</li><li>if the spin count expires, the mutex will be allocated</li><li>when the owning thread releases the critical section, it is required to check if the mutex is allocated, if it is then it will set the mutex to release a waiting thread</li></ul>  <p>In linux, I think that they have a "spin lock" that serves a similar purpose to the critical section with a spin count.</p> </div>             <table>             <tbody><tr>             <td>                 <div><a href="http://stackoverflow.com/questions/800383/what-is-the-difference-between-mutex-and-critical-section/800475#800475" title="permalink to this answer">link</a>|<a id="flag-post-800475" title="flag this post for serious problems or moderator attention">flag</a></div>                              </td>                          <td align="right">             <div><div>answered <span title="2009-04-29 01:03:14Z">Apr 29 '09 at 1:03</span></div><div><a href="http://stackoverflow.com/users/3146/1800-information"><img src="http://www.gravatar.com/avatar/acc637690f49e2b5a2146deb17874d6f?s=32&amp;d=identicon&amp;r=PG" alt="" height="32" width="32" /></a></div><div><a href="http://stackoverflow.com/users/3146/1800-information">1800 INFORMATION</a><br /><span title="reputation score 28617">28.6k</span><span title="2 gold badges">2</span><span title="33 silver badges">33</span><span title="96 bronze badges">96</span></div></div>             </td>             </tr>             </tbody></table>         </td>         </tr>           <tr> <td><br /></td> <td>     <div id="comments-800475">         <table>         <tbody>                          <tr id="comment-610578">         <td><br /></td>         <td><div><span>Unfortunately a Window critical section involves doing a CAS operation <em>in kernel mode</em>, which is massively more expensive than the actual interlocked operation. Also, Windows critical sections can have spin counts associated with them.</span> &#8211;&nbsp;<a href="http://stackoverflow.com/users/91405/promit" title="2023 reputation">Promit</a> <span title="2009-04-29 01:10:55Z">Apr 29 '09 at 1:10</span></div></td>     </tr>                  <tr id="comment-610581">         <td><br /></td>         <td><div><span>That is definitly not true.  CAS can be done with cmpxchg in user mode.</span> &#8211;&nbsp;<a href="http://stackoverflow.com/users/67132/michael" title="21726 reputation">Michael</a> <span title="2009-04-29 01:12:49Z">Apr 29 '09 at 1:12</span></div></td>     </tr>                  <tr id="comment-610598">         <td><br /></td>         <td><div><span>I thought the default spin count was zero if you called InitializeCriticalSection - you have to call InitializeCriticalSectionAndSpinCount if you want a spin count applied. Do you have a reference for that?</span> &#8211;&nbsp;<a href="http://stackoverflow.com/users/3146/1800-information" title="28617 reputation">1800 INFORMATION</a> <span title="2009-04-29 01:24:11Z">Apr 29 '09 at 1:24</span></div></td>     </tr>          </tbody>              </table>     </div>      </td> </tr>         </tbody></table>     </div>      <a name="800538"></a>          <div id="answer-800538">                  <table>         <tbody><tr>         <td>              <div>     <input value="800538" type="hidden" />     <a title="This answer is useful (click again to undo)">up vote</a>     2     <a title="This answer is not useful (click again to undo)">down vote</a>  </div>          </td>         <td>             <div><p>The 'fast' Windows equal of critical selection in Linux would be a <a href="http://linux.die.net/man/2/futex" rel="nofollow">futex</a>, which stands for fast user space mutex. The difference between a futex and a mutex is that with a futex, the kernel only becomes involved when arbitration is required, so you save the overhead of talking to the kernel each time the atomic counter is modified. A futex can also be shared amongst processes, using the means you would employ to share a mutex.</p>  <p>Unfortunately, futexes can be <a href="http://people.redhat.com/drepper/futex.pdf" rel="nofollow">very tricky to implement</a> (PDF).</p>  <p>Beyond that, its pretty much the same across both platforms. You're making atomic, token driven updates to a shared structure in a manner that (hopefully) does not cause starvation. What remains is simply the method of accomplishing that.</p> </div>             <table>             <tbody><tr>             <td>                 <div><a href="http://stackoverflow.com/questions/800383/what-is-the-difference-between-mutex-and-critical-section/800538#800538" title="permalink to this answer">link</a>|<a id="flag-post-800538" title="flag this post for serious problems or moderator attention">flag</a></div>                              </td>                          <td align="right">             <div><div>edited <a href="http://stackoverflow.com/posts/800538/revisions" title="show all edits to this post"><span title="2009-04-29 14:57:12Z">Apr 29 '09 at 14:57</span></a></div><div></div></div>             </td>                          <td align="right">             <div><div>answered <span title="2009-04-29 01:38:11Z">Apr 29 '09 at 1:38</span></div><div><a href="http://stackoverflow.com/users/50049/tim-post"><img src="http://www.gravatar.com/avatar/84432a12912341ff38e157b3d2f4d145?s=32&amp;d=identicon&amp;r=PG" alt="" height="32" width="32" /></a></div><div><a href="http://stackoverflow.com/users/50049/tim-post">Tim Post</a><br /><span title="reputation score 12000">12k</span><span title="1 gold badge">1</span><span title="17 silver badges">17</span><span title="48 bronze badges">48</span></div></div>             </td>             </tr>             </tbody></table>         </td>         </tr>           <tr> <td><br /></td> <td>     <div id="comments-800538" dno="">         <table>         <tbody>                      <tr><td><br /></td><td><br /></td></tr>                  </tbody>              </table>     </div>      <br /></td> </tr>         </tbody></table>     </div>      <a name="800533"></a>                                     <table><tbody><tr>         <td>              <div>     <input value="800533" type="hidden" />     <a title="This answer is useful (click again to undo)">up vote</a>     1     <a title="This answer is not useful (click again to undo)">down vote</a>  </div>          </td>         <td>             <div><p>Just to add my 2 cents, critical Sections are defined as a structure and operations on them are performed in user-mode context.</p>  <pre>ntdll!_RTL_CRITICAL_SECTION<br />   +0x000 DebugInfo        : Ptr32 _RTL_CRITICAL_SECTION_DEBUG<br />   +0x004 LockCount        : Int4B<br />   +0x008 RecursionCount   : Int4B<br />   +0x00c OwningThread     : Ptr32 Void<br />   +0x010 LockSemaphore    : Ptr32 Void<br />   +0x014 SpinCount        : Uint4B<br /></pre>  <p>Whereas mutex are kernel objects (ExMutantObjectType) created in the Windows object directory. Mutex operations are mostly implemented in kernel-mode. For instance, when creating a Mutex, you end up calling nt!NtCreateMutant in kernel.</p> </div>             <table>             <tbody><tr>             <td>                 <div><a href="http://stackoverflow.com/questions/800383/what-is-the-difference-between-mutex-and-critical-section/800533#800533" title="permalink to this answer">link</a>|<a id="flag-post-800533" title="flag this post for serious problems or moderator attention">flag</a></div>                              </td>                          <td align="right">             <div><div>answered <span title="2009-04-29 01:34:45Z">Apr 29 '09 at 1:34</span></div><div><a href="http://stackoverflow.com/users/97110/martin"><img src="http://www.gravatar.com/avatar/1150620b0d89cacb052af4eb070205a4?s=32&amp;d=identicon&amp;r=PG" alt="" height="32" width="32" /></a></div><div><a href="http://stackoverflow.com/users/97110/martin">Martin</a><br /><span title="reputation score">41</span><span title="1 bronze badge">1</span></div></div>             </td>             </tr>             </tbody></table>         </td>         </tr>           <tr> <td><br /></td> <td>     <div id="comments-800533">         <table>         <tbody>                          <tr id="comment-1492172">         <td><br /></td>         <td><div><span>What happens when a program that initializes and uses a Mutex object, crashes? Does the Mutex object gets automatically deallocated? No, I would say. Right?</span> &#8211;&nbsp;<a href="http://stackoverflow.com/users/120800/ankur" title="394 reputation">Ankur</a> <span title="2009-10-26 12:30:42Z">Oct 26 '09 at 12:30</span></div></td>     </tr>                  <tr id="comment-1640570">         <td><table><tbody><tr> <td> <span title="number of 'great comment' votes received">2</span> </td> <td> &nbsp; </td></tr> </tbody></table></td>         <td><div><span>Kernel objects have a reference count. Closing a handle to an object decrements the reference count and when it reaches 0 the object is freed. When a process crashes, all of its handles are automatically closed, so a mutex that only that process has a handle to would be automatically deallocated.</span> &#8211;&nbsp;<a href="http://stackoverflow.com/users/67132/michael" title="21726 reputation">Michael</a> <span title="2009-11-18 17:19:55Z">Nov 18 '09 at 17:19</span></div></td></tr></tbody></table></div></td></tr></tbody></table></div></div><p><br /></p><p><div>http://stackoverflow.com/questions/800383/what-is-the-difference-between-mutex-and-critical-section</div>&nbsp;</p>