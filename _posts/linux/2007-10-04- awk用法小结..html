<P><BR>&nbsp;awk用法小结<BR><A href="http://www.chinaunix.net/jh/24/691456.html">http://www.chinaunix.net/jh/24/691456.html</A></P>
<P>awk 用法：awk ' pattern {action} '&nbsp; </P>
<P>变量名 含义 <BR>ARGC 命令行变元个数 <BR>ARGV 命令行变元数组 <BR>FILENAME 当前输入文件名 <BR>FNR 当前文件中的记录号 <BR>FS 输入域分隔符，默认为一个空格 <BR>RS 输入记录分隔符 <BR>NF 当前记录里域个数 <BR>NR 到目前为止记录数 <BR>OFS 输出域分隔符 <BR>ORS 输出记录分隔符 </P>
<P>1、awk '/101/'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file 显示文件file中包含101的匹配行。 <BR>&nbsp;&nbsp; awk '/101/,/105/'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file <BR>&nbsp;&nbsp; awk '$1 == 5'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file <BR>&nbsp;&nbsp; awk '$1 == "CT"'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file 注意必须带双引号 <BR>&nbsp;&nbsp; awk '$1 * $2 &gt;100 '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file&nbsp; <BR>&nbsp;&nbsp; awk '$2 &gt;5 &amp;&amp; $2&lt;=15'&nbsp;&nbsp;&nbsp;&nbsp; file <BR>2、awk '{print NR,NF,$1,$NF,}' file 显示文件file的当前记录号、域数和每一行的第一个和最后一个域。 <BR>&nbsp;&nbsp; awk '/101/ {print $1,$2 + 10}' file 显示文件file的匹配行的第一、二个域加10。 <BR>&nbsp;&nbsp; awk '/101/ {print $1$2}'&nbsp; file <BR>&nbsp;&nbsp; awk '/101/ {print $1 $2}' file 显示文件file的匹配行的第一、二个域，但显示时域中间没有分隔符。 <BR>3、df | awk '$4&gt;1000000 '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 通过管道符获得输入，如：显示第4个域满足条件的行。 <BR>4、awk -F "|" '{print $1}'&nbsp;&nbsp; file 按照新的分隔符“|”进行操作。 <BR>&nbsp;&nbsp; awk&nbsp; 'BEGIN { FS="[: \t|]" } <BR>&nbsp;&nbsp; {print $1,$2,$3}'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file 通过设置输入分隔符（FS="[: \t|]"）修改输入分隔符。 </P>
<P>&nbsp;&nbsp; Sep="|" <BR>&nbsp;&nbsp; awk -F $Sep '{print $1}'&nbsp; file 按照环境变量Sep的值做为分隔符。&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp; awk -F '[ :\t|]' '{print $1}' file 按照正则表达式的值做为分隔符，这里代表空格、:、TAB、|同时做为分隔符。 <BR>&nbsp;&nbsp; awk -F '[][]'&nbsp;&nbsp;&nbsp; '{print $1}' file 按照正则表达式的值做为分隔符，这里代表[、] <BR>5、awk -f awkfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file 通过文件awkfile的内容依次进行控制。 <BR>&nbsp;&nbsp; cat awkfile <BR>/101/{print "\047 Hello! \047"} --遇到匹配行以后打印 ' Hello! '.\047代表单引号。 <BR>{print $1,$2}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --因为没有模式控制，打印每一行的前两个域。 <BR>6、awk '$1 ~ /101/ {print $1}' file 显示文件中第一个域匹配101的行（记录）。 <BR>7、awk&nbsp;&nbsp; 'BEGIN { OFS="%"} <BR>&nbsp;&nbsp; {print $1,$2}'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file 通过设置输出分隔符（OFS="%"）修改输出格式。 <BR>8、awk&nbsp;&nbsp; 'BEGIN { max=100 ;print "max=" max}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BEGIN 表示在处理任意行之前进行的操作。 <BR>&nbsp;&nbsp; {max=($1 &gt;max ?$1:max); print $1,"Now max is "max}' file 取得文件第一个域的最大值。 <BR>&nbsp;&nbsp; （表达式1?表达式2:表达式3 相当于： <BR>&nbsp;&nbsp; if (表达式1) <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 表达式2 <BR>&nbsp;&nbsp; else <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 表达式3 <BR>&nbsp;&nbsp; awk '{print ($1&gt;4 ? "high "$1: "low "$1)}' file&nbsp; <BR>9、awk '$1 * $2 &gt;100 {print $1}' file 显示文件中第一个域匹配101的行（记录）。 <BR>10、awk '{$1 == 'Chi' {$3 = 'China'; print}' file 找到匹配行后先将第3个域替换后再显示该行（记录）。 <BR>&nbsp;&nbsp;&nbsp; awk '{$7 %= 3; print $7}'&nbsp; file 将第7域被3除，并将余数赋给第7域再打印。 <BR>11、awk '/tom/ {wage=$2+$3; printf wage}' file 找到匹配行后为变量wage赋值并打印该变量。 <BR>12、awk '/tom/ {count++;}&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END {print "tom was found "count" times"}' file END表示在所有输入行处理完后进行处理。 <BR>13、awk 'gsub(/\$/,"");gsub(/,/,""); cost+=$4; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END {print "The total is $" cost&gt;"filename"}'&nbsp;&nbsp;&nbsp; file gsub函数用空串替换$和,再将结果输出到filename中。 <BR>&nbsp;&nbsp;&nbsp; 1 2 3 $1,200.00 <BR>&nbsp;&nbsp;&nbsp; 1 2 3 $2,300.00 <BR>&nbsp;&nbsp;&nbsp; 1 2 3 $4,000.00 </P>
<P>&nbsp;&nbsp;&nbsp; awk '{gsub(/\$/,"");gsub(/,/,""); <BR>&nbsp;&nbsp;&nbsp; if ($4&gt;1000&amp;&amp;$4&lt;2000) c1+=$4; <BR>&nbsp;&nbsp;&nbsp; else if ($4&gt;2000&amp;&amp;$4&lt;3000) c2+=$4; <BR>&nbsp;&nbsp;&nbsp; else if ($4&gt;3000&amp;&amp;$4&lt;4000) c3+=$4; <BR>&nbsp;&nbsp;&nbsp; else c4+=$4; } <BR>&nbsp;&nbsp;&nbsp; END {printf&nbsp; "c1=[%d];c2=[%d];c3=[%d];c4=[%d]\n",c1,c2,c3,c4}"' file <BR>&nbsp;&nbsp;&nbsp; 通过if和else if完成条件语句 </P>
<P>&nbsp;&nbsp;&nbsp; awk '{gsub(/\$/,"");gsub(/,/,""); <BR>&nbsp;&nbsp;&nbsp; if ($4&gt;3000&amp;&amp;$4&lt;4000) exit; <BR>&nbsp;&nbsp;&nbsp; else c4+=$4; } <BR>&nbsp;&nbsp;&nbsp; END {printf&nbsp; "c1=[%d];c2=[%d];c3=[%d];c4=[%d]\n",c1,c2,c3,c4}"' file <BR>&nbsp;&nbsp;&nbsp; 通过exit在某条件时退出，但是仍执行END操作。 <BR>&nbsp;&nbsp;&nbsp; awk '{gsub(/\$/,"");gsub(/,/,""); <BR>&nbsp;&nbsp;&nbsp; if ($4&gt;3000) next; <BR>&nbsp;&nbsp;&nbsp; else c4+=$4; } <BR>&nbsp;&nbsp;&nbsp; END {printf&nbsp; "c4=[%d]\n",c4}"' file <BR>&nbsp;&nbsp;&nbsp; 通过next在某条件时跳过该行，对下一行执行操作。 </P>
<P><BR>14、awk '{ print FILENAME,$0 }' file1 file2 file3&gt;fileall 把file1、file2、file3的文件内容全部写到fileall中，格式为 <BR>&nbsp;&nbsp;&nbsp; 打印文件并前置文件名。 <BR>15、awk ' $1!=previous { close(previous); previous=$1 }&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp; {print substr($0,index($0," ") +1)&gt;$1}' fileall 把合并后的文件重新分拆为3个文件。并与原文件一致。 <BR>16、awk 'BEGIN {"date"|getline d; print d}'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 通过管道把date的执行结果送给getline，并赋给变量d，然后打印。&nbsp; <BR>17、awk 'BEGIN {system("echo \"Input your name:\\c\""); getline d;print "\nYour name is",d,"\b!\n"}' <BR>&nbsp;&nbsp;&nbsp; 通过getline命令交互输入name，并显示出来。 <BR>&nbsp;&nbsp;&nbsp; awk 'BEGIN {FS=":"; while(getline&lt; "/etc/passwd" &gt;0) { if($1~"050[0-9]_") print $1}}' <BR>&nbsp;&nbsp;&nbsp; 打印/etc/passwd文件中用户名包含050x_的用户名。 </P>
<P>18、awk '{ i=1;while(i&lt;NF) {print NF,$i;i++}}' file 通过while语句实现循环。 <BR>&nbsp;&nbsp;&nbsp; awk '{ for(i=1;i&lt;NF;i++) {print NF,$i}}'&nbsp;&nbsp; file 通过for语句实现循环。&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp; type file|awk -F "/" ' <BR>&nbsp;&nbsp;&nbsp; { for(i=1;i&lt;NF;i++) <BR>&nbsp;&nbsp;&nbsp; { if(i==NF-1) { printf "%s",$i } <BR>&nbsp;&nbsp;&nbsp; else { printf "%s/",$i } }}'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 显示一个文件的全路径。 <BR>&nbsp;&nbsp;&nbsp; 用for和if显示日期 <BR>&nbsp;&nbsp;&nbsp; awk&nbsp; 'BEGIN { <BR>for(j=1;j&lt;=12;j++) <BR>{ flag=0; <BR>&nbsp; printf "\n%d月份\n",j; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(i=1;i&lt;=31;i++) <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (j==2&amp;&amp;i&gt;28) flag=1; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((j==4||j==6||j==9||j==11)&amp;&amp;i&gt;30) flag=1; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (flag==0) {printf "%02d%02d ",j,i} <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <BR>} <BR>}' <BR>19、在awk中调用系统变量必须用单引号，如果是双引号，则表示字符串 <BR>Flag=abcd <BR>awk '{print '$Flag'}'&nbsp;&nbsp; 结果为abcd <BR>awk '{print&nbsp; "$Flag"}'&nbsp;&nbsp; 结果为$Flag</P>
<P><BR>&nbsp;</P>