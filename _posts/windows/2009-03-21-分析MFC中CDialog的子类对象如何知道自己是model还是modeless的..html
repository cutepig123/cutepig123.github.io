DoModal源代码关键部分如下<br><div class="cnblogs_code"><!--<br><br>Code highlighting produced by Actipro CodeHighlighter (freeware)<br>http://www.CodeHighlighter.com/<br><br>--><span style="color: rgb(0, 128, 128);">&nbsp;1</span><img src="https://www.cnblogs.com/images/OutliningIndicators/None.gif" align="top"><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">&nbsp;(CreateDlgIndirect(lpDialogTemplate,<br></span><span style="color: rgb(0, 128, 128);">&nbsp;2</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/None.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CWnd::FromHandle(hWndParent),&nbsp;hInst))<br></span><span style="color: rgb(0, 128, 128);">&nbsp;3</span><span style="color: rgb(0, 0, 0);"><img id="Codehighlighter1_86_312_Open_Image" src="https://www.cnblogs.com/images/OutliningIndicators/ExpandedBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_86_312_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_86_312_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_86_312_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_86_312_Closed_Image" src="https://www.cnblogs.com/images/OutliningIndicators/ContractedBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_86_312_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_86_312_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_86_312_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_86_312_Closed_Text" style="border: 1px solid rgb(128, 128, 128); background-color: rgb(255, 255, 255); display: none;"><img src="https://www.cnblogs.com/images/dot.gif"></span><span id="Codehighlighter1_86_312_Open_Text"><span style="color: rgb(0, 0, 0);">{<br></span><span style="color: rgb(0, 128, 128);">&nbsp;4</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">&nbsp;(m_nFlags&nbsp;</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">&nbsp;WF_CONTINUEMODAL)<br></span><span style="color: rgb(0, 128, 128);">&nbsp;5</span><span style="color: rgb(0, 0, 0);"><img id="Codehighlighter1_127_312_Open_Image" src="https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_127_312_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_127_312_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_127_312_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_127_312_Closed_Image" src="https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_127_312_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_127_312_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_127_312_Open_Text').style.display='inline';" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_127_312_Closed_Text" style="border: 1px solid rgb(128, 128, 128); background-color: rgb(255, 255, 255); display: none;"><img src="https://www.cnblogs.com/images/dot.gif"></span><span id="Codehighlighter1_127_312_Open_Text"><span style="color: rgb(0, 0, 0);">{<br></span><span style="color: rgb(0, 128, 128);">&nbsp;6</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">&nbsp;enter&nbsp;modal&nbsp;loop</span><span style="color: rgb(0, 128, 0);"><br></span><span style="color: rgb(0, 128, 128);">&nbsp;7</span><span style="color: rgb(0, 128, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;dwFlags&nbsp;</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;MLF_SHOWONIDLE;<br></span><span style="color: rgb(0, 128, 128);">&nbsp;8</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">&nbsp;(GetStyle()&nbsp;</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">&nbsp;DS_NOIDLEMSG)<br></span><span style="color: rgb(0, 128, 128);">&nbsp;9</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwFlags&nbsp;</span><span style="color: rgb(0, 0, 0);">|=</span><span style="color: rgb(0, 0, 0);">&nbsp;MLF_NOIDLEMSG;<br></span><span style="color: rgb(0, 128, 128);">10</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VERIFY(RunModalLoop(dwFlags)&nbsp;</span><span style="color: rgb(0, 0, 0);">==</span><span style="color: rgb(0, 0, 0);">&nbsp;m_nModalResult);<br></span><span style="color: rgb(0, 128, 128);">11</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/ExpandedBlockEnd.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></span></div><br>相对于CDialog的Create，DoModal多了一个<span id="Codehighlighter1_86_312_Open_Text"><span id="Codehighlighter1_127_312_Open_Text"><span style="color: rgb(0, 0, 0);">RunModalLoop()这么一个消息循环（当然也有一些别的，比如在创建窗口之前disable父窗口）。因此关键在这个函数里，看进去，在文件VC\atlmfc\src\mfc\wincore.cpp里<br><div class="cnblogs_code"><!--<br><br>Code highlighting produced by Actipro CodeHighlighter (freeware)<br>http://www.CodeHighlighter.com/<br><br>--><span style="color: rgb(0, 128, 128);">&nbsp;1</span><img src="https://www.cnblogs.com/images/OutliningIndicators/None.gif" align="top"><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;CWnd::RunModalLoop(DWORD&nbsp;dwFlags)<br></span><span style="color: rgb(0, 128, 128);">&nbsp;2</span><span style="color: rgb(0, 0, 0);"><img id="Codehighlighter1_38_637_Open_Image" src="https://www.cnblogs.com/images/OutliningIndicators/ExpandedBlockStart.gif" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_38_637_Open_Text').style.display='none'; document.getElementById('Codehighlighter1_38_637_Closed_Image').style.display='inline'; document.getElementById('Codehighlighter1_38_637_Closed_Text').style.display='inline';" align="top"><img id="Codehighlighter1_38_637_Closed_Image" src="https://www.cnblogs.com/images/OutliningIndicators/ContractedBlock.gif" style="display: none;" onclick="this.style.display='none'; document.getElementById('Codehighlighter1_38_637_Closed_Text').style.display='none'; document.getElementById('Codehighlighter1_38_637_Open_Image').style.display='inline'; document.getElementById('Codehighlighter1_38_637_Open_Text').style.display='inline';" align="top"></span><span id="Codehighlighter1_38_637_Closed_Text" style="border: 1px solid rgb(128, 128, 128); background-color: rgb(255, 255, 255); display: none;"><img src="https://www.cnblogs.com/images/dot.gif"></span><span id="Codehighlighter1_38_637_Open_Text"><span style="color: rgb(0, 0, 0);">{<br></span><span style="color: rgb(0, 128, 128);">&nbsp;3</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(::IsWindow(m_hWnd));&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">&nbsp;window&nbsp;must&nbsp;be&nbsp;created</span><span style="color: rgb(0, 128, 0);"><br></span><span style="color: rgb(0, 128, 128);">&nbsp;4</span><span style="color: rgb(0, 128, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(</span><span style="color: rgb(0, 0, 0);">!</span><span style="color: rgb(0, 0, 0);">(m_nFlags&nbsp;</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">&nbsp;WF_MODALLOOP));&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">&nbsp;window&nbsp;must&nbsp;not&nbsp;already&nbsp;be&nbsp;in&nbsp;modal&nbsp;state<br></span><span style="color: rgb(0, 128, 128);">&nbsp;5</span><span style="color: rgb(0, 128, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top"><br></span><span style="color: rgb(0, 128, 128);">&nbsp;6</span><span style="color: rgb(0, 128, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">&nbsp;for&nbsp;tracking&nbsp;the&nbsp;idle&nbsp;time&nbsp;state</span><span style="color: rgb(0, 128, 0);"><br></span><span style="color: rgb(0, 128, 128);">&nbsp;7</span><span style="color: rgb(0, 128, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;BOOL&nbsp;bIdle&nbsp;</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;TRUE;<br></span><span style="color: rgb(0, 128, 128);">&nbsp;8</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;LONG&nbsp;lIdleCount&nbsp;</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(128, 0, 128);">0</span><span style="color: rgb(0, 0, 0);">;<br></span><span style="color: rgb(0, 128, 128);">&nbsp;9</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;BOOL&nbsp;bShowIdle&nbsp;</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;(dwFlags&nbsp;</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">&nbsp;MLF_SHOWONIDLE)&nbsp;</span><span style="color: rgb(0, 0, 0);">&amp;&amp;</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 0);">!</span><span style="color: rgb(0, 0, 0);">(GetStyle()&nbsp;</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">&nbsp;WS_VISIBLE);<br></span><span style="color: rgb(0, 128, 128);">10</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;HWND&nbsp;hWndParent&nbsp;</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;::GetParent(m_hWnd);<br></span><span style="color: rgb(0, 128, 128);">11</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;m_nFlags&nbsp;</span><span style="color: rgb(0, 0, 0);">|=</span><span style="color: rgb(0, 0, 0);">&nbsp;(WF_MODALLOOP</span><span style="color: rgb(0, 0, 0);">|</span><span style="color: rgb(0, 0, 0);">WF_CONTINUEMODAL);<br></span><span style="color: rgb(0, 128, 128);">12</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;MSG&nbsp;</span><span style="color: rgb(0, 0, 0);">*</span><span style="color: rgb(0, 0, 0);">pMsg&nbsp;</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;AfxGetCurrentMessage();<br></span><span style="color: rgb(0, 128, 128);">13</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top"><br></span><span style="color: rgb(0, 128, 128);">14</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">&nbsp;acquire&nbsp;and&nbsp;dispatch&nbsp;messages&nbsp;until&nbsp;the&nbsp;modal&nbsp;state&nbsp;is&nbsp;done</span><span style="color: rgb(0, 128, 0);"><br></span><span style="color: rgb(0, 128, 128);">15</span><span style="color: rgb(0, 128, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 0, 0);">&nbsp;(;;)<br></span><span style="color: rgb(0, 128, 128);">16</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">。。。。。。for内的消息之类的略掉。。。。<br></span><span style="color: rgb(0, 128, 128);">17</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">ExitModal:<br></span><span style="color: rgb(0, 128, 128);">18</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;m_nFlags&nbsp;</span><span style="color: rgb(0, 0, 0);">&amp;=</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 0);">~</span><span style="color: rgb(0, 0, 0);">(WF_MODALLOOP</span><span style="color: rgb(0, 0, 0);">|</span><span style="color: rgb(0, 0, 0);">WF_CONTINUEMODAL);<br></span><span style="color: rgb(0, 128, 128);">19</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">&nbsp;m_nModalResult;<br></span><span style="color: rgb(0, 128, 128);">20</span><span style="color: rgb(0, 0, 0);"><img src="https://www.cnblogs.com/images/OutliningIndicators/ExpandedBlockEnd.gif" align="top">}</span></span></div><br>看到了吧，</span></span></span><span id="Codehighlighter1_86_312_Open_Text"><span id="Codehighlighter1_127_312_Open_Text"><span style="color: rgb(0, 0, 0);"><span id="Codehighlighter1_38_637_Open_Text"><span style="color: rgb(0, 0, 0);">m_nFlags&nbsp;</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">&nbsp;WF_MODALLOOP就是用来判断本dialog是用DoModal还是直接Create创建的。<br>如果为true表示为model否则为modeless<br>注意：以上仅为现在MFC中CDialog中可用，其他lib，如WTL并不通用<br></span></span></span></span></span>