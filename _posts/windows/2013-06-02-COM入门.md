---
categories: windows
---
<p>1. 定义CLSID_IExample和IID_IExample，分别作为实现类(coclass)和接口类的id<br />2. 声明接口IExample，从IUnknown继承<br />STDMETHOD&nbsp; (QueryInterface)&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;(THIS_ REFIID, void **) PURE;<br />STDMETHOD_ (ULONG, AddRef)&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;(THIS) PURE;<br />STDMETHOD_ (ULONG, Release)&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;(THIS) PURE;<br />STDMETHOD&nbsp; (SetString)&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;(THIS_ char *) PURE;<br />STDMETHOD&nbsp; (GetString)&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;(THIS_ char *, DWORD) PURE;<br /><br />3. 实现接口IExample类MyRealIExample<br />4. 实现接口IClassFactory<br />HRESULT STDMETHODCALLTYPE QueryInterface( REFIID factoryGuid, void **ppv)<br />ULONG STDMETHODCALLTYPE AddRef()<br />ULONG STDMETHODCALLTYPE Release()<br />HRESULT STDMETHODCALLTYPE CreateInstance(IUnknown *punkOuter, REFIID vTableGuid, void **objHandle)<br />HRESULT STDMETHODCALLTYPE LockServer(BOOL flock)<br />5. 实现函数<br />HRESULT PASCAL DllGetClassObject(REFCLSID objGuid, REFIID factoryGuid, void **factoryHandle)<br />HRESULT PASCAL DllCanUnloadNow(void)<br />STDAPI DllRegisterServer() （可选）<br />6. 导出函数<br />DllCanUnloadNow&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;PRIVATE<br />DllGetClassObject&nbsp;&nbsp; &nbsp;PRIVATE<br />DllRegisterServer&nbsp;&nbsp; &nbsp;PRIVATE</p>
<p>参考教程<br />http://www.codeproject.com/Articles/13601/COM-in-plain-C#CLASS<br />http://antonio.cz/static/com/5.html<br /><br /></p>
<p><strong>Q&amp;A</strong></p>
<p>coclass？？<br />coclass (short for component object class) is contained in a DLL or EXE, and contains the code behind one or more interfaces. The coclass is said to implement those interfaces. <br /><br />GUID??<br />globally unique identifier&nbsp; GUIDs are COM's language-independent way of identifying things. Each interface and coclass has a GUID.<br /><br />UUID??<br />(which stands for universally unique identifier) at times. UUIDs and GUIDs are, for all practical purposes, the same.<br /><br />class ID, or CLSID, is a GUID that names a coclass. An interface ID, or IID, is a GUID that names an interface.<br /><br />def file: PRIVATE?<br /><br />COM ThreadingModel?<br /><br />__declspec(novtable)？?<br /><br />DECLSPEC_SELECTANY？?</p>