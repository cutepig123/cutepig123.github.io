<p>function []= SolarPlotJS()<br />fp=fopen('1.txt','r')<br />%rootpath = strtrim(fscanf(fp,'%s\n'))<br /><br />while ~feof(fp)<br />&nbsp;&nbsp; &nbsp;s = strtrim(fgets(fp))<br />&nbsp;&nbsp; &nbsp;if max(size(s))&gt;10<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;SolarPlot(s)<br />&nbsp;&nbsp; &nbsp;end<br />end<br /><br />fclose(fp)<br /><br />function dest = getDest(s)<br /><br />&nbsp;&nbsp;&nbsp; splitPos = findstr(s, '\');<br />&nbsp;&nbsp;&nbsp; n = max(size(splitPos));<br />&nbsp;&nbsp;&nbsp; p=splitPos(n-1);<br />&nbsp;&nbsp;&nbsp; p2=max(size(s));<br />&nbsp;&nbsp;&nbsp; aa = strrep(s(p+1:p2), '\','_');<br />&nbsp;&nbsp;&nbsp; dest = sprintf( '%s\%s', s(1:p),aa&nbsp; );<br />&nbsp;&nbsp; &nbsp;<br />function []= SolarPlot(Path)<br />%for i= 1:length(PathArray)<br />&nbsp;&nbsp;&nbsp; close all;<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp;&nbsp; dest = getDest(Path);<br />&nbsp;&nbsp;&nbsp; %Path = PathArray{i};<br />&nbsp;&nbsp;&nbsp; % thickness range, keep display range 200um<br />&nbsp;&nbsp;&nbsp; offtp = 0;<br />&nbsp;&nbsp;&nbsp; offbm = 0;<br />&nbsp;&nbsp;&nbsp; offTh = 0;<br />&nbsp;&nbsp;&nbsp; minTh = 110 + offTh;<br />&nbsp;&nbsp;&nbsp; maxTh = 280 + offTh;<br />&nbsp;&nbsp;&nbsp; mintp =&nbsp; 100 + offtp;<br />&nbsp;&nbsp;&nbsp; maxtp =&nbsp; 350 + offtp;<br />&nbsp;&nbsp;&nbsp; minbm = -100 + offbm;<br />&nbsp;&nbsp;&nbsp; maxbm =&nbsp; 150 + offbm;<br />&nbsp;&nbsp;&nbsp; %<br />&nbsp;&nbsp;&nbsp; % minTh = 160 + offTh<br />&nbsp;&nbsp;&nbsp; % maxTh = 500 + offTh<br />&nbsp;&nbsp;&nbsp; % mintp =&nbsp; 100 + offtp<br />&nbsp;&nbsp;&nbsp; % maxtp =&nbsp; 450 + offtp%<br />&nbsp;&nbsp;&nbsp; % minbm = -100 + offbm<br />&nbsp;&nbsp;&nbsp; % maxbm =&nbsp; 100 + offbm<br />&nbsp;&nbsp;&nbsp; % minTh =&nbsp; 0<br />&nbsp;&nbsp;&nbsp; % maxTh =&nbsp; 600<br />&nbsp;&nbsp;&nbsp; % mintp =&nbsp;&nbsp; 0<br />&nbsp;&nbsp;&nbsp; % maxtp =&nbsp; 400<br />&nbsp;&nbsp;&nbsp; % minbm = -200<br />&nbsp;&nbsp;&nbsp; % maxbm =&nbsp; 200<br /><br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp;&nbsp; filePath= sprintf('%s\\pair0\\Btm\\deripple.tif', Path);<br />&nbsp;&nbsp;&nbsp; img0b= imread(filePath);<br />&nbsp;&nbsp;&nbsp; coOff(1)= 5;<br />&nbsp;&nbsp;&nbsp; coOff(2)= 65;<br />&nbsp;&nbsp; &nbsp;szOp(1)= size(img0b, 2)-10;<br />&nbsp;&nbsp;&nbsp; szOp(2)= size(img0b, 1)-70;<br /><br />&nbsp;&nbsp;&nbsp; img0b= img0b(coOff(2):(coOff(2)+ szOp(2)), coOff(1):(coOff(1)+ szOp(1)));<br />&nbsp;&nbsp;&nbsp; filePath= sprintf('%s\\pair0\\top\\deripple.tif', Path);<br />&nbsp;&nbsp;&nbsp; img0t= imread(filePath);<br />&nbsp;&nbsp;&nbsp; img0t= img0t(coOff(2):(coOff(2)+ szOp(2)), coOff(1):(coOff(1)+ szOp(1)));<br />&nbsp;&nbsp;&nbsp; filePath= sprintf('%s\\pair1\\Btm\\deripple.tif', Path);<br />&nbsp;&nbsp;&nbsp; img1b= imread(filePath);<br />&nbsp;&nbsp;&nbsp; coOff2(1)= 5;<br />&nbsp;&nbsp;&nbsp; coOff2(2)= 25;<br />&nbsp;&nbsp; &nbsp;szOp2(1)= size(img1b, 2)-10;<br />&nbsp;&nbsp;&nbsp; szOp2(2)= size(img1b, 1)-90;<br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp;&nbsp; img1b= img1b(coOff2(2):(coOff2(2)+ szOp2(2)), coOff2(1):(coOff2(1)+ szOp2(1)));<br />&nbsp;&nbsp;&nbsp; filePath= sprintf('%s\\pair1\\top\\deripple.tif', Path);<br />&nbsp;&nbsp;&nbsp; img1t= imread(filePath);<br />&nbsp;&nbsp;&nbsp; img1t= img1t(coOff2(2):(coOff2(2)+ szOp2(2)), coOff2(1):(coOff2(1)+ szOp2(1)));<br /><br />&nbsp;&nbsp;&nbsp; % 3D surface<br />&nbsp;&nbsp;&nbsp; scrsz = get(0,'ScreenSize');<br />&nbsp;&nbsp;&nbsp; % f1= figure('Position',[1 scrsz(4)/2-300 scrsz(3) scrsz(4)/2]);<br />&nbsp;&nbsp;&nbsp; f1= figure('Position',[1 scrsz(4)/2-300 scrsz(3) scrsz(4)/2]);<br />&nbsp;&nbsp;&nbsp; set(f1,'name','Profile','Numbertitle','off')<br />&nbsp;&nbsp;&nbsp; resX = 27;<br />&nbsp;&nbsp;&nbsp; resY = 117*2;<br />&nbsp;&nbsp;&nbsp; samX = 50;<br />&nbsp;&nbsp;&nbsp; samY = 5;<br /><br /><br />&nbsp;&nbsp;&nbsp; % for thickness, select line cross profile for substraction<br />&nbsp;&nbsp;&nbsp; % idy = [50 100 150]<br />&nbsp;&nbsp;&nbsp; % tiT{1} = sprintf('L-%d',idy(1));<br />&nbsp;&nbsp;&nbsp; % tiT{2} = sprintf('L-%d',idy(2));<br />&nbsp;&nbsp;&nbsp; % tiT{3} = sprintf('L-%d',idy(3));<br /><br />&nbsp;&nbsp;&nbsp; idy = int32(size(img0b,1)/2); %100<br />&nbsp;&nbsp;&nbsp; idx = int32(size(img0b,2)/2);<br />&nbsp;&nbsp;&nbsp; tiy = sprintf('Middle Row');<br />&nbsp;&nbsp;&nbsp; tix = sprintf('Middle Column');<br /><br />&nbsp;&nbsp;&nbsp; % tiy = sprintf('Row-%d',idy);<br />&nbsp;&nbsp;&nbsp; % tix = sprintf('Column-%d',idy);<br /><br /><br />&nbsp;&nbsp;&nbsp; % ti0{1} = sprintf('T0-%d',idy(1));<br />&nbsp;&nbsp;&nbsp; % ti0{2} = sprintf('T0-%d',idy(2));<br />&nbsp;&nbsp;&nbsp; % ti0{3} = sprintf('T0-%d',idy(3));<br />&nbsp;&nbsp;&nbsp; %<br />&nbsp;&nbsp;&nbsp; % ti1{1} = sprintf('T1-%d',idy(1));<br />&nbsp;&nbsp;&nbsp; % ti1{2} = sprintf('T1-%d',idy(2));<br />&nbsp;&nbsp;&nbsp; % ti1{3} = sprintf('T1-%d',idy(3));<br /><br /><br />&nbsp;&nbsp;&nbsp; subplot(2, 2, 1);<br />&nbsp;&nbsp;&nbsp; % imagesc(-img0t, [-300, 300]), title('Pair 0, Top'), colorbar();<br />&nbsp;&nbsp;&nbsp; T = double(-img0t(1:samY:end,1:samX:end));<br />&nbsp;&nbsp;&nbsp; surface('XData',[1:size(T,2)]*resX*samX/1000,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'YData',[1:size(T,1)]*resY*samY/1000,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'ZData',T,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'CData',T);<br />&nbsp;&nbsp;&nbsp; colorbar('NorthOutside');<br />&nbsp;&nbsp;&nbsp; axis tight;<br />&nbsp;&nbsp;&nbsp; xlabel('X (unit:mm)'); xlabel('Y (unit:mm)')<br />&nbsp;&nbsp;&nbsp; zlabel('Z (unit:um)')<br />&nbsp;&nbsp;&nbsp; view(10,60)<br />&nbsp;&nbsp;&nbsp; set(gca, 'fontsize',6)<br />&nbsp;&nbsp;&nbsp; t = title('Pair0, Top');<br />&nbsp;&nbsp;&nbsp; set(t,'fontsize',10)<br />&nbsp;&nbsp;&nbsp; axis([0 size(T,2)*resX*samX/1000 0 size(T,1)*resY*samY/1000&nbsp; mintp maxtp])<br />&nbsp;&nbsp;&nbsp; %<br />&nbsp;&nbsp;&nbsp; subplot(2, 2, 2);<br />&nbsp;&nbsp;&nbsp; % imagesc(-img1t, [-300, 300]), title('Pair 1, Top'), colorbar();<br />&nbsp;&nbsp;&nbsp; T = double(-img1t(1:samY:end,1:samX:end));<br />&nbsp;&nbsp;&nbsp; surface('XData',[1:size(T,2)]*resX*samX/1000,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'YData',[1:size(T,1)]*resY*samY/1000,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'ZData',T,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'CData',T);<br />&nbsp;&nbsp;&nbsp; colorbar('NorthOutside');<br />&nbsp;&nbsp;&nbsp; axis tight;<br />&nbsp;&nbsp;&nbsp; xlabel('X (unit:mm)'); ylabel('Y (unit:mm)')<br />&nbsp;&nbsp;&nbsp; zlabel('Z (unit:um)')<br />&nbsp;&nbsp;&nbsp; view(10,60)<br />&nbsp;&nbsp;&nbsp; set(gca, 'fontsize',6)<br />&nbsp;&nbsp;&nbsp; t = title('Pair1, Top');<br />&nbsp;&nbsp;&nbsp; set(t,'fontsize',10)<br />&nbsp;&nbsp;&nbsp; axis([0 size(T,2)*resX*samX/1000 0 size(T,1)*resY*samY/1000&nbsp; mintp maxtp])<br /><br />&nbsp;&nbsp;&nbsp; %<br />&nbsp;&nbsp;&nbsp; subplot(2, 2, 3);<br />&nbsp;&nbsp;&nbsp; % imagesc(-img0b, [-300, 300]), title('Pair 0, Bottom'), colorbar();<br />&nbsp;&nbsp;&nbsp; T = double(-img0b(1:samY:end,1:samX:end));<br />&nbsp;&nbsp;&nbsp; surface('XData',[1:size(T,2)]*resX*samX/1000,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'YData',[1:size(T,1)]*resY*samY/1000,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'ZData',T,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'CData',T)<br />&nbsp;&nbsp;&nbsp; colorbar('NorthOutside');<br />&nbsp;&nbsp;&nbsp; axis tight;<br />&nbsp;&nbsp;&nbsp; xlabel('X (unit:mm)'); ylabel('Y (unit:mm)')<br />&nbsp;&nbsp;&nbsp; zlabel('Z (unit:um)')<br />&nbsp;&nbsp;&nbsp; view(10,60)<br />&nbsp;&nbsp;&nbsp; set(gca, 'fontsize',6)<br />&nbsp;&nbsp;&nbsp; t = title('Pair0, Bottom')<br />&nbsp;&nbsp;&nbsp; set(t,'fontsize',10)<br />&nbsp;&nbsp;&nbsp; axis([0 size(T,2)*resX*samX/1000 0 size(T,1)*resY*samY/1000&nbsp; minbm maxbm])<br /><br />&nbsp;&nbsp;&nbsp; %<br />&nbsp;&nbsp;&nbsp; subplot(2, 2, 4);<br />&nbsp;&nbsp;&nbsp; % imagesc(-img1b, [-300, 300]), title('Pair 1, Bottom'), colorbar();<br />&nbsp;&nbsp;&nbsp; T = double(-img1b(1:samY:end,1:samX:end));<br />&nbsp;&nbsp;&nbsp; surface('XData',[1:size(T,2)]*resX*samX/1000,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'YData',[1:size(T,1)]*resY*samY/1000,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'ZData',T,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'CData',T)<br />&nbsp;&nbsp;&nbsp; colorbar('NorthOutside');<br />&nbsp;&nbsp;&nbsp; axis tight;<br />&nbsp;&nbsp;&nbsp; xlabel('X (unit:mm)'); ylabel('Y (unit:mm)')<br />&nbsp;&nbsp;&nbsp; zlabel('Z (unit:um)')<br />&nbsp;&nbsp;&nbsp; view(10,60)<br />&nbsp;&nbsp;&nbsp; set(gca, 'fontsize',6)<br />&nbsp;&nbsp;&nbsp; t = title('Pair1, Bottom');<br />&nbsp;&nbsp;&nbsp; set(t,'fontsize',10)<br />&nbsp;&nbsp;&nbsp; axis([0 size(T,2)*resX*samX/1000 0 size(T,1)*resY*samY/1000&nbsp; minbm maxbm])<br /><br /><br />&nbsp;&nbsp;&nbsp; %%<br />&nbsp;&nbsp;&nbsp; Grab = getframe(gcf,[1 1 scrsz(3) scrsz(4)/2]);<br />&nbsp;&nbsp;&nbsp; imwrite(Grab.cdata, sprintf('%sProfile.bmp', dest));<br /><br /><br />&nbsp;&nbsp;&nbsp; %%<br /><br /><br />&nbsp;&nbsp;&nbsp; %<br />&nbsp;&nbsp;&nbsp; f2= figure('Position',[1 scrsz(4)/2-300 scrsz(3) scrsz(4)/2]);<br />&nbsp;&nbsp;&nbsp; set(f2,'name','Profile','Numbertitle','off')<br />&nbsp;&nbsp;&nbsp; subplot(2, 2, 1);<br />&nbsp;&nbsp;&nbsp; % surface('XData',[1:size(T,2)]*resX*samX/1000,...<br />&nbsp;&nbsp;&nbsp; %&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'YData',[1:size(T,1)]*resY*samY/1000,...<br />&nbsp;&nbsp;&nbsp; %&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'ZData',double(img0b(1:samY:end,1:samX:end)-img0t(1:samY:end,1:samX:end)),...<br />&nbsp;&nbsp;&nbsp; %&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'CData',double(img0b(1:samY:end,1:samX:end)-img0t(1:samY:end,1:samX:end)))<br />&nbsp;&nbsp;&nbsp; T = double(img0b(1:samY:end,1:samX:end)-img0t(1:samY:end,1:samX:end));<br /><br />&nbsp;&nbsp;&nbsp; T = T;%-281.8724<br /><br /><br />&nbsp;&nbsp;&nbsp; surface('XData',(1:size(T,2))*resX*samX/1000,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'YData',(1:size(T,1))*resY*samY/1000,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'ZData', T,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'CData', T)<br />&nbsp;&nbsp;&nbsp; colorbar('NorthOutside');<br />&nbsp;&nbsp;&nbsp; axis tight;<br />&nbsp;&nbsp;&nbsp; xlabel('X (unit:mm)'); ylabel('Y (unit:mm)')<br />&nbsp;&nbsp;&nbsp; zlabel('Z (unit:um)')<br />&nbsp;&nbsp;&nbsp; view(10,60)<br />&nbsp;&nbsp;&nbsp; set(gca, 'fontsize',6)<br />&nbsp;&nbsp;&nbsp; t = title('Pair0, Thickness');<br />&nbsp;&nbsp;&nbsp; set(t,'fontsize',10)<br />&nbsp;&nbsp;&nbsp; axis([0 size(T,2)*resX*samX/1000 0 size(T,1)*resY*samY/1000&nbsp; minTh maxTh])<br /><br /><br />&nbsp;&nbsp;&nbsp; subplot(2, 2, 2);<br />&nbsp;&nbsp;&nbsp; T = double(img1b(1:samY:end,1:samX:end)-img1t(1:samY:end,1:samX:end));<br />&nbsp;&nbsp;&nbsp; surface('XData', (1:size(T,2))*resX*samX/1000,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'YData', (1:size(T,1))*resY*samY/1000,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'ZData',T,...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'CData',T);<br />&nbsp;&nbsp;&nbsp; colorbar('NorthOutside');<br />&nbsp;&nbsp;&nbsp; axis tight;<br />&nbsp;&nbsp;&nbsp; xlabel('X (unit:mm)'); ylabel('Y (unit:mm)')<br />&nbsp;&nbsp;&nbsp; zlabel('Z (unit:um)')<br />&nbsp;&nbsp;&nbsp; view(10,60)<br />&nbsp;&nbsp;&nbsp; set(gca, 'fontsize',6)<br />&nbsp;&nbsp;&nbsp; t = title('Pair1, Thickness'),<br />&nbsp;&nbsp;&nbsp; set(t,'fontsize',10)<br />&nbsp;&nbsp;&nbsp; axis([0 size(T,2)*resX*samX/1000 0 size(T,1)*resY*samY/1000 minTh maxTh])<br /><br /><br />&nbsp;&nbsp;&nbsp; img0bs = img0b;<br />&nbsp;&nbsp;&nbsp; img0ts = img0t;<br />&nbsp;&nbsp;&nbsp; img1bs = img1b;<br />&nbsp;&nbsp;&nbsp; img1ts = img1t;<br /><br />&nbsp;&nbsp;&nbsp; L0by = img0bs(idy,:);<br />&nbsp;&nbsp;&nbsp; L0ty = img0ts(idy,:);<br />&nbsp;&nbsp;&nbsp; L1by = img1bs(idy,:);<br />&nbsp;&nbsp;&nbsp; L1ty = img1ts(idy,:);<br />&nbsp;&nbsp;&nbsp; T0y = L0by - L0ty;<br />&nbsp;&nbsp;&nbsp; T1y = L1by - L1ty;<br />&nbsp;&nbsp;&nbsp; miny= min(size(T0y,2),size(T1y,2));<br />&nbsp;&nbsp;&nbsp; Ty&nbsp; = [T0y(1:miny); T1y(1:miny)]';<br /><br /><br />&nbsp;&nbsp;&nbsp; Ty(:,1) = Ty(:,1);% -281.8724<br /><br />&nbsp;&nbsp;&nbsp; subplot(2,2,3);<br />&nbsp;&nbsp;&nbsp; hold on; plot(([1:size(Ty,1)]*resX/1000)',Ty(:,1),'r'); %legend(tix);<br />&nbsp;&nbsp;&nbsp; hold on; plot(([1:size(Ty,1)]*resX/1000)',Ty(:,2),'b'); %legend(tix);<br />&nbsp;&nbsp;&nbsp; legend('Pair0','Pair1');<br />&nbsp;&nbsp;&nbsp; title('Thinckness profile along middle row');<br />&nbsp;&nbsp;&nbsp; axis([0&nbsp; size(Ty,1)*resX/1000 minTh maxTh])<br /><br /><br />&nbsp;&nbsp;&nbsp; L0bx = img0b(:,idx);<br />&nbsp;&nbsp;&nbsp; L0tx = img0t(:,idx);<br />&nbsp;&nbsp;&nbsp; L1bx = img1b(:,idx);<br />&nbsp;&nbsp;&nbsp; L1tx = img1t(:,idx);<br />&nbsp;&nbsp;&nbsp; T0x = L0bx - L0tx;<br />&nbsp;&nbsp;&nbsp; T1x = L1bx - L1tx;<br />&nbsp;&nbsp;&nbsp; minx= min(size(T0x,1),size(T1x,1));<br />&nbsp;&nbsp;&nbsp; Tx&nbsp; = [T0x(1:minx) T1x(1:minx)];<br /><br />&nbsp;&nbsp;&nbsp; Tx(:,1) = Tx(:,1);% -281.8724<br /><br />&nbsp;&nbsp;&nbsp; subplot(2,2,4);<br />&nbsp;&nbsp;&nbsp; hold on; plot(([1:size(Tx,1)]*resY/1000)',Tx(:,1),'r'); %legend(tix);<br />&nbsp;&nbsp;&nbsp; hold on; plot(([1:size(Tx,1)]*resY/1000)',Tx(:,2),'b'); %<br />&nbsp;&nbsp;&nbsp; legend('Pair0','Pair1');<br />&nbsp;&nbsp;&nbsp; title('Thinckness profile along middle column');<br />&nbsp;&nbsp;&nbsp; axis([0&nbsp; size(Tx,1)*resY/1000 minTh maxTh])<br /><br />&nbsp;&nbsp;&nbsp; Grab = getframe(gcf,[1 1 scrsz(3) scrsz(4)/2]);<br />&nbsp;&nbsp;&nbsp; imwrite(Grab.cdata, sprintf('%sThinckness.bmp', dest));<br />%end</p>