想实现类似于vc debugger watch window那样能显示出对象的内部成员资料的效果, 最近看了看boost::serialization发现可以自定义一个archive来实现将object的成员变量保存到一个树形结构中去.我是通过修改xml_oarchive实现的.<br />首先修改basic_xml_oarchive为basic_tree_oarchive,这个类继承自common_oarchive, common_oarchive类实现了archive操作的主要interface和对于不同数据类型(指针, 对象, 派生类,版本)的控制. <br />然后修改xml_oarchive_impl为tree_oarchive_impl, 这个类主要实现了不同基本数据类型(比如char,int,float,..)的处理<br />以及修改xml_oarchive为tree_oarchive<br />对对象树结构定义如下<br />struct TreeNode<br />{<br />&nbsp;&nbsp; &nbsp;std::string name;<br />&nbsp;&nbsp; &nbsp;std::vector&lt;TreeNode *&gt;children;&nbsp;&nbsp; &nbsp;//对于基本元素,为null<br />&nbsp;&nbsp; &nbsp;TreeNode *parent;<br />&nbsp;&nbsp; &nbsp;std::string type;&nbsp;&nbsp; &nbsp;//used for 基本元素<br />&nbsp;&nbsp; &nbsp;std::string value;<br /><br />&nbsp;&nbsp; &nbsp;TreeNode()<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;: parent(0)<br />&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;}<br /><br />&nbsp;&nbsp; &nbsp;TreeNode * AddChild(const std::string &amp;nam)<br />&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;TreeNode *child = new TreeNode;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;child-&gt;name = nam;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;child-&gt;parent = this;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;this-&gt;children.push_back(child);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return child;<br />&nbsp;&nbsp; &nbsp;}<br />};<br />在basic_tree_oarchive里定义成员变量 TreeNode *tree;<br />然后修改函数<br />&nbsp;template&lt;class T&gt;<br />&nbsp;&nbsp;&nbsp; void save_override(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #ifndef BOOST_NO_FUNCTION_TEMPLATE_ORDERING<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #endif<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::boost::serialization::nvp&lt;T&gt; &amp; t, <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int<br />&nbsp;&nbsp;&nbsp; ){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save_start(t.name());<br /><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;assert(tree);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="color: red;">tree = tree-&gt;AddChild(t.name()</span>);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this-&gt;detail_common_oarchive::save_override(t.const_value(), 0);<br /><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;assert(tree);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="color: red;">tree = tree-&gt;paren</span>t;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;assert(tree);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save_end(t.name());<br />&nbsp;&nbsp;&nbsp; }<br /><br />在类里面实现不同的save<br />&nbsp;&nbsp;&nbsp; BOOST_ARCHIVE_DECL(void)<br />&nbsp;&nbsp; &nbsp;save(const double &amp;s){<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;std::cout &lt;&lt; s;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;tree-&gt;type = "double";<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;char c[20];<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sprintf(c, "%g", s);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;tree-&gt;value = c;<br />&nbsp;&nbsp; &nbsp;}<br /><br />&nbsp;&nbsp; &nbsp;BOOST_ARCHIVE_DECL(void)<br />&nbsp;&nbsp; &nbsp;save(const float &amp;s){<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;std::cout &lt;&lt; s;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;tree-&gt;type = "float";<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;char c[20];<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sprintf(c, "%g", s);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;tree-&gt;value = c;<br />&nbsp;&nbsp; &nbsp;}<br /><br />&nbsp;&nbsp; &nbsp;BOOST_ARCHIVE_DECL(void)<br />&nbsp;&nbsp; &nbsp;save(const int &amp;s){<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;std::cout &lt;&lt; s;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;tree-&gt;type = "int";<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;char c[20];<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sprintf(c, "%d", s);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;tree-&gt;value = c;<br />&nbsp;&nbsp; &nbsp;}<br /><br />&nbsp;&nbsp; &nbsp;BOOST_ARCHIVE_DECL(void)<br />&nbsp;&nbsp; &nbsp;save(const char * s){<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;std::cout &lt;&lt; s;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;tree-&gt;type = "char*";<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;tree-&gt;value = s;<br />&nbsp;&nbsp; &nbsp;}<br /><br />&nbsp; <br />&nbsp;&nbsp;&nbsp; BOOST_ARCHIVE_DECL(void)<br />&nbsp;&nbsp;&nbsp; save(const std::string &amp;s)<br />&nbsp;&nbsp; &nbsp;{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;std::cout &lt;&lt; s;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;tree-&gt;type = "string";<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;tree-&gt;value = s;<br />&nbsp;&nbsp; &nbsp;}<br />这么就基本可以了...似乎很简单是把<br />对于UI显示嘛, 本想用那个proptree的(前面我有文章说过), 可是这个vc6的代码拿到vc2008下死活有问题, 又没能找到原因.所以作罢.郁闷...